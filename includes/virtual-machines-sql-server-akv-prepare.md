## <a name="prepare-for-akv-integration"></a><span data-ttu-id="7c1a4-101">Preparar a integração AKV</span><span class="sxs-lookup"><span data-stu-id="7c1a4-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="7c1a4-102">toouse tooconfigure de integração do Cofre de chaves do Azure a VM do SQL Server, existem vários pré-requisitos:</span><span class="sxs-lookup"><span data-stu-id="7c1a4-102">toouse Azure Key Vault Integration tooconfigure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="7c1a4-103">Instalar o Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="7c1a4-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="7c1a4-104">Criar um Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7c1a4-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="7c1a4-105">Criar um cofre de chaves</span><span class="sxs-lookup"><span data-stu-id="7c1a4-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="7c1a4-106">Olá secções seguintes descrevem estas pré-requisitos e informações de Olá, terá de cmdlets do PowerShell toocollect toolater executar Olá.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-106">hello following sections describe these prerequisites and hello information you need toocollect toolater run hello PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="7c1a4-107">Instalar o Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="7c1a4-107">Install Azure PowerShell</span></span>
<span data-ttu-id="7c1a4-108">Certifique-se de que instalou Olá, Azure PowerShell SDK mais recente.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-108">Make sure you have installed hello latest Azure PowerShell SDK.</span></span> <span data-ttu-id="7c1a4-109">Para obter mais informações, consulte [como tooinstall e configurar o Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="7c1a4-109">For more information, see [How tooinstall and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="7c1a4-110">Criar um Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7c1a4-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="7c1a4-111">Em primeiro lugar, precisa de toohave um [do Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) na sua subscrição.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-111">First, you need toohave an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="7c1a4-112">Entre muitas vantagens, isto permite-lhe toogrant permissão tooyour Cofre de chaves para determinados utilizadores e aplicações.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-112">Among many benefits, this allows you toogrant permission tooyour key vault for certain users and applications.</span></span>

<span data-ttu-id="7c1a4-113">Em seguida, registe uma aplicação com o AAD.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-113">Next, register an application with AAD.</span></span> <span data-ttu-id="7c1a4-114">Isto irá dar-lhe uma conta do Principal de serviço que tenha acesso tooyour Cofre de chaves que terá da VM.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-114">This will give you a Service Principal account that has access tooyour key vault which your VM will need.</span></span> <span data-ttu-id="7c1a4-115">Artigo do Cofre de chaves do Azure Olá, pode encontrar estes passos no Olá [registar uma aplicação no Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) secção, ou pode ver os passos de Olá com capturas de ecrã Olá **obter uma identidade da aplicação Olá secção** de [esta mensagem de blogue](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="7c1a4-115">In hello Azure Key Vault article, you can find these steps in hello [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see hello steps with screen shots in hello **Get an identity for hello application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="7c1a4-116">Antes de concluir estes passos, tenha em atenção que tem de Olá toocollect seguir informações durante este registo que é necessária mais tarde, quando ativar a integração do Cofre de chaves do Azure na sua VM do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-116">Before completing these steps, note that you need toocollect hello following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="7c1a4-117">Depois de é adicionada a aplicação Olá, determinar Olá **ID de cliente** no Olá **configurar** separador.   ![ID de cliente do Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="7c1a4-117">After hello application is added, find hello **CLIENT ID**  on hello **CONFIGURE** tab.   ![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="7c1a4-118">ID de cliente Olá é atribuído toohello posterior **$spName** parâmetro tooenable de script de PowerShell Olá integração do Cofre de chaves do Azure (nome Principal de serviço).</span><span class="sxs-lookup"><span data-stu-id="7c1a4-118">hello client ID is assigned later toohello **$spName** (Service Principal name) parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="7c1a4-119">Além disso, durante estes passos ao criar a chave, copie segredo de Olá para a sua chave conforme é mostrado na seguinte captura de ecrã de Olá.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-119">Also, during these steps when you create your key, copy hello secret for your key as is shown in hello following screenshot.</span></span> <span data-ttu-id="7c1a4-120">Esta chave secreta é atribuída toohello posterior **$spSecret** parâmetro (segredo Principal de serviço) no script de PowerShell Olá.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-120">This key secret is assigned later toohello **$spSecret** (Service Principal secret) parameter in hello PowerShell script.</span></span>  
    <span data-ttu-id="7c1a4-121">![Segredo do Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="7c1a4-121">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="7c1a4-122">Tem de autorizar este hello de toohave do ID cliente novo as seguintes permissões de acesso: **encriptar**, **desencriptar**, **wrapKey**, **unwrapKey**, **sessão**, e **verificar**.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-122">You must authorize this new client ID toohave hello following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="7c1a4-123">Isto é feito com Olá [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-123">This is done with hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="7c1a4-124">Para obter mais informações consulte [autorizar Olá aplicação toouse Olá chave ou segredo](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="7c1a4-124">For more information see [Authorize hello application toouse hello key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="7c1a4-125">Criar um cofre de chaves</span><span class="sxs-lookup"><span data-stu-id="7c1a4-125">Create a key vault</span></span>
<span data-ttu-id="7c1a4-126">Ordem toouse Cofre de chaves do Azure toostore Olá chaves que irá utilizar para encriptação na sua VM, terá de Cofre de chaves de tooa de acesso.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-126">In order toouse Azure Key Vault toostore hello keys you will use for encryption in your VM, you need access tooa key vault.</span></span> <span data-ttu-id="7c1a4-127">Se já não configurar o seu Cofre de chaves, crie um seguindo os passos de Olá em Olá [introdução ao Cofre de chaves do Azure](../articles/key-vault/key-vault-get-started.md) tópico.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-127">If you have not already set up your key vault, create one by following hello steps in hello [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="7c1a4-128">Antes de concluir estes passos, tenha em atenção que não há algumas informações necessárias toocollect durante este conjunto de cópias de segurança que é necessária mais tarde, quando ativar a integração do Cofre de chaves do Azure na sua VM do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-128">Before completing these steps, note that there is some information you need toocollect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="7c1a4-129">Quando chegar toohello passo da criação de um cofre de chaves, Olá nota devolvido **vaultUri** propriedade, o que é o URL do Cofre de chaves de Olá.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-129">When you get toohello Create a key vault step, note hello returned **vaultUri** property, which is hello key vault URL.</span></span> <span data-ttu-id="7c1a4-130">Exemplo de Olá fornecido esse passo, abaixo, nome do Cofre de chaves de Olá ContosoKeyVault, por conseguinte, o URL do Cofre de chaves de Olá seria https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-130">In hello example provided in that step, shown below, hello key vault name is ContosoKeyVault, therefore hello key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="7c1a4-131">URL do Cofre de chaves de Olá é atribuído toohello posterior **$akvURL** parâmetro tooenable de script de PowerShell Olá integração do Cofre de chaves do Azure.</span><span class="sxs-lookup"><span data-stu-id="7c1a4-131">hello key vault URL is assigned later toohello **$akvURL** parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span>

