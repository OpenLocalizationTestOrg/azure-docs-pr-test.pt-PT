---
title: arquitetura do Azure HDInsight associados a um aaaDomain | Microsoft Docs
description: "Saiba como tooplan associados a um domínio HDInsight."
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
ms.openlocfilehash: 1c3ecedf3739b4f8fa54160225be9c1d6e2ca6cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a><span data-ttu-id="0d393-103">Planear clusters do Hadoop associados a um domínio do Azure no HDInsight</span><span class="sxs-lookup"><span data-stu-id="0d393-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span></span>

<span data-ttu-id="0d393-104">Olá Hadoop tradicional é um cluster de utilizador único.</span><span class="sxs-lookup"><span data-stu-id="0d393-104">hello traditional Hadoop is a single-user cluster.</span></span> <span data-ttu-id="0d393-105">É adequado à maioria das empresas em que as cargas de trabalho de dados de grande dimensão são criadas por pequenas equipas de aplicações.</span><span class="sxs-lookup"><span data-stu-id="0d393-105">It is suitable for most companies that have smaller application teams building large data workloads.</span></span> <span data-ttu-id="0d393-106">À medida que a popularidade do Hadoop aumenta, muitas empresas estão a migrar para um modelo no qual os clusters são geridos pelas equipas de TI e em que várias equipas de aplicações partilham esses clusters.</span><span class="sxs-lookup"><span data-stu-id="0d393-106">As Hadoop gains popularity, many enterprises are moving toward a model in which clusters are managed by IT teams and multiple application teams share clusters.</span></span> <span data-ttu-id="0d393-107">Assim, as funcionalidades que envolvem clusters multiuser estão entre Olá mais pedidas funcionalidades no Azure HDInsight.</span><span class="sxs-lookup"><span data-stu-id="0d393-107">Thus, functionalities involving multiuser clusters are among hello most requested functionalities in Azure HDInsight.</span></span>

<span data-ttu-id="0d393-108">Em vez de criar a sua própria multiuser autenticação e autorização, HDInsight depende do fornecedor de identidade mais popular Olá – do Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="0d393-108">Instead of building its own multiuser authentication and authorization, HDInsight relies on hello most popular identity provider--Active Directory (AD).</span></span> <span data-ttu-id="0d393-109">funcionalidade de segurança poderosas Olá no AD pode ser utilizado toomanage autorização multiuser no HDInsight.</span><span class="sxs-lookup"><span data-stu-id="0d393-109">hello powerful security functionality in AD can be used toomanage multiuser authorization in HDInsight.</span></span> <span data-ttu-id="0d393-110">Ao integrar o HDInsight com o AD, pode comunicar com clusters de Olá com as suas credenciais do AD.</span><span class="sxs-lookup"><span data-stu-id="0d393-110">By integrating HDInsight with AD, you can communicate with hello clusters by using your AD credentials.</span></span> <span data-ttu-id="0d393-111">HDInsight mapeia um utilizador tooa local Hadoop utilizador do AD, para que todos os serviços em execução no HDInsight de Olá (Ambari, thrift de Spark do servidor, Ranger, de ramo de registo do servidor e outros) funcionam perfeitamente para utilizador Olá autenticado.</span><span class="sxs-lookup"><span data-stu-id="0d393-111">HDInsight maps an AD user tooa local Hadoop user, so all hello services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for hello authenticated user.</span></span>

## <a name="integrate-hdinsight-with-ad-and-ad-on-iaas-vm"></a><span data-ttu-id="0d393-112">Integrar o HDInsight com o AD e AD na VM do IaaS</span><span class="sxs-lookup"><span data-stu-id="0d393-112">Integrate HDInsight with AD and AD on IaaS VM</span></span>

<span data-ttu-id="0d393-113">Ao integrar o HDInsight com o Azure AD ou AD na VM do Iaas, nós de cluster do HDInsight Olá estão associados a um domínio tooa domínio.</span><span class="sxs-lookup"><span data-stu-id="0d393-113">By integrating HDInsight with Azure AD or AD on Iaas VM, hello HDInsight cluster nodes are domain-joined tooa domain.</span></span> <span data-ttu-id="0d393-114">HDInsight cria principais de serviço para Olá serviços do Hadoop em execução no cluster de Olá e coloca-os dentro de uma unidade organizacional (UO) especificada no Azure AD ou AD na VM do IaaS.</span><span class="sxs-lookup"><span data-stu-id="0d393-114">HDInsight creates service principals for hello Hadoop services running on hello cluster and places them within a specified organizational unit (OU) in Azure AD or AD on IaaS VM.</span></span> <span data-ttu-id="0d393-115">HDInsight também cria mapeamentos inversas de DNS no domínio de Olá para Olá endereços IP de nós Olá toohello associado ao domínio.</span><span class="sxs-lookup"><span data-stu-id="0d393-115">HDInsight also creates reverse DNS mappings in hello domain for hello IP addresses of hello nodes that are joined toohello domain.</span></span>

<span data-ttu-id="0d393-116">Para obter esta configuração, pode utilizar várias arquiteturas.</span><span class="sxs-lookup"><span data-stu-id="0d393-116">You can achieve this setup by using multiple architectures.</span></span> <span data-ttu-id="0d393-117">Pode escolher entre Olá arquiteturas a seguir.</span><span class="sxs-lookup"><span data-stu-id="0d393-117">You can choose from hello following architectures.</span></span>

<span data-ttu-id="0d393-118">**HDInsight integrado com o AD em execução no IaaS do Azure**</span><span class="sxs-lookup"><span data-stu-id="0d393-118">**HDInsight integrated with AD running on Azure IaaS**</span></span>

<span data-ttu-id="0d393-119">Esta é a arquitetura mais simples de Olá para integrar HDInsight com o Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0d393-119">This is hello simplest architecture for integrating HDInsight with Active Directory.</span></span> <span data-ttu-id="0d393-120">Olá controlador de domínio do AD é executado num (ou vários) máquinas de virtuais (VMs) no Azure.</span><span class="sxs-lookup"><span data-stu-id="0d393-120">hello AD domain controller runs on one (or multiple) virtual machines (VMs) in Azure.</span></span> <span data-ttu-id="0d393-121">Normalmente, estas VMs estão dentro de uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="0d393-121">These VMs are usually in a virtual network.</span></span> <span data-ttu-id="0d393-122">Configurar a outra rede virtual de cluster do HDInsight Olá.</span><span class="sxs-lookup"><span data-stu-id="0d393-122">You set up another virtual network for hello HDInsight cluster.</span></span> <span data-ttu-id="0d393-123">Para o HDInsight toohave tooActive uma linha de visão diretório, terá de toopeer estas redes virtuais utilizando [vnet para VNet peering](../virtual-network/virtual-network-create-peering.md).</span><span class="sxs-lookup"><span data-stu-id="0d393-123">For HDInsight toohave a line of sight tooActive Directory, you need toopeer these virtual networks by using [VNet-to-VNet peering](../virtual-network/virtual-network-create-peering.md).</span></span> <span data-ttu-id="0d393-124">Se criar hello do Active Directory no ARM, em seguida, pode criar Olá do Active Directory e o HDInsight no Olá mesma VNet e não precisa de toodo peering.</span><span class="sxs-lookup"><span data-stu-id="0d393-124">If you create hello Active Directory in ARM, then you can create hello Active Directory and HDInsight in hello same VNet and you don't need toodo peering.</span></span> 

![Topologia do cluster do HDInsight associado a domínio](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> <span data-ttu-id="0d393-126">Nesta arquitetura, não é possível utilizar o Azure Data Lake Store com o cluster do HDInsight Olá.</span><span class="sxs-lookup"><span data-stu-id="0d393-126">In this architecture, you cannot use Azure Data Lake Store with hello HDInsight cluster.</span></span>


<span data-ttu-id="0d393-127">Pré-requisitos para o Active Directory:</span><span class="sxs-lookup"><span data-stu-id="0d393-127">Prerequisites for Active Directory:</span></span>

* <span data-ttu-id="0d393-128">Um [unidade organizacional](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) tem de ser criado, no qual é colocar Olá VMs de cluster do HDInsight e Olá principais de serviço utilizados pelo cluster Olá.</span><span class="sxs-lookup"><span data-stu-id="0d393-128">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place hello HDInsight cluster VMs and hello service principals used by hello cluster.</span></span>
* <span data-ttu-id="0d393-129">[Protocolos de acesso do Lightweight Directory](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) tem de ser configurados para comunicar com o AD.</span><span class="sxs-lookup"><span data-stu-id="0d393-129">[Lightweight Directory Access Protocols](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) must be set up for communicating with AD.</span></span> <span data-ttu-id="0d393-130">Olá certificado utilizado tooset segurança LDAPS tem de ser um certificado real (não um certificado autoassinado).</span><span class="sxs-lookup"><span data-stu-id="0d393-130">hello certificate used tooset up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="0d393-131">Zonas DNS inversas têm de ser criadas no domínio Olá para o intervalo de endereços IP Olá da sub-rede de HDInsight Olá (por exemplo, 10.2.0.0/24 na imagem anterior Olá).</span><span class="sxs-lookup"><span data-stu-id="0d393-131">Reverse DNS zones must be created on hello domain for hello IP address range of hello HDInsight subnet (for example, 10.2.0.0/24 in hello previous picture).</span></span>
* <span data-ttu-id="0d393-132">É necessária uma conta de serviço ou uma conta de utilizador.</span><span class="sxs-lookup"><span data-stu-id="0d393-132">A service account or a user account is needed.</span></span> <span data-ttu-id="0d393-133">Utilize o cluster do HDInsight toocreate Olá esta conta.</span><span class="sxs-lookup"><span data-stu-id="0d393-133">Use this account toocreate hello HDInsight cluster.</span></span> <span data-ttu-id="0d393-134">Esta conta tem de ter Olá as seguintes permissões:</span><span class="sxs-lookup"><span data-stu-id="0d393-134">This account must have hello following permissions:</span></span>

    - <span data-ttu-id="0d393-135">Objetos de principais de serviço do permissões toocreate e objetos de máquina numa unidade organizacional Olá</span><span class="sxs-lookup"><span data-stu-id="0d393-135">Permissions toocreate service principal objects and machine objects within hello organizational unit</span></span>
    - <span data-ttu-id="0d393-136">Permissões toocreate inversas DNS proxy as regras</span><span class="sxs-lookup"><span data-stu-id="0d393-136">Permissions toocreate reverse DNS proxy rules</span></span>
    - <span data-ttu-id="0d393-137">Domínio do permissões toojoin máquinas toohello do Active Directory</span><span class="sxs-lookup"><span data-stu-id="0d393-137">Permissions toojoin machines toohello Active Directory domain</span></span>

<span data-ttu-id="0d393-138">**HDInsight integrado num Azure AD apenas na cloud**</span><span class="sxs-lookup"><span data-stu-id="0d393-138">**HDInsight integrated with cloud-only Azure AD**</span></span>

<span data-ttu-id="0d393-139">Para um Azure AD apenas na cloud, configure um controlador de domínio para que o HDInsight possa ser integrado no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0d393-139">For cloud-only Azure AD, configure a domain controller so that HDInsight can be integrated with Azure AD.</span></span> <span data-ttu-id="0d393-140">Isto é conseguido utilizando [do Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span><span class="sxs-lookup"><span data-stu-id="0d393-140">This is achieved by using [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span></span> <span data-ttu-id="0d393-141">Azure AD DS cria as máquinas do controlador de domínio na nuvem de Olá e fornece endereços IP para os mesmos.</span><span class="sxs-lookup"><span data-stu-id="0d393-141">Azure AD DS creates domain controller machines on hello cloud and provides IP addresses for them.</span></span> <span data-ttu-id="0d393-142">Cria dois controladores de domínio, para elevada disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0d393-142">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="0d393-143">Atualmente, o Azure AD DS só existe em redes virtuais clássicas.</span><span class="sxs-lookup"><span data-stu-id="0d393-143">Currently, Azure AD DS exists only in classic virtual networks.</span></span> <span data-ttu-id="0d393-144">Só é acessível através da utilização de Olá portal clássico do Azure.</span><span class="sxs-lookup"><span data-stu-id="0d393-144">It is only accessible by using hello Azure classic portal.</span></span> <span data-ttu-id="0d393-145">Olá HDInsight rede virtual existe no Olá portal do Azure, o que precisa de toobe em modo de peering com a rede virtual clássica de Olá através da utilização de VNet a VNet peering.</span><span class="sxs-lookup"><span data-stu-id="0d393-145">hello HDInsight virtual network exists in hello Azure portal, which needs toobe peered with hello classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="0d393-146">Peering entre uma rede virtual clássica e uma rede virtual requer que ambas as redes virtuais estão do Azure Resource Manager Olá mesma região e em Olá mesma subscrição do Azure.</span><span class="sxs-lookup"><span data-stu-id="0d393-146">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in hello same region and under hello same Azure subscription.</span></span>

![Topologia do cluster do HDInsight associado a domínio](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="0d393-148">Pré-requisitos para o Azure AD:</span><span class="sxs-lookup"><span data-stu-id="0d393-148">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="0d393-149">Um [unidade organizacional](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) tem de ser criada dentro do qual é colocar Olá VMs de cluster do HDInsight e Olá principais de serviço utilizados pelo cluster Olá.</span><span class="sxs-lookup"><span data-stu-id="0d393-149">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place hello HDInsight cluster VMs and hello service principals used by hello cluster.</span></span>
* <span data-ttu-id="0d393-150">O [LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) tem de ser configurado quando configurar o Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="0d393-150">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="0d393-151">Olá certificado utilizado tooset segurança LDAPS tem de ser um certificado real (não um certificado autoassinado).</span><span class="sxs-lookup"><span data-stu-id="0d393-151">hello certificate used tooset up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="0d393-152">Zonas DNS inversas têm de ser criadas no domínio Olá para o intervalo de endereços IP Olá da sub-rede de HDInsight Olá (por exemplo, 10.2.0.0/24 na imagem anterior Olá).</span><span class="sxs-lookup"><span data-stu-id="0d393-152">Reverse DNS zones must be created on hello domain for hello IP address range of hello HDInsight subnet (for example, 10.2.0.0/24 in hello previous picture).</span></span>
* <span data-ttu-id="0d393-153">[Os hashes de palavra-passe](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) tem de ser sincronizados a partir do Azure AD tooAzure do AD DS.</span><span class="sxs-lookup"><span data-stu-id="0d393-153">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD tooAzure AD DS.</span></span>
* <span data-ttu-id="0d393-154">É necessária uma conta de serviço ou uma conta de utilizador.</span><span class="sxs-lookup"><span data-stu-id="0d393-154">A service account or a user account is needed.</span></span> <span data-ttu-id="0d393-155">Utilize o cluster do HDInsight toocreate Olá esta conta.</span><span class="sxs-lookup"><span data-stu-id="0d393-155">Use this account toocreate hello HDInsight cluster.</span></span> <span data-ttu-id="0d393-156">Esta conta tem de ter Olá as seguintes permissões:</span><span class="sxs-lookup"><span data-stu-id="0d393-156">This account must have hello following permissions:</span></span>

    - <span data-ttu-id="0d393-157">Objetos de principais de serviço do permissões toocreate e objetos de máquina numa unidade organizacional Olá</span><span class="sxs-lookup"><span data-stu-id="0d393-157">Permissions toocreate service principal objects and machine objects within hello organizational unit</span></span>
    - <span data-ttu-id="0d393-158">Permissões toocreate inversas DNS proxy as regras</span><span class="sxs-lookup"><span data-stu-id="0d393-158">Permissions toocreate reverse DNS proxy rules</span></span>
    - <span data-ttu-id="0d393-159">Domínio do permissões toojoin máquinas toohello do Azure AD</span><span class="sxs-lookup"><span data-stu-id="0d393-159">Permissions toojoin machines toohello Azure AD domain</span></span>

## <a name="next-steps"></a><span data-ttu-id="0d393-160">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="0d393-160">Next steps</span></span>
* <span data-ttu-id="0d393-161">tooconfigure um cluster do HDInsight associados a um domínio, consulte [configurar clusters do HDInsight associados a um domínio](hdinsight-domain-joined-configure.md).</span><span class="sxs-lookup"><span data-stu-id="0d393-161">tooconfigure a domain-joined HDInsight cluster, see [Configure domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span></span>
* <span data-ttu-id="0d393-162">toomanage associados a um domínio os clusters do HDInsight, consulte [gerir clusters do HDInsight associados a um domínio](hdinsight-domain-joined-manage.md).</span><span class="sxs-lookup"><span data-stu-id="0d393-162">toomanage domain-joined HDInsight clusters, see [Manage domain-joined HDInsight clusters](hdinsight-domain-joined-manage.md).</span></span>
* <span data-ttu-id="0d393-163">políticas de ramo de registo tooconfigure e executadas consultas do Hive, consulte [configurar Hive políticas associados a um domínio para clusters do HDInsight](hdinsight-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="0d393-163">tooconfigure Hive policies and run Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="0d393-164">consultas do Hive toorun utilizando SSH nos clusters do HDInsight associados a um domínio, consulte [utilizar o SSH com o HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span><span class="sxs-lookup"><span data-stu-id="0d393-164">toorun Hive queries by using SSH on domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span></span>
