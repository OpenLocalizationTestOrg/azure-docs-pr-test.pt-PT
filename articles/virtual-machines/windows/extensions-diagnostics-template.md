---
title: "aaaAdd monitorização & diagnóstico tooan máquina virtual do Azure | Microsoft Docs"
description: "Utilize um toocreate de modelo de Gestor de recursos do Azure nova máquina virtual do Windows com a extensão de diagnóstico do Azure."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="35d4a-103">Utilizar a monitorização e diagnóstico com modelos de VM do Windows e o Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="35d4a-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="35d4a-104">Olá extensão de diagnóstico do Azure fornece a monitorização de Olá e as capacidades de diagnóstico do Windows baseado em máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="35d4a-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="35d4a-105">Pode ativar estas capacidades na máquina virtual de Olá, incluindo a extensão de Olá como parte do modelo do Olá do azure resource manager.</span><span class="sxs-lookup"><span data-stu-id="35d4a-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="35d4a-106">Consulte [criação de modelos de Gestor de recursos do Azure com extensões de VM](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) para obter mais informações sobre incluindo qualquer extensão como parte de um modelo de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="35d4a-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="35d4a-107">Este artigo descreve como adicionar o modelo de máquina virtual de windows extensão tooa Olá diagnósticos do Azure.</span><span class="sxs-lookup"><span data-stu-id="35d4a-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="35d4a-108">Adicionar definição de recurso VM extensão toohello Olá diagnósticos do Azure</span><span class="sxs-lookup"><span data-stu-id="35d4a-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="35d4a-109">extensão de diagnóstico de Olá tooenable na máquina Virtual do Windows tem de extensão de Olá tooadd como um recurso VM no Olá modelo do Resource manager.</span><span class="sxs-lookup"><span data-stu-id="35d4a-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="35d4a-110">Para um Gestor de recursos simples baseada em Máquina Virtual adicionar Olá extensão configuração toohello *recursos* matriz para Olá Máquina Virtual:</span><span class="sxs-lookup"><span data-stu-id="35d4a-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="35d4a-111">Outra convenção comum é adicionar configuração de extensão de Olá Olá nó raiz da recursos do modelo de Olá em vez de define sob o nó de recursos da máquina virtual Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="35d4a-112">Com esta abordagem tem tooexplicitly especifique uma relação hierárquica entre a extensão de Olá e a máquina virtual de Olá com Olá *nome* e *tipo* valores.</span><span class="sxs-lookup"><span data-stu-id="35d4a-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="35d4a-113">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="35d4a-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="35d4a-114">extensão Olá sempre está associado a máquina virtual de Olá, pode ser diretamente defini-lo diretamente no nó de recursos da máquina virtual Olá ou defini-lo ao nível da base de Olá e utilizar tooassociate de convenção de nomenclatura hierárquica de Olá com Olá virtual máquina.</span><span class="sxs-lookup"><span data-stu-id="35d4a-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="35d4a-115">Extensões de Olá de conjuntos de dimensionamento de Máquina Virtual de configuração é especificada no Olá *extensionProfile* propriedade Olá *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="35d4a-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="35d4a-116">Olá *publicador* propriedade com o valor Olá **Microsoft.Azure.Diagnostics** e Olá *tipo* propriedade com o valor Olá **IaaSDiagnostics** identificar exclusivamente a extensão de diagnóstico do Azure Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="35d4a-117">Olá, valor de Olá *nome* propriedade pode ser utilizado toorefer toohello extensão no grupo de recursos de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="35d4a-118">Defini-la especificamente demasiado**Microsoft.Insights.VMDiagnosticsSettings** irá ativá-lo toobe facilmente identificado por Olá garantir portal do Azure que Olá monitorização gráficos são apresentados corretamente Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="35d4a-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="35d4a-119">Olá *typeHandlerVersion* Especifica Olá versão da extensão de Olá que gostaria de toouse.</span><span class="sxs-lookup"><span data-stu-id="35d4a-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="35d4a-120">Definição *autoUpgradeMinorVersion* secundária versão demasiado**verdadeiro** garante que irá obter versão secundária mais recente Olá da extensão de Olá que está disponível.</span><span class="sxs-lookup"><span data-stu-id="35d4a-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="35d4a-121">É altamente recomendável que defina sempre *autoUpgradeMinorVersion* tooalways ser **verdadeiro** para que recebem sempre toouse Olá mais recente disponível diagnostics a extensão com todas as novas funcionalidades de Olá e erros correções.</span><span class="sxs-lookup"><span data-stu-id="35d4a-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="35d4a-122">Olá *definições* elemento contém as propriedades de configurações para a extensão de Olá que podem ser definidas e ler novamente a partir do extensão Olá (configuração pública, por vezes, referidos tooas).</span><span class="sxs-lookup"><span data-stu-id="35d4a-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="35d4a-123">Olá *xmlcfg* propriedade contém com base em xml configuração para os registos de diagnóstico de Olá, etc., que serão recolhidas pelo agente de diagnóstico de Olá os contadores de desempenho.</span><span class="sxs-lookup"><span data-stu-id="35d4a-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="35d4a-124">Consulte [esquema de configuração de diagnósticos](https://msdn.microsoft.com/library/azure/dn782207.aspx) para obter mais informações sobre o esquema de xml Olá próprio.</span><span class="sxs-lookup"><span data-stu-id="35d4a-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="35d4a-125">Uma prática comum é a configuração de xml real toostore Olá como uma variável no modelo do Azure Resource Manager Olá e, em seguida, concatenate e base64 codificá-los do valor de Olá tooset para *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="35d4a-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="35d4a-126">Consulte a secção de Olá no [variáveis de configuração de diagnósticos](#diagnostics-configuration-variables) toounderstand mais informações sobre como toostore Olá xml em variáveis.</span><span class="sxs-lookup"><span data-stu-id="35d4a-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="35d4a-127">Olá *storageAccount* propriedade especifica o nome de Olá Olá conta toowhich diagnósticos de dados de armazenamento será transferido.</span><span class="sxs-lookup"><span data-stu-id="35d4a-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="35d4a-128">Olá propriedades no *protectedSettings* (por vezes, referidos tooas privada configuração) pode ser definida, mas não é possível ler novamente após a ser definida.</span><span class="sxs-lookup"><span data-stu-id="35d4a-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="35d4a-129">Olá só de escrita natureza *protectedSettings* torna útil para armazenar segredos como Olá chave de conta do storage onde os dados de diagnóstico de Olá serão escritos.</span><span class="sxs-lookup"><span data-stu-id="35d4a-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="35d4a-130">Especificar a conta de armazenamento de diagnóstico como parâmetros</span><span class="sxs-lookup"><span data-stu-id="35d4a-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="35d4a-131">Olá diagnóstico extensão fragmento json acima assume que dois parâmetros *existingdiagnosticsStorageAccountName* e *existingdiagnosticsStorageResourceGroup* diagnósticos de Olá toospecify conta de armazenamento onde serão armazenados os dados de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="35d4a-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="35d4a-132">Especificar a conta de armazenamento de diagnóstico de Olá como um parâmetro faz com que conta de armazenamento de diagnóstico de Olá toochange fácil entre ambientes diferentes por exemplo, poderá ser útil toouse uma conta de armazenamento do diagnostics diferentes para testar e outra para o implementação de produção.</span><span class="sxs-lookup"><span data-stu-id="35d4a-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="35d4a-133">É melhor prática toospecify uma conta de armazenamento de diagnóstico num grupo de recursos diferente ao grupo de recursos de Olá para a máquina virtual de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="35d4a-134">Um grupo de recursos pode ser considerado toobe uma unidade de implementação com a respetiva duração, uma máquina virtual pode ser implementada e implementar como novas atualizações de configurações são efetuadas-tooit mas poderá pretender toocontinue armazenar dados de diagnóstico de Olá no Olá mesma conta de armazenamento entre as implementações de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="35d4a-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="35d4a-135">A presença de conta de armazenamento Olá num recurso diferentes permite Olá armazenamento conta tooaccept de dados de várias implementações de máquinas virtuais, tornando mais fácil tootroubleshoot problemas em Olá várias versões.</span><span class="sxs-lookup"><span data-stu-id="35d4a-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="35d4a-136">Se criar um modelo de máquina virtual do windows a partir do Visual Studio, pode ser definida a conta do storage predefinida Olá toouse Olá a mesma conta do storage onde o VHD da máquina Olá virtual é carregado.</span><span class="sxs-lookup"><span data-stu-id="35d4a-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="35d4a-137">Esta é configuração inicial do toosimplify do Olá VM.</span><span class="sxs-lookup"><span data-stu-id="35d4a-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="35d4a-138">Deverá pesar novamente Olá modelo toouse uma conta de armazenamento diferente que pode ser transmitida como um parâmetro.</span><span class="sxs-lookup"><span data-stu-id="35d4a-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="35d4a-139">Variáveis de configuração de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="35d4a-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="35d4a-140">Olá diagnóstico extensão fragmento json acima define um *accountid* toosimplify variável obter a chave de conta do storage Olá para armazenamento de diagnóstico de Olá:</span><span class="sxs-lookup"><span data-stu-id="35d4a-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="35d4a-141">Olá *xmlcfg* propriedade de extensão de diagnóstico de Olá está definida com várias variáveis que são concatenadas em conjunto.</span><span class="sxs-lookup"><span data-stu-id="35d4a-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="35d4a-142">valores Olá destas variáveis são em xml, pelo que precisam de toobe escape corretamente ao definir variáveis de json Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="35d4a-143">seguinte Olá descreve xml de configuração de diagnósticos Olá que recolhe os contadores de desempenho ao nível do sistema padrão, juntamente com alguns registos de eventos do windows e registos de infraestrutura de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="35d4a-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="35d4a-144">Foi caráter de escape correto e formatado corretamente para que hello configuração pode diretamente ser colada na secção de variáveis de Olá do seu modelo.</span><span class="sxs-lookup"><span data-stu-id="35d4a-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="35d4a-145">Consulte Olá [esquema de configuração de diagnósticos](https://msdn.microsoft.com/library/azure/dn782207.aspx) para obter um exemplo mais humano legível de Olá xml de configuração.</span><span class="sxs-lookup"><span data-stu-id="35d4a-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="35d4a-146">nó xml de definição de métrica do Olá no Olá acima configuração é um elemento de configuração importantes como define como os contadores de desempenho de Olá definido anteriormente no xml de Olá no *PerformanceCounter* será agregado nó e armazenados.</span><span class="sxs-lookup"><span data-stu-id="35d4a-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="35d4a-147">Estas métricas unidade Olá monitorização gráficos e alertas no Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="35d4a-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="35d4a-148">Olá **métricas** nós com Olá *resourceID* e **MetricAggregation** tem de ser incluído na configuração de diagnósticos de Olá para a VM se quiser toosee Olá VM dados de monitorização no Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="35d4a-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="35d4a-149">Olá segue-se um exemplo de Olá xml de definições de métrica:</span><span class="sxs-lookup"><span data-stu-id="35d4a-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="35d4a-150">Olá *resourceID* atributo identifica exclusivamente a máquina virtual de Olá na sua subscrição.</span><span class="sxs-lookup"><span data-stu-id="35d4a-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="35d4a-151">Certifique-se de que subscription() de Olá toouse e resourceGroup() funciona para que hello modelo atualiza automaticamente esses valores com base no grupo de recursos e subscrição do Olá que estiver a implementar.</span><span class="sxs-lookup"><span data-stu-id="35d4a-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="35d4a-152">Se estiver a criar várias máquinas virtuais num ciclo, em seguida, terá de toopopulate Olá *resourceID* cada VM individuais de distinguir o valor com um toocorrectly de função copyindex ().</span><span class="sxs-lookup"><span data-stu-id="35d4a-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="35d4a-153">Olá *xmlCfg* valor pode ser atualizada toosupport isto da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="35d4a-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="35d4a-154">Olá MetricAggregation valor *PT1H* e *PT1M* significam uma agregação ao longo de um minuto e uma agregação mais de uma hora.</span><span class="sxs-lookup"><span data-stu-id="35d4a-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="35d4a-155">Tabelas de WADMetrics no armazenamento</span><span class="sxs-lookup"><span data-stu-id="35d4a-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="35d4a-156">configuração de métricas de Olá acima irá gerar tabelas na sua conta de armazenamento de diagnóstico com Olá seguintes convenções de nomenclatura:</span><span class="sxs-lookup"><span data-stu-id="35d4a-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="35d4a-157">**WADMetrics** : prefixo padrão para todas as tabelas de WADMetrics</span><span class="sxs-lookup"><span data-stu-id="35d4a-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="35d4a-158">**PT1H** ou **PT1M** : significa nessa tabela Olá contém dados agregados mais de 1 hora ou de 1 minuto</span><span class="sxs-lookup"><span data-stu-id="35d4a-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="35d4a-159">**P10D** : significa tabela Olá irá conter os dados de 10 dias do quando tabela Olá iniciou a recolha de dados</span><span class="sxs-lookup"><span data-stu-id="35d4a-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="35d4a-160">**V2S** : constante de cadeia</span><span class="sxs-lookup"><span data-stu-id="35d4a-160">**V2S** : String constant</span></span>
* <span data-ttu-id="35d4a-161">**AAAAMMDD** : data de Olá no qual Olá tabela iniciou a recolha de dados</span><span class="sxs-lookup"><span data-stu-id="35d4a-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="35d4a-162">Exemplo: *WADMetricsPT1HP10DV2S20151108* irá conter os dados de métricas agregados mais de uma hora para 10 dias, começando no 11-Novembro de 2015</span><span class="sxs-lookup"><span data-stu-id="35d4a-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="35d4a-163">Cada tabela WADMetrics irá conter Olá seguintes colunas:</span><span class="sxs-lookup"><span data-stu-id="35d4a-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="35d4a-164">**PartitionKey**: Olá partitionkey é criada com base no Olá *resourceID* valor toouniquely identificar o recurso VM de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="35d4a-165">para por ex.: 002Fsubscriptions:<subscriptionID>: 002FresourceGroups:002F<ResourceGroupName>: 002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="35d4a-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="35d4a-166">**RowKey** : formato de Olá de forma <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="35d4a-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="35d4a-167">Olá descendente cálculo de marcas de escala de tempo é ticks de tempo máximo menos tempo Olá de início de Olá do período de agregação de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="35d4a-168">Por exemplo,</span><span class="sxs-lookup"><span data-stu-id="35d4a-168">E.g.</span></span> <span data-ttu-id="35d4a-169">Se o período de exemplo de Olá iniciado em 10-Novembro de 2015 e 00:00Hrs UTC, em seguida, Olá cálculo seria: ticks - (DateTime(2015,11,10,0,0,0,DateTimeKind.Utc) novo. Batimentos).</span><span class="sxs-lookup"><span data-stu-id="35d4a-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="35d4a-170">Para a chave de linha ao hello do contador de desempenho Olá memória bytes disponíveis procurará como: 2519551871999999999__:005CMemory:005CAvailable:0020 Bytes</span><span class="sxs-lookup"><span data-stu-id="35d4a-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="35d4a-171">**CounterName** : É Olá nome de contador de desempenho de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="35d4a-172">Isto corresponde à Olá *counterSpecifier* definidos na configuração do xml de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="35d4a-173">**Máximo** : Olá valor máximo de contador de desempenho de Olá período de agregação de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="35d4a-174">**Mínimo** : Olá valor mínimo de contador de desempenho de Olá período de agregação de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="35d4a-175">**Total** : soma Olá de todos os valores de contador de desempenho de Olá comunicadas período de agregação de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="35d4a-176">**Contagem** : número total de Olá dos valores comunicados Olá contador de desempenho.</span><span class="sxs-lookup"><span data-stu-id="35d4a-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="35d4a-177">**Médio** : Olá valor média (contagem/total) de contador de desempenho de Olá período de agregação de Olá.</span><span class="sxs-lookup"><span data-stu-id="35d4a-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="35d4a-178">Passos Seguintes</span><span class="sxs-lookup"><span data-stu-id="35d4a-178">Next Steps</span></span>
* <span data-ttu-id="35d4a-179">Para um modelo de exemplo completo da máquina virtual do Windows com a extensão de diagnóstico consulte [201-vm-monitorização--extensão de diagnóstico](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="35d4a-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="35d4a-180">Implementar através do modelo Olá resource manager [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) ou [linha de comandos do Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="35d4a-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="35d4a-181">Saiba mais sobre [criação de modelos Azure Resource Manager](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="35d4a-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

