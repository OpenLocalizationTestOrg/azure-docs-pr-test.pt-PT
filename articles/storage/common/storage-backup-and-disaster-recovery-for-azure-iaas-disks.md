---
title: "recuperação após desastre e aaaBackup para discos IaaS do Azure | Microsoft Docs"
description: "Neste artigo, vamos explicar como tooplan para cópia de segurança e recuperação de desastre (DR) de máquinas virtuais (VMs) IaaS e os discos no Azure. Este documento abrange gerido e discos não gerido"
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 49b0e7732d6df9407e1e44d9af2500c99a85b37e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="ec3a6-104">Cópia de segurança e recuperação após desastre para discos IaaS do Azure</span><span class="sxs-lookup"><span data-stu-id="ec3a6-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="ec3a6-105">Neste artigo, vamos explicar como tooplan para cópia de segurança e recuperação de desastre (DR) de máquinas virtuais (VMs) IaaS e os discos no Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-105">In this article, we will explain how tooplan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="ec3a6-106">Este documento abrange gerido e discos não gerido.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="ec3a6-107">Iremos falar primeiro sobre Olá incorporada capacidades tolerância a falhas em Olá plataforma Azure que ajudam a proteger contra falhas locais.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-107">We’ll first talk about hello built-in fault tolerance capabilities in hello Azure platform which help guard against local failures.</span></span> <span data-ttu-id="ec3a6-108">Em seguida, vamos abordar cenários de desastre Olá totalmente não abrangidos por capacidades incorporadas Olá, que é o tópico principal Olá abordado neste documento.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-108">We’ll then discuss hello disaster scenarios not fully covered by hello built-in capabilities, which is hello main topic addressed by this document.</span></span> <span data-ttu-id="ec3a6-109">Também vamos mostrar vários exemplos de cenários de carga de trabalho onde pode aplicar diferentes considerações sobre a cópia de segurança e de DR.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="ec3a6-110">Em seguida, iremos deverá consultar possíveis soluções para os discos de DR de IaaS.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="ec3a6-111">Introdução</span><span class="sxs-lookup"><span data-stu-id="ec3a6-111">Introduction</span></span>

<span data-ttu-id="ec3a6-112">Olá plataforma do Azure utiliza vários métodos para a redundância e toohelp de tolerância a falhas proteger clientes de falhas de hardware localizada que podem ocorrer.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-112">hello Azure platform uses various methods for redundancy and fault tolerance toohelp protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="ec3a6-113">Falhas locais podem incluir problemas com um computador de servidor de armazenamento do Azure que armazena a parte dos dados de Olá para um disco virtual ou falhas de um SSD ou HDD nesse servidor.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-113">Local failures may include problems with an Azure storage server machine that stores part of hello data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="ec3a6-114">Estas falhas de componente de hardware isolado podem acontecer durante as operações normais e plataforma Olá é concebida toobe toothese resiliente falhas.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-114">Such isolated hardware component failures can happen during normal operations and hello platform is designed toobe resilient toothese failures.</span></span> <span data-ttu-id="ec3a6-115">Principais perante desastres podem resultar em falhas ou inaccessibility de um grande número de servidores de armazenamento ou de todo um centro de dados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="ec3a6-116">Enquanto as VMs e os discos estão normalmente protegidos de falhas localizadas, são tooprotect necessário passos adicionais a carga de trabalho de toda a região catastrófica falhas (por exemplo, um desastre grave) que podem afetar o VM e os discos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary tooprotect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="ec3a6-117">Além disso toohello possibilidade de falhas da plataforma, podem ocorrer problemas com a aplicação de cliente de Olá ou dados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-117">In addition toohello possibility of platform failures, problems with hello customer application or data can occur.</span></span> <span data-ttu-id="ec3a6-118">Por exemplo, uma nova versão da aplicação poderá inadvertidamente fazer uma quebra toohello dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-118">For example, a new version of your application may inadvertently make a breaking change toohello data.</span></span> <span data-ttu-id="ec3a6-119">Nesse caso, poderá pretender que aplicações de Olá toorevert e Olá dados tooa versão anterior que contêm Olá último bom estado conhecido.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-119">In that case, you may want toorevert hello application and hello data tooa prior version containing hello last known good state.</span></span> <span data-ttu-id="ec3a6-120">É necessário manter cópias de segurança regulares.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="ec3a6-121">Recuperação de desastres regionais, deve efetuar cópias de segurança sua VM do IaaS discos tooa noutra região.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-121">For regional disaster recovery, you must backup your IaaS VM disks tooa different region.</span></span> 

<span data-ttu-id="ec3a6-122">Antes de vamos ver as opções de cópia de segurança e de DR, vamos recap alguns métodos disponíveis para processamento de falhas localizadas.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="ec3a6-123">Resiliência de IaaS do Azure</span><span class="sxs-lookup"><span data-stu-id="ec3a6-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="ec3a6-124">*Resiliência* refere-se toohello tolerância de falhas normais que ocorrem nos componentes de hardware.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-124">*Resiliency* refers toohello tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="ec3a6-125">Resiliência é Olá capacidade toorecover contra falhas e continuar toofunction.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-125">Resiliency is hello ability toorecover from failures and continue toofunction.</span></span> <span data-ttu-id="ec3a6-126">Não é sobre evitando falhas, mas responder toofailures de uma forma que evita o período de indisponibilidade ou perda de dados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-126">It's not about avoiding failures, but responding toofailures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="ec3a6-127">objetivo Olá resiliência é tooreturn Olá tooa ao funcionamento integral estado da aplicação após uma falha.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-127">hello goal of resiliency is tooreturn hello application tooa fully functioning state following a failure.</span></span> <span data-ttu-id="ec3a6-128">Máquinas virtuais do Azure e os discos são falhas de hardware de toocommon resiliente toobe concebida.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-128">Azure Virtual Machines and Disks are designed toobe resilient toocommon hardware faults.</span></span> <span data-ttu-id="ec3a6-129">Informe-nos observe como a plataforma de IaaS do Azure Olá fornece este resiliência.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-129">Let us look at how hello Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="ec3a6-130">Uma máquina virtual consiste principalmente de duas partes: (1) A computação servidor e discos persistente Olá (2).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) hello persistent disks.</span></span> <span data-ttu-id="ec3a6-131">Ambos afetam tolerância a falhas Olá de uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-131">Both affect hello fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="ec3a6-132">Se o servidor de anfitrião de computação do Azure Olá que aloja a VM sofre uma falha de hardware (que é raro), o Azure é concebida tooautomatically restauro Olá VM noutro servidor.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-132">If hello Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed tooautomatically restore hello VM on another server.</span></span> <span data-ttu-id="ec3a6-133">Se isto acontecer, irá ocorrer uma reinicialização e Olá VM será uma cópia de segurança após algum tempo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-133">If this happens, you will experience a reboot, and hello VM will be back up after some time.</span></span> <span data-ttu-id="ec3a6-134">Azure Deteta essas falhas de hardware automaticamente e executa recuperações toohelp Certifique-se o cliente de Olá VM ficará disponível logo que possível.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-134">Azure automatically detects such hardware failures and executes recoveries toohelp ensure hello customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="ec3a6-135">Relativas aos discos IaaS, é essencial para a plataforma de armazenamento persistente Olá durabilidade dos dados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-135">Regarding IaaS disks, durability of data is critical for hello persistent storage platform.</span></span> <span data-ttu-id="ec3a6-136">Clientes do Azure tem aplicações de negócio importantes em execução no IaaS e dependem de persistência de Olá dos dados de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-136">Azure customers have important business applications running on IaaS and they depend on hello persistence of hello data.</span></span> <span data-ttu-id="ec3a6-137">Proteção de estruturas do Azure para estes discos de IaaS com três cópias redundantes dos dados armazenados localmente, fornecendo uma durabilidade elevada contra falhas locais.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="ec3a6-138">Se um dos componentes de hardware de Olá que contém o disco falhar, a VM não é afetada porque existem dois cópias adicionais toosupport disco pedidos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-138">If one of hello hardware components that holds your disk fails, your VM is not impacted because there are two additional copies toosupport disk requests.</span></span> <span data-ttu-id="ec3a6-139">Funciona bem mesmo se dois componentes de hardware diferentes a suportar um disco falharem Olá mesmo tempo (que seria muito raros).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-139">It works fine even if two different hardware components supporting a disk fail at hello same time (which would be very rare).</span></span> <span data-ttu-id="ec3a6-140">Certifique-se toohelp vamos manter sempre três réplicas, serviço de armazenamento do Azure Olá cria automaticamente uma nova cópia dos dados em segundo plano de Olá se um dos três cópias de Olá ficar indisponível.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-140">toohelp ensure we always maintain three replicas, hello Azure Storage service automatically spawns a new copy of data in hello background if one of hello three copies becomes unavailable.</span></span> <span data-ttu-id="ec3a6-141">Por conseguinte, não deve ser necessário toouse RAID com discos do Azure para tolerância a falhas.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-141">Therefore, it should not be necessary toouse RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="ec3a6-142">Um simple RAID 0 configuração deve ser suficiente para striping discos Olá, se necessário toocreate maiores volumes.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-142">A simple RAID 0 configuration should be sufficient for striping hello disks if necessary toocreate larger volumes.</span></span>

<span data-ttu-id="ec3a6-143">Devido a esta arquitetura, **Azure consistentemente tem entregar a nível empresarial durabilidade para IaaS discos, com um líder da indústria ZERO % [Annualized taxa de falhas](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span><span class="sxs-lookup"><span data-stu-id="ec3a6-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="ec3a6-144">Falhas de hardware localizada no Olá de computação de anfitrião ou no armazenamento de Olá plataforma, por vezes, pode resultar em indisponibilidade temporária para Olá VM que é abrangido por Olá [SLA do Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/) para disponibilidade de VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-144">Localized hardware faults on hello compute host or in hello storage platform can sometimes result in temporary unavailability for hello VM which is covered by hello [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="ec3a6-145">Azure também fornece um SLA de líder da indústria para único instâncias VM que utilizam discos de armazenamento Premium.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="ec3a6-146">toosafeguard a cargas de trabalho de aplicação do período de indisponibilidade devido a indisponibilidade temporária do toohello de uma VM ou disco, os clientes podem tirar partido [conjuntos de disponibilidade](../../virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-146">toosafeguard application workloads from downtime due toohello temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="ec3a6-147">Dois ou mais máquinas virtuais num conjunto de disponibilidade fornece redundância para aplicação Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-147">Two or more virtual machines in an availability set provides redundancy for hello application.</span></span> <span data-ttu-id="ec3a6-148">O Azure, em seguida, cria nessas VMs e discos em domínios de falhas separados com vários componentes de alimentação, rede e servidor.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="ec3a6-149">Assim, falhas de hardware localizada normalmente não afetam várias VMs no Olá definido em Olá mesmo tempo, fornecer elevada disponibilidade para a sua aplicação.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-149">Thus, localized hardware failures typically do not affect multiple VMs in hello set at hello same time, providing high availability for your application.</span></span> <span data-ttu-id="ec3a6-150">É considerada que uma disponibilidade de toouse boa prática define quando for necessária uma elevada disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-150">It is considered a good practice toouse availability sets when high availability is required.</span></span> <span data-ttu-id="ec3a6-151">Para obter mais informações, consulte aspetos de recuperação após desastre Olá detalhados abaixo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-151">For more information, see hello Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="ec3a6-152">Cópia de segurança e recuperação após desastre</span><span class="sxs-lookup"><span data-stu-id="ec3a6-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="ec3a6-153">Recuperação após desastre (DR) é Olá toorecover de capacidade de incidentes raros mas principais: falhas não transitório, dimensionamento wide, tais como a interrupção do serviço que afeta uma região de toda.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-153">Disaster recovery (DR) is hello ability toorecover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="ec3a6-154">Recuperação após desastre inclui a cópia de segurança de dados e o arquivamento e pode incluir intervenção manual, como restaurar uma base de dados a partir da cópia de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="ec3a6-155">Olá proteção incorporada da plataforma Azure contra falhas localizadas poderá não proteger totalmente Olá VMs/discos no caso de Olá de perante desastres principais que pode provocar falhas em grande escala.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-155">hello Azure platform’s built-in protection against localized failures may not fully protect hello VMs/disks in hello case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="ec3a6-156">Isto inclui eventos catastrófica, tais como o Centro de dados que está a ser atingido por um furacão, terramoto, fire ou falhas de unidade de hardware de grande escala.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="ec3a6-157">Além disso, podem ocorrer falhas devido a problemas de tooapplication ou dados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-157">In addition, you may encounter failures due tooapplication or data issues.</span></span>

<span data-ttu-id="ec3a6-158">toohelp proteger as cargas de trabalho IaaS contra falhas, deve planear a recuperação de tooenable redundância e cópias de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-158">toohelp protect your IaaS workloads from outages, you should plan for redundancy and backups tooenable recovery.</span></span> <span data-ttu-id="ec3a6-159">Recuperação de desastres, deve planear a redundância e cópia de segurança numa localização geográfica diferente na direção oposta ao site primário Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from hello primary site.</span></span> <span data-ttu-id="ec3a6-160">Isto ajuda a garantir a cópia de segurança não é afetada por Olá mesmo evento originalmente afetado Olá VM ou discos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-160">This helps ensure your backup is not affected by hello same event that originally impacted hello VM or disks.</span></span> <span data-ttu-id="ec3a6-161">Para obter mais informações, consulte [recuperação após desastre para aplicações incorporada no Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="ec3a6-162">As considerações de DR podem incluir Olá os seguintes aspetos:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-162">Your DR considerations may include hello following aspects:</span></span>

1. <span data-ttu-id="ec3a6-163">Elevada disponibilidade (ed) é a capacidade de Olá de Olá toocontinue de aplicação em execução em bom estado de funcionamento, sem períodos de indisponibilidade significativo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-163">High Availability (HA) is hello ability of hello application toocontinue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="ec3a6-164">Por "bom estado de funcionamento," estamos significa aplicação Olá está a responder e que os utilizadores podem ligar aplicação toohello e interagir com ele.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-164">By "healthy state," we mean hello application is responsive, and users can connect toohello application and interact with it.</span></span> <span data-ttu-id="ec3a6-165">Determinadas aplicações fundamentais e bases de dados poderão ser necessário toobe disponível sempre, mesmo quando ocorrem falhas na plataforma de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-165">Certain mission-critical applications and databases may be required toobe available always, even when there are failures in hello platform.</span></span> <span data-ttu-id="ec3a6-166">Estas cargas de trabalho, poderá ter tooplan redundância para aplicação Olá, bem como em dados de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-166">For these workloads, you may need tooplan redundancy for hello application as well as hello data.</span></span>

2. <span data-ttu-id="ec3a6-167">Dados durabilidade: Em alguns casos, consideração principal Olá é assegurar que os dados de Olá são preservados no Olá maiúsculas e minúsculas de um desastre.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-167">Data Durability: In some cases, hello main consideration is ensuring hello data is preserved in hello case of a disaster.</span></span> <span data-ttu-id="ec3a6-168">Por conseguinte, poderá ter uma cópia de segurança dos seus dados num site diferente.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="ec3a6-169">Para essas cargas de trabalho, pode não necessitar de redundância completa para a aplicação Olá, mas uma cópia de segurança regular dos discos de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-169">For such workloads, you may not need full redundancy for hello application, but a regular backup of hello disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="ec3a6-170">Cópia de segurança e cenários de DR</span><span class="sxs-lookup"><span data-stu-id="ec3a6-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="ec3a6-171">Vamos ver alguns exemplos típicos de cenários de carga de trabalho de aplicações e considerações de Olá para planear a recuperação após desastre.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-171">Let’s look at a few typical examples of application workload scenarios and hello considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="ec3a6-172">Cenário 1: Principal da base de dados soluções</span><span class="sxs-lookup"><span data-stu-id="ec3a6-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="ec3a6-173">Considere um servidor de base de dados de produção, como o SQL Server ou Oracle pode suportar a elevada disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="ec3a6-174">Os utilizadores e aplicações de produção crítico dependem desta base de dados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="ec3a6-175">plano de recuperação após desastre Olá para este sistema poderá ter Olá toosupport os seguintes requisitos:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-175">hello Disaster Recovery plan for this system may need toosupport hello following requirements:</span></span>

1. <span data-ttu-id="ec3a6-176">Dados tem de ser protegido e recuperáveis.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="ec3a6-177">Servidor tem de estar disponível para utilização.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-177">Server must be available for use.</span></span>

<span data-ttu-id="ec3a6-178">Esta operação pode requerer a manter uma réplica da base de dados de Olá numa região diferente como uma cópia de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-178">This may require maintaining a replica of hello database in a different region as a backup.</span></span> <span data-ttu-id="ec3a6-179">Dependendo dos requisitos de Olá para disponibilidade de servidor e recuperação de dados, a solução de Olá pode ir desde um ativo-ativo ou ativo-passivo réplica site tooperiodic cópias de segurança offline dos dados de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-179">Depending on hello requirements for server availability and data recovery, hello solution could range from an Active-Active or Active-Passive replica site tooperiodic offline backups of hello data.</span></span> <span data-ttu-id="ec3a6-180">Bases de dados relacionais, como o SQL Server e Oracle fornecem várias opções para replicação.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="ec3a6-181">Para o SQL Server, [SQL Server em grupos de disponibilidade Always](https://msdn.microsoft.com/library/hh510230.aspx) podem ser utilizados para elevada disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="ec3a6-182">Também suportam bases de dados NoSQL como MongoDB [réplicas](https://docs.mongodb.com/manual/replication/) para redundância.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="ec3a6-183">réplicas Olá para elevada disponibilidade podem ser utilizadas.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-183">hello replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="ec3a6-184">Cenário 2: Um cluster de VMs redundantes</span><span class="sxs-lookup"><span data-stu-id="ec3a6-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="ec3a6-185">Considere uma carga de trabalho processada por um cluster de VMs que fornecer redundância e balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="ec3a6-186">Um exemplo seria um cluster de Cassandra implementado numa região.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="ec3a6-187">Este tipo de arquitetura já fornece um elevado nível de redundância nessa região.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="ec3a6-188">No entanto, tooprotect a carga de trabalho de Olá de uma falha de nível regional, deve considerar propagando-se o cluster de Olá em duas regiões ou efetuar a região de tooanother de cópias de segurança periódica.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-188">However, tooprotect hello workload from a regional level failure, you should consider spreading hello cluster across two regions or making periodic backups tooanother region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="ec3a6-189">Cenário 3: Carga de trabalho de aplicação de IaaS</span><span class="sxs-lookup"><span data-stu-id="ec3a6-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="ec3a6-190">Isto pode ser uma carga de trabalho de produção normal em execução numa VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="ec3a6-191">Por exemplo, poderia ser um servidor web ou um servidor de ficheiro que contém conteúdo Olá e outros recursos de um site.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-191">For example, it could be a web server or file server holding hello content and other resources of a site.</span></span> <span data-ttu-id="ec3a6-192">Também poderia ser uma aplicação de negócio personalizada em execução numa VM que armazenados os respetivos dados, a recursos e o estado da aplicação em discos VM Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on hello VM disks.</span></span> <span data-ttu-id="ec3a6-193">Neste caso, é importante toomake se que efetuar cópias de segurança regulares.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-193">In this case, it is important toomake sure you take backups on a regular basis.</span></span> <span data-ttu-id="ec3a6-194">Frequência de cópia de segurança deve ser baseada no natureza Olá da carga de trabalho do Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-194">Backup frequency should be based on hello nature of hello VM workload.</span></span> <span data-ttu-id="ec3a6-195">Por exemplo, se a aplicação Olá é executado diariamente e modifica dados, em seguida, cópia de segurança de Olá deverão ser executada a cada hora.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-195">For example, if hello application runs every day and modifies data, then hello backup should be taken every hour.</span></span>

<span data-ttu-id="ec3a6-196">Outro exemplo é um servidor de relatórios que retirar dados de outras origens e gera relatórios agregados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="ec3a6-197">Perda desta VM ou discos direciona toohello perda de Olá relatórios.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-197">Loss of this VM or disks will lead toohello loss of hello reports.</span></span> <span data-ttu-id="ec3a6-198">No entanto, poderá ser Olá toorerun possíveis processo e saída de Olá voltar a gerar relatórios.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-198">However, it may be possible toorerun hello reporting process and regenerate hello output.</span></span> <span data-ttu-id="ec3a6-199">Nesse caso, realmente não tem uma perda de dados, mesmo se o servidor de relatórios Olá é acessos com um desastre, pelo que pode ter um nível mais elevado de tolerância de perda de parte dos dados de Olá na Olá servidor de relatórios.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-199">In that case, you don’t really have a loss of data even if hello reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of hello data on hello reporting server.</span></span> <span data-ttu-id="ec3a6-200">Nesse caso, as cópias de segurança menos frequentes é um custo de Olá tooreduce opção.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-200">In that case, less frequent backups is an option tooreduce hello cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="ec3a6-201">Cenário 4: Problemas de dados de aplicação de IaaS</span><span class="sxs-lookup"><span data-stu-id="ec3a6-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="ec3a6-202">Tiver uma aplicação que calcula, mantém e serve de dados comerciais críticos, como obter informações sobre preços.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="ec3a6-203">Uma nova versão da sua aplicação tinha um erro de software que incorretamente calculada Olá preços e danificado dados comércio existentes Olá servidos pela plataforma de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-203">A new version of your application had a software bug which incorrectly computed hello pricing and corrupted hello existing commerce data served by hello platform.</span></span> <span data-ttu-id="ec3a6-204">Aqui, Olá melhor procedimento seria toorevert toohello versão anterior da aplicação Olá e os dados de Olá primeiro.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-204">Here, hello best course of action would be toorevert toohello earlier version of hello application and hello data first.</span></span> <span data-ttu-id="ec3a6-205">tooenable, tome periódica as cópias de segurança do seu sistema.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-205">tooenable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="ec3a6-206">Solução de recuperação após desastre: Serviço de cópia de segurança do Azure</span><span class="sxs-lookup"><span data-stu-id="ec3a6-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="ec3a6-207">[Serviço de cópia de segurança do Azure](https://azure.microsoft.com/services/backup/) é pode ser utilizado para cópia de segurança e DR e funciona com [discos geridos](../../virtual-machines/windows/managed-disks-overview.md) , bem como [discos não gerido](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md) as well as [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span></span> <span data-ttu-id="ec3a6-208">Pode criar uma tarefa de cópia de segurança com políticas de retenção de cópias de segurança, fácil restauro de VM e cópias de segurança baseados no tempo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="ec3a6-209">Se utilizar [discos de armazenamento Premium](storage-premium-storage.md), [discos geridos](../../virtual-machines/windows/managed-disks-overview.md), ou outros tipos de disco com Olá [armazenamento localmente redundante (LRS)](storage-redundancy.md#locally-redundant-storage) opção, é especialmente importante tooleverage cópias de segurança periódicas do DR.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md), or other disk types with hello [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important tooleverage periodic DR backups.</span></span> <span data-ttu-id="ec3a6-210">Cópia de segurança do Azure armazena os dados de Olá no seu Cofre de serviços de recuperação para a retenção de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-210">Azure Backup stores hello data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="ec3a6-211">Escolha Olá [armazenamento georredundante (GRS)](storage-redundancy.md#geo-redundant-storage) opção para o Cofre dos serviços de recuperação de cópia de segurança Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-211">Choose hello [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for hello Backup Recovery Services vault.</span></span> <span data-ttu-id="ec3a6-212">Que irá garantir cópias de segurança são replicadas tooa diferentes região do Azure para salvaguardar de perante desastres regionais.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-212">That will ensure backups are replicated tooa different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="ec3a6-213">Para [discos não gerido](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), pode utilizar o tipo de armazenamento LRS Olá para discos IaaS, mas certifique-se de que a cópia de segurança do Azure está ativada com Olá opção GRS para Olá cofre dos serviços de recuperação.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-213">For [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), you can use hello LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with hello GRS option for hello Recovery Services Vault.</span></span>

<span data-ttu-id="ec3a6-214">**Se utilizar Olá [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) opção para os discos não gerido, que ainda precisa de instantâneos consistentes para cópia de segurança e de DR.**</span><span class="sxs-lookup"><span data-stu-id="ec3a6-214">**If you use hello [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="ec3a6-215">Tem de utilizar um [serviço de cópia de segurança do Azure](https://azure.microsoft.com/services/backup/) ou [instantâneos consistentes](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="ec3a6-216">Olá segue-se um resumo das soluções de DR.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-216">hello following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="ec3a6-217">Cenário</span><span class="sxs-lookup"><span data-stu-id="ec3a6-217">Scenario</span></span> | <span data-ttu-id="ec3a6-218">Replicação automática</span><span class="sxs-lookup"><span data-stu-id="ec3a6-218">Automatic Replication</span></span> | <span data-ttu-id="ec3a6-219">Solução de DR</span><span class="sxs-lookup"><span data-stu-id="ec3a6-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ec3a6-220">*Discos de armazenamento Premium*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="ec3a6-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="ec3a6-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="ec3a6-222">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="ec3a6-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="ec3a6-223">*Managed Disks*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-223">*Managed Disks*</span></span> | <span data-ttu-id="ec3a6-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="ec3a6-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="ec3a6-225">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="ec3a6-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="ec3a6-226">*Discos LRS não gerido*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="ec3a6-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="ec3a6-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="ec3a6-228">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="ec3a6-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="ec3a6-229">*Discos GRS não gerido*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="ec3a6-230">Cruzada região ([GRS](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="ec3a6-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="ec3a6-231">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="ec3a6-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="ec3a6-232">Instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="ec3a6-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="ec3a6-233">*Discos de RA-GRS não gerido*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="ec3a6-234">Cruzada região ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="ec3a6-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="ec3a6-235">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="ec3a6-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="ec3a6-236">Instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="ec3a6-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="ec3a6-237">Elevada disponibilidade melhor pode pelo satisfeito através da utilização de Olá de gerido discos num conjunto de disponibilidade, juntamente com a cópia de segurança do Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-237">High availability can best by met through hello use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="ec3a6-238">Se estiver a utilizar discos não gerido, pode continuar a utilizar a cópia de segurança do Azure para DR.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="ec3a6-239">Se não é possível toouse cópia de segurança do Azure, em seguida, colocar [instantâneos consistentes](#alternative-solution-consistent-snapshots) conforme descrito na secção posterior é uma solução alternativa para cópia de segurança e de DR.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-239">If you are unable toouse Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="ec3a6-240">As opções de elevada disponibilidade, cópia de segurança e DR em níveis de infraestrutura ou de aplicação pode ser representado como abaixo:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="ec3a6-241">*Nível*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-241">*Level*</span></span> | <span data-ttu-id="ec3a6-242">Elevada disponibilidade</span><span class="sxs-lookup"><span data-stu-id="ec3a6-242">High Availability</span></span>   | <span data-ttu-id="ec3a6-243">Cópia de segurança / DR</span><span class="sxs-lookup"><span data-stu-id="ec3a6-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ec3a6-244">*Aplicação*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-244">*Application*</span></span> | <span data-ttu-id="ec3a6-245">SQL Server Always On</span><span class="sxs-lookup"><span data-stu-id="ec3a6-245">SQL Always On</span></span> | <span data-ttu-id="ec3a6-246">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="ec3a6-246">Azure Backup</span></span> |
| <span data-ttu-id="ec3a6-247">*Infraestrutura*</span><span class="sxs-lookup"><span data-stu-id="ec3a6-247">*Infrastructure*</span></span>  | <span data-ttu-id="ec3a6-248">Conjunto de Disponibilidade</span><span class="sxs-lookup"><span data-stu-id="ec3a6-248">Availability Set</span></span>  | <span data-ttu-id="ec3a6-249">GRS com instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="ec3a6-249">GRS with consistent snapshots</span></span> |

### <a name="using-hello-azure-backup-service"></a><span data-ttu-id="ec3a6-250">Utilizar Olá serviço de cópia de segurança do Azure</span><span class="sxs-lookup"><span data-stu-id="ec3a6-250">Using hello Azure Backup Service</span></span>

<span data-ttu-id="ec3a6-251">[Cópia de segurança do Azure](../../backup/backup-azure-vms-introduction.md) pode criar cópias de segurança as VMs do Windows ou Linux toohello Cofre de serviços de recuperação do Azure em execução.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-251">[Azure Backup](../../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux toohello Azure Recovery Services Vault.</span></span> <span data-ttu-id="ec3a6-252">Cópia de segurança e restaurar dados críticos da empresa é complicou pelo facto de Olá dados críticos da empresa tem uma cópia de segurança ao aplicações Olá que produzem Olá dados estão em execução.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-252">Backing up and restoring business-critical data is complicated by hello fact that business-critical data must be backed up while hello applications that produce hello data are running.</span></span> <span data-ttu-id="ec3a6-253">tooaddress, cópia de segurança do Azure fornece cópias de segurança consistentes com aplicações para cargas de trabalho Microsoft com Olá tooensure de serviço de sombra de volumes (VSS) que dados são escritos corretamente toostorage.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-253">tooaddress this, Azure Backup provides application-consistent backups for Microsoft workloads by using hello Volume Shadow Service (VSS) tooensure that data is written correctly toostorage.</span></span> <span data-ttu-id="ec3a6-254">Para VMs com Linux, apenas as cópias de segurança consistente com ficheiros são possíveis, uma vez que o Linux não tem tooVSS equivalente de funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent tooVSS.</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png)   

<span data-ttu-id="ec3a6-255">Quando a cópia de segurança do Azure inicia uma tarefa de cópia de segurança no momento de Olá agendada, aciona Olá cópia de segurança de extensão instaladas no Olá VM tootake um instantâneo de ponto no tempo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-255">When Azure Backup initiates a backup job at hello scheduled time, it triggers hello backup extension installed in hello VM tootake a point-in-time snapshot.</span></span> <span data-ttu-id="ec3a6-256">É obtido um instantâneo em coordenação com VSS tooget um instantâneo consistente de discos de Olá na máquina virtual de Olá sem ter tooshut-lo para baixo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-256">A snapshot is taken in coordination with VSS tooget a consistent snapshot of hello disks in hello virtual machine without having tooshut it down.</span></span> <span data-ttu-id="ec3a6-257">todas as escritas antes de instantâneo consistentes Olá de todos os discos de Olá de limpezas da extensão de cópia de segurança de Olá na Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-257">hello backup extension in hello VM flushes all writes before taking hello consistent snapshot of all hello disks.</span></span> <span data-ttu-id="ec3a6-258">Depois de Olá instantâneo é tirado dados Olá são transferidos pelo Cofre de cópia de segurança toohello cópias de segurança do Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-258">After hello snapshot is taken, hello data is transferred by Azure Backup toohello backup vault.</span></span> <span data-ttu-id="ec3a6-259">toomake Olá cópia de segurança processo mais eficiente, serviço Olá identifica e transfere apenas os blocos de Olá dos dados que foram alterados desde a última cópia de segurança Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-259">toomake hello backup process more efficient, hello service identifies and transfers only hello blocks of data that have changed since hello last backup.</span></span>


<span data-ttu-id="ec3a6-260">toorestore, pode ver Olá disponíveis as cópias de segurança através de cópia de segurança do Azure e, em seguida, iniciar um restauro.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-260">toorestore, you can view hello available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="ec3a6-261">Pode criar e restaurar cópias de segurança do Azure através de Olá [portal do Azure](https://portal.azure.com/), [através do PowerShell](../../backup/backup-azure-vms-automation.md ), ou utilizando Olá [CLI do Azure](https://docs.microsoft.com/azure/xplat-cli-install).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-261">You can create and restore Azure backups through hello [Azure portal](https://portal.azure.com/), [using PowerShell](../../backup/backup-azure-vms-automation.md ), or using hello [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="ec3a6-262">Para obter mais informações, consulte o Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-262">For more information, see Azure Backup.</span></span>

### <a name="steps-tooenable-backup"></a><span data-ttu-id="ec3a6-263">Passos tooEnable cópia de segurança</span><span class="sxs-lookup"><span data-stu-id="ec3a6-263">Steps tooEnable Backup</span></span>

<span data-ttu-id="ec3a6-264">Olá passos seguintes são normalmente utilizados tooenable cópias de segurança das suas VMs através de Olá [Portal do Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-264">hello following steps are typically used tooenable backups of your VMs using hello [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="ec3a6-265">Será algumas variações dependendo do seu cenário exato.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="ec3a6-266">Consulte toohello [cópia de segurança do Azure](../../backup/backup-azure-vms-introduction.md) documentação para obter detalhes completos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-266">Refer toohello [Azure Backup](../../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="ec3a6-267">Azure cópia de segurança também [suporta VMs com discos geridos](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="ec3a6-268">Crie um cofre dos serviços de recuperação para uma VM utilizando Olá os seguintes passos:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-268">Create a recovery services vault for a VM using hello following steps:</span></span>

    <span data-ttu-id="ec3a6-269">a.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-269">a.</span></span>  <span data-ttu-id="ec3a6-270">Utilizar Olá [portal do Azure](https://portal.azure.com/), procurar todos os recursos e localize "Cofres dos serviços de recuperação".</span><span class="sxs-lookup"><span data-stu-id="ec3a6-270">Using hello [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="ec3a6-271">b.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-271">b.</span></span>  <span data-ttu-id="ec3a6-272">No Olá recuperação cofres dos serviços de menu, clique em Adicionar e siga os passos de Olá toocreate um novo cofre Olá mesma região que Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-272">On hello Recovery Services vaults menu, click Add and follow hello steps toocreate a new vault in hello same region as hello VM.</span></span> <span data-ttu-id="ec3a6-273">Por exemplo, se a VM está na região EUA oeste, escolha EUA oeste para o Cofre de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-273">For example, if your VM is in West US region, pick West US for hello vault.</span></span>

2.  <span data-ttu-id="ec3a6-274">Certifique-se a replicação de armazenamento Olá para Olá recém-criado cofre.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-274">Verify hello Storage replication for hello newly created vault.</span></span> <span data-ttu-id="ec3a6-275">toodo esta, o Cofre de Olá acesso partir Olá dos serviços de recuperação cofres painel aceda toohello definições/cópia de segurança e configuração.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-275">toodo this, access hello vault from hello Recovery Services vaults blade and go toohello settings/Backup Configuration.</span></span> <span data-ttu-id="ec3a6-276">Certifique-se de que Olá opção GRS está selecionada por predefinição.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-276">Ensure hello GRS option is selected by default.</span></span> <span data-ttu-id="ec3a6-277">Isto irá garantir que o Cofre é automaticamente replicadas tooa Datacenter secundário.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-277">This will ensure that your vault is automatically replicated tooa secondary data center.</span></span> <span data-ttu-id="ec3a6-278">Por exemplo, o Cofre nos EUA oeste será automaticamente replicada tooEast E.U.A..</span><span class="sxs-lookup"><span data-stu-id="ec3a6-278">For example, your vault in West US will be automatically replicated tooEast US.</span></span>

3.  <span data-ttu-id="ec3a6-279">Configurar a política de cópia de segurança de Olá e selecione Olá VM Olá mesma IU.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-279">Configure hello backup policy and select hello VM from hello same UI.</span></span>

4.  <span data-ttu-id="ec3a6-280">Certifique-se Olá que Olá VM está instalado o agente de cópia de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-280">Make sure hello Backup Agent is installed on hello VM.</span></span> <span data-ttu-id="ec3a6-281">Se a VM é criada utilizando uma imagem de galeria do Azure, agente de cópia de segurança de Olá já está instalado.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-281">If your VM is created using an Azure gallery image, then hello Backup agent is already installed.</span></span> <span data-ttu-id="ec3a6-282">Caso contrário (ou seja, se estiver a utilizar uma imagem personalizada), utilize instruções demasiado[Olá de instalar o agente de VM na máquina virtual de Olá](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-282">Otherwise (that is, if you are using a custom image), use instructions too[Install hello VM Agent on hello virtual machine](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="ec3a6-283">Certifique-se de que Olá VM possibilita a conectividade de rede para Olá toofunction de serviço de cópia de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-283">Make sure that hello VM allows network connectivity for hello backup service toofunction.</span></span> <span data-ttu-id="ec3a6-284">Siga estas instruções para [conectividade de rede](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-284">Follow these instructions for [Network connectivity](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="ec3a6-285">Depois de concluídas Olá os passos acima, a cópia de segurança de Olá será executado em intervalos regulares, conforme especificado na política de cópia de segurança de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-285">Once hello above steps are completed, hello backup will run at regular intervals as specified in hello backup policy.</span></span> <span data-ttu-id="ec3a6-286">Se necessário, pode acionar Olá primeira cópia de segurança manualmente a partir do dashboard do cofre Olá no Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-286">If necessary, you can trigger hello first backup manually from hello vault dashboard on hello Azure portal.</span></span>

<span data-ttu-id="ec3a6-287">Para automatizar Backup do Azure com scripts, consulte demasiado[cmdlets do PowerShell para cópia de segurança VM](../../backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-287">For automating Azure Backup using scripts, please refer too[PowerShell cmdlets for VM backup](../../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="ec3a6-288">Passos de recuperação</span><span class="sxs-lookup"><span data-stu-id="ec3a6-288">Steps for Recovery</span></span>

<span data-ttu-id="ec3a6-289">Se precisar de toorepair ou reconstruir uma VM, pode restaurar Olá VM a partir de qualquer um dos pontos de recuperação de cópia de segurança de Olá no Cofre de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-289">If you need toorepair or rebuild a VM, you can restore hello VM from any of hello backup recovery points in hello vault.</span></span> <span data-ttu-id="ec3a6-290">Existem algumas das diferentes opções para efetuar a recuperação de Olá:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-290">There are a couple of different options for performing hello recovery:</span></span>

1.  <span data-ttu-id="ec3a6-291">Pode criar uma nova VM como uma representação de ponto no tempo da sua VM de cópia de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="ec3a6-292">Pode restaurar Olá discos e, em seguida, utilize o modelo de Olá para Olá VM toocustomize e reconstrução Olá restaurada VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-292">You can restore hello disks and then use hello template for hello VM toocustomize and rebuild hello restored VM.</span></span> 

<span data-ttu-id="ec3a6-293">Consulte as instruções demasiado[máquinas de virtuais do Azure de utilização portal toorestore](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-293">See instructions too[Use Azure portal toorestore virtual machines](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="ec3a6-294">documento de Olá também explica os passos específicos Olá para restaurar a cópia de segurança VMs toohello emparelhado de centro de dados utilizando o seu Cofre de cópia de segurança georredundante Olá maiúsculas e minúsculas de um desastre no Centro de dados principal Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-294">hello document also explains hello specific steps for restoring backed-up VMs toohello paired data center using your geo-redundant backup vault in hello case of a disaster at hello primary data center.</span></span> <span data-ttu-id="ec3a6-295">Nesse caso, a cópia de segurança do Azure utiliza o serviço de computação de Olá da máquina de virtual Olá região secundária toocreate Olá restaurada.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-295">In that case, Azure Backup uses hello Compute service from hello secondary region toocreate hello restored virtual machine.</span></span>

<span data-ttu-id="ec3a6-296">Também pode utilizar o PowerShell para [restaurar uma VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) ou para [criar uma nova VM do restaurada discos](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-296">You can also use PowerShell for [restoring a VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="ec3a6-297">Solução alternativa: Instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="ec3a6-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="ec3a6-298">Se não é possível toouse Olá serviço de cópia de segurança do Azure, pode implementar o seus próprios mecanismo de cópia de segurança através de instantâneos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-298">If you are unable toouse hello Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="ec3a6-299">É mais complicada toocreate instantâneos consistentes para todos os discos utilizados por uma VM e, em seguida, replicar esses região tooanother de instantâneos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-299">It is complicated toocreate consistent snapshots for all disks used by a VM and then replicate those snapshots tooanother region.</span></span> <span data-ttu-id="ec3a6-300">Por este motivo, o Azure considera Olá aproveitamento serviço de cópia de segurança uma opção melhor a criação de uma solução personalizada.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-300">For this reason, Azure considers leveraging hello Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="ec3a6-301">Se utilizar o armazenamento RA-GRS/GRS para discos, os instantâneos são automaticamente replicadas tooa Datacenter secundário.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated tooa secondary data center.</span></span> <span data-ttu-id="ec3a6-302">Se utilizar o armazenamento LRS para discos, será necessário dados de Olá tooreplicate.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-302">If you use LRS storage for disks, you will need tooreplicate hello data yourself.</span></span> <span data-ttu-id="ec3a6-303">Para obter mais informações, consulte [cópia de segurança do Azure discos VM não geridos com instantâneos incrementais](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

<span data-ttu-id="ec3a6-304">Um instantâneo é uma representação de um objeto de um ponto específico no tempo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="ec3a6-305">Um instantâneo será cobrado de faturação para o tamanho de incremental Olá dos dados de Olá contém.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-305">A snapshot will incur billing for hello incremental size of hello data it holds.</span></span> <span data-ttu-id="ec3a6-306">Para obter mais informações, consulte [criar um instantâneo de blob](../blobs/storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-306">For more information, see [Create a blob snapshot](../blobs/storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-hello-vm-is-running"></a><span data-ttu-id="ec3a6-307">Criação de instantâneos ao hello VM está em execução</span><span class="sxs-lookup"><span data-stu-id="ec3a6-307">Creating snapshots while hello VM is running</span></span>

<span data-ttu-id="ec3a6-308">Enquanto pode tirar um instantâneo em qualquer altura, se hello VM está em execução, ainda está a ser transmissão em fluxo toohello discos de dados e instantâneos de Olá podem conter operações parciais que estavam em trânsito.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-308">While you can take a snapshot at any time, if hello VM is running, there is still data being streamed toohello disks, and hello snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="ec3a6-309">Além disso, se existirem vários discos envolvidas, Olá os instantâneos de discos diferentes podem ter ocorrido em alturas diferentes, que significa que estes instantâneos podem não ser coordenados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-309">Also, if there are several disks involved, hello snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="ec3a6-310">Isto é particularmente problemático para os volumes repartidos cujos ficheiros podem estar danificados se a ser efetuadas alterações durante a cópia de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="ec3a6-311">tooavoid nesta situação, processo de cópia de segurança de Olá tem de implementar Olá os seguintes passos:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-311">tooavoid this situation, hello backup process must implement hello following steps:</span></span>

1.  <span data-ttu-id="ec3a6-312">Parar todos os discos de Olá</span><span class="sxs-lookup"><span data-stu-id="ec3a6-312">Freeze all hello disks</span></span>

2.  <span data-ttu-id="ec3a6-313">Esvaziar todos os Olá pendentes escritas</span><span class="sxs-lookup"><span data-stu-id="ec3a6-313">Flush all hello pending writes</span></span>

3.  <span data-ttu-id="ec3a6-314">Em seguida, [criar um instantâneo de blob](../blobs/storage-blob-snapshots.md) para todos os discos de Olá</span><span class="sxs-lookup"><span data-stu-id="ec3a6-314">Then, [create a blob snapshot](../blobs/storage-blob-snapshots.md) for all hello disks</span></span>

<span data-ttu-id="ec3a6-315">Algumas aplicações de Windows como o SQL Server fornecem um mecanismo de cópia de segurança coordenado através de cópias de segurança consistentes com aplicações VSS toocreate.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS toocreate application-consistent backups.</span></span> <span data-ttu-id="ec3a6-316">No Linux, pode utilizar uma ferramenta como fsfreeze para coordenar a discos de Olá, que irão fornecer cópias de segurança consistente com ficheiros, mas não consistentes com aplicações instantâneos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-316">On Linux, you can use a tool like fsfreeze for coordinating hello disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="ec3a6-317">Este processo é complexa, por isso, e deve considerar a utilização [cópia de segurança do Azure](../../backup/backup-azure-vms-introduction.md) ou uma solução de cópia de segurança de terceiros que já proceder a esta.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-317">This process is complicated, so and you should consider using [Azure Backup](../../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="ec3a6-318">Olá acima processo resultará numa coleção de instantâneos coordenadas para todos os discos VM de Olá, que representa uma vista de ponto no tempo específica de Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-318">hello above process will result in a collection of coordinated snapshots for all hello VM disks, representing a specific point-in-time view of hello VM.</span></span> <span data-ttu-id="ec3a6-319">Este é um ponto de restauro de cópia de segurança para Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-319">This is a backup restore point for hello VM.</span></span> <span data-ttu-id="ec3a6-320">Pode repetir o processo de Olá em intervalos agendados toocreate periódica as cópias de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-320">You can repeat hello process at scheduled intervals toocreate periodic backups.</span></span> <span data-ttu-id="ec3a6-321">Consulte abaixo para obter os passos Olá demasiado[região de tooanother de cópias de segurança de Olá cópia](#copy-the-snapshots-to-another-region) para DR.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-321">See below for hello steps too[copy hello backups tooanother region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-hello-vm-is-offline"></a><span data-ttu-id="ec3a6-322">Criação de instantâneos ao hello a VM está offline</span><span class="sxs-lookup"><span data-stu-id="ec3a6-322">Creating snapshots while hello VM is offline</span></span>

<span data-ttu-id="ec3a6-323">Outra opção toocreate consistente cópias de segurança está a encerrar Olá VM e tendo blob instantâneos de cada disco.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-323">Another option toocreate consistent backups is shutting down hello VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="ec3a6-324">Isto é mais fácil de instantâneos em coordenação de uma VM em execução, mas requer alguns minutos de indisponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="ec3a6-325">Para que este processo, siga estes passos:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="ec3a6-326">Encerre Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-326">Shut down hello VM.</span></span>

2. <span data-ttu-id="ec3a6-327">Crie um instantâneo de cada blob VHD, que demora apenas alguns segundos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="ec3a6-328">toocreate um instantâneo, pode utilizar [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), Olá [API de Rest do Storage do Azure](https://msdn.microsoft.com/library/azure/ee691971.aspx), [CLI do Azure](https://docs.microsoft.com/azure/xplat-cli-install), ou um dos Olá bibliotecas de cliente de armazenamento do Azure, tal como [ biblioteca de clientes de armazenamento Olá para .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-328">toocreate a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), hello [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of hello Azure Storage Client Libraries such as [hello Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="ec3a6-329">Inicie Olá VM, que termina o período de indisponibilidade Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-329">Start hello VM, which ends hello downtime.</span></span> <span data-ttu-id="ec3a6-330">Normalmente, o processo completo de Olá conclui dentro de alguns minutos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-330">Typically hello entire process completes within a few minutes.</span></span>

<span data-ttu-id="ec3a6-331">Este processo gera uma coleção de instantâneos consistentes para todos os discos de Olá, fornecer um ponto de restauro de cópia de segurança para Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-331">This process yields a collection of consistent snapshots for all hello disks, providing a backup restore point for hello VM.</span></span> <span data-ttu-id="ec3a6-332">Veja a seguir região tooanother de instantâneos Olá Olá passos toocopy DR.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-332">See below for hello steps toocopy hello snapshots tooanother region for DR.</span></span>

### <a name="copy-hello-snapshots-tooanother-region"></a><span data-ttu-id="ec3a6-333">Copie a região de tooanother Olá instantâneos</span><span class="sxs-lookup"><span data-stu-id="ec3a6-333">Copy hello snapshots tooanother region</span></span>

<span data-ttu-id="ec3a6-334">Não pode ser suficiente para DR a criação de instantâneos de Olá individualmente.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-334">Creation of hello snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="ec3a6-335">Também têm de replicar região de tooanother Olá instantâneo cópias de segurança.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-335">You must also replicate hello snapshot backups tooanother region.</span></span>

<span data-ttu-id="ec3a6-336">Se estiver a utilizar o GRS ou RA-GRS para os discos, em seguida, Olá os instantâneos são região secundária toohello replicadas automaticamente.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-336">If you are using GRS or RA-GRS for your disks, then hello snapshots are replicated toohello secondary region automatically.</span></span> <span data-ttu-id="ec3a6-337">Pode haver alguns minutos do desfasamento antes de replicação de Olá, e se o Datacenter primário Olá ficar inativo antes de instantâneos de Olá concluir a replicação, não será capaz de tooaccess instantâneos de Olá partir do Centro de dados secundária Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-337">There can be a few minutes of lag before hello replication, and if hello primary data center goes down before hello snapshots finish replicating, you will not be able tooaccess hello snapshots from hello secondary data center.</span></span> <span data-ttu-id="ec3a6-338">probabilidade Olá desta situação é pequena.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-338">hello likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="ec3a6-339">Ter apenas discos Olá numa conta GRS ou RA-GRS protege Olá VM contra desastres inesperados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-339">Only having hello disks in a GRS or RA-GRS account does not protect hello VM from disasters.</span></span> <span data-ttu-id="ec3a6-340">Também tem de criar instantâneos coordenados ou utilizar o Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="ec3a6-341">Isto é necessário toorecover num estado consistente de tooa VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-341">This is required toorecover a VM tooa consistent state.</span></span>

<span data-ttu-id="ec3a6-342">Se estiver a utilizar o LRS, tem de copiar conta de armazenamento diferente do Olá instantâneos tooa imediatamente após a criação de um instantâneo de Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-342">If you are using LRS, you must copy hello snapshots tooa different storage account immediately after creating hello snapshot.</span></span> <span data-ttu-id="ec3a6-343">destino de cópia de Olá pode ser uma conta de armazenamento LRS numa região diferente, resultando em cópia de Olá está a ser uma região remota.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-343">hello copy target could be an LRS storage account in a different region, resulting in hello copy being in a remote region.</span></span> <span data-ttu-id="ec3a6-344">Também pode copiar conta de armazenamento do Olá instantâneo tooan RA-GRS no Olá mesma região.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-344">You can also copy hello snapshot tooan RA-GRS storage account in hello same region.</span></span> <span data-ttu-id="ec3a6-345">Neste caso, o instantâneo Olá será toohello lenta replicadas de região secundária remoto.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-345">In this case, hello snapshot will be lazily replicated toohello remote secondary region.</span></span> <span data-ttu-id="ec3a6-346">A cópia de segurança se encontra protegida contra desastres inesperados no site primário Olá depois de copiar Olá e da replicação estar concluída.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-346">Your backup is protected from disasters at hello primary site once hello copying and replication is complete.</span></span>

<span data-ttu-id="ec3a6-347">toocopy o seu incrementais instantâneos do DR rever de forma eficiente, instruções Olá [cópia de segurança do Azure discos VM não geridos com instantâneos incrementais](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-347">toocopy your incremental snapshots for DR efficiently, review hello instructions in [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png)   

### <a name="recovery-from-snapshots"></a><span data-ttu-id="ec3a6-348">Recuperação a partir de instantâneos</span><span class="sxs-lookup"><span data-stu-id="ec3a6-348">Recovery from Snapshots</span></span>

<span data-ttu-id="ec3a6-349">tooretrieve um instantâneo, copie-toomake um blob de novo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-349">tooretrieve a snapshot, copy it toomake a new blob.</span></span> <span data-ttu-id="ec3a6-350">Se estiver a copiar o instantâneo de Olá da conta primária Olá, pode copiar Olá instantâneo através de toohello BLOBs base do instantâneo Olá, assim reverter Olá disco toohello instantâneo; Isto é conhecido como promover instantâneo Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-350">If you are copying hello snapshot from hello primary account, you can copy hello snapshot over toohello base blob of hello snapshot, thus reverting hello disk toohello snapshot; this is known as promoting hello snapshot.</span></span> <span data-ttu-id="ec3a6-351">Se estiver a copiar a cópia de segurança do Olá instantâneo de uma conta secundária (no caso de Olá de RA-GRS), tem de ser copiados conta principal tooa.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-351">If you are copying hello snapshot backup from a secondary account (in hello case of RA-GRS), it must be copied tooa primary account.</span></span> <span data-ttu-id="ec3a6-352">Pode copiar um instantâneo [através do PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) ou utilizando o utilitário do AzCopy Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using hello AzCopy utility.</span></span> <span data-ttu-id="ec3a6-353">Para obter mais informações, consulte [transferir dados com o utilitário de linha de comandos do AzCopy Olá](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-353">For more information, see [Transfer data with hello AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="ec3a6-354">No caso de Olá de VMs com vários discos, tem de copiar todos os instantâneos de Olá que fazem parte do mesmo coordenado de Olá ponto de restauro.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-354">In hello case of VMs with multiple disks, you must copy all hello snapshots that are part of hello same coordinated restore point.</span></span> <span data-ttu-id="ec3a6-355">Depois de copiar os blobs VHD do Olá instantâneos toowritable, pode utilizar Olá blobs toorecreate VM utilizando o modelo de Olá para Olá VM.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-355">Once you copy hello snapshots toowritable VHD blobs, you can use hello blobs toorecreate your VM using hello template for hello VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="ec3a6-356">Outras opções</span><span class="sxs-lookup"><span data-stu-id="ec3a6-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="ec3a6-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="ec3a6-357">SQL Server</span></span>

<span data-ttu-id="ec3a6-358">SQL Server em execução numa VM tem a suas próprias toobackup capacidades incorporadas tooAzure de base de dados do SQL Server armazenamento de BLOBs ou uma partilha de ficheiros.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-358">SQL Server running in a VM has its own built-in capabilities toobackup your SQL Server database tooAzure Blob storage or a file share.</span></span> <span data-ttu-id="ec3a6-359">Se a conta de armazenamento de Olá é GRS ou RA-GRS, pode aceder a essas cópias de segurança no Centro de dados secundária de uma conta de armazenamento Olá no evento Olá de um desastre, com Olá mesmas restrições, como explicado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-359">If hello storage account is GRS or RA-GRS, you can access those backups in hello storage account’s secondary data center in hello event of a disaster, with hello same restrictions as discussed previously.</span></span> <span data-ttu-id="ec3a6-360">Para obter mais informações, consulte [cópia de segurança e restaurar para o SQL Server em Azure Virtual Machines](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="ec3a6-361">Na adição toobackup e restauro, [SQL Server em grupos de disponibilidade Always](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) pode manter réplicas secundárias de bases de dados toogreatly reduzir o tempo de recuperação de desastre Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-361">In addition toobackup and restore, [SQL Server Always On Availability Groups](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases toogreatly reduce hello disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="ec3a6-362">Outras considerações</span><span class="sxs-lookup"><span data-stu-id="ec3a6-362">Other considerations</span></span>

<span data-ttu-id="ec3a6-363">Este artigo foi abordado como toobackup ou tirar instantâneos das suas VMs e recuperação de desastre toosupport os respetivos discos e como toouse esses toorecover.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-363">This article has discussed how toobackup or take snapshots of your VMs and their disks toosupport disaster recovery, and how toouse those toorecover.</span></span> <span data-ttu-id="ec3a6-364">Com o modelo do Azure Resource Manager Olá, muitas pessoas utilizam modelos toocreate as respetivas VMs e outra infraestrutura no Azure.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-364">With hello Azure Resource Manager model, many people use templates toocreate their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="ec3a6-365">Pode utilizar um modelo toocreate uma VM que tenha Olá mesma configuração de cada vez.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-365">You can use a template toocreate a VM that has hello same configuration every time.</span></span> <span data-ttu-id="ec3a6-366">Se utilizar imagens personalizadas para criar as suas VMs, também deve certificar-se de que as imagens estão protegidas através da utilização de um toostore de conta de RA-GRS-los.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account toostore them.</span></span>

<span data-ttu-id="ec3a6-367">Por conseguinte, o processo de cópia de segurança pode ser uma combinação de duas coisas:</span><span class="sxs-lookup"><span data-stu-id="ec3a6-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="ec3a6-368">Dados de cópia de segurança Olá (discos)</span><span class="sxs-lookup"><span data-stu-id="ec3a6-368">Backup hello data (disks)</span></span>
2. <span data-ttu-id="ec3a6-369">Configuração de cópia de segurança Olá (modelos, imagens personalizadas)</span><span class="sxs-lookup"><span data-stu-id="ec3a6-369">Backup hello configuration (templates, custom images)</span></span>

<span data-ttu-id="ec3a6-370">Consoante a opção de cópia de segurança Olá que escolher, poderá ter toohandle Olá de cópia de segurança dados Olá e configuração de Olá ou serviço de cópia de segurança de Olá pode lidar com todo que para si.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-370">Depending on hello backup option you choose, you may have toohandle hello backup of both hello data and hello configuration, or hello backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-hello-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="ec3a6-371">Apêndice - compreender o impacto de Olá do LRS, GRS e RA-GRS</span><span class="sxs-lookup"><span data-stu-id="ec3a6-371">Appendix - Understanding hello impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="ec3a6-372">Para contas de armazenamento do Azure, existem três tipos de redundância de dados que deve considerar relativamente a recuperação após desastre – localmente redundante (LRS), georredundante (GRS), ou ler georredundante com acesso (RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="ec3a6-373">Localmente armazenamento redundante (LRS) mantém três cópias dos dados Olá Olá mesmo centro de dados.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-373">Locally Redundant Storage (LRS) retains three copies of hello data in hello same data center.</span></span> <span data-ttu-id="ec3a6-374">Quando são escritos dados Olá, todos os três cópias são atualizadas antes de sucesso é devolvido toohello chamador, para saber que se são idênticos.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-374">When writing hello data, all three copies are updated before success is returned toohello caller, so you know they are identical.</span></span> <span data-ttu-id="ec3a6-375">O disco se encontra protegido contra falhas locais, uma vez que não é muito provável que todos os três cópias iriam ficar comprometidas em Olá mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at hello same time.</span></span> <span data-ttu-id="ec3a6-376">No caso de Olá do LRS, não há nenhum georredundância para que disco Olá não se encontra protegido contra falhas catastrófica, que podem afetar uma unidade de armazenamento ou centro de dados completo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-376">In hello case of LRS, there is no geo-redundancy, so hello disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="ec3a6-377">Com a GRS e RA-GRS, três cópias dos seus dados são mantidas na região primária Olá (selecionado por si) e, mais três cópias dos seus dados são mantidas numa região secundária correspondente (definida pelo Azure).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-377">With GRS and RA-GRS, three copies of your data are retained in hello primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="ec3a6-378">Por exemplo, se armazenar dados nos EUA oeste, dados de Olá serão replicada tooEast E.U.A..</span><span class="sxs-lookup"><span data-stu-id="ec3a6-378">For example, if you store data in West US, hello data will be replicated tooEast US.</span></span> <span data-ttu-id="ec3a6-379">Isto é feito de forma assíncrona e, existe um pequeno atraso entre atualizações toohello primária e secundária.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-379">This is done asynchronously, and there is a small delay between updates toohello primary and secondary.</span></span> <span data-ttu-id="ec3a6-380">As réplicas dos discos de Olá no site secundário Olá são consistentes numa base por disco (com atraso Olá), mas as réplicas de vários discos de Active Directory poderão não estar sincronizadas **entre si**.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-380">Replicas of hello disks on hello secondary site are consistent on a per-disk basis (with hello delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="ec3a6-381">são necessários toohave réplicas consistente entre múltiplos discos, os instantâneos consistentes.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-381">toohave consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="ec3a6-382">Olá a principal diferença entre GRS e RA-GRS é a que com RA-GRS, pode ler cópia secundário Olá em qualquer altura.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-382">hello main difference between GRS and RA-GRS is that with RA-GRS, you can read hello secondary copy at any time.</span></span> <span data-ttu-id="ec3a6-383">Se existir um problema que compõe dados Olá na região primária Olá inacessível, Olá equipa do Azure faz com que cada acesso de toorestore esforço.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-383">If there is a problem that renders hello data in hello primary region inaccessible, hello Azure team will make every effort toorestore access.</span></span> <span data-ttu-id="ec3a6-384">Enquanto Olá primário está inativo, se tiver ativado o RA-GRS, pode aceder a dados de Olá no Centro de dados secundária Olá.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-384">While hello primary is down, if you have RA-GRS enabled, you can access hello data in hello secondary data center.</span></span> <span data-ttu-id="ec3a6-385">Por conseguinte, se planear tooread da réplica de Olá enquanto Olá primário está inacessível, em seguida, RA-GRS devem ser consideradas.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-385">Therefore, if you plan tooread from hello replica while hello primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="ec3a6-386">Se, fica fora toobe uma interrupção significativa, Olá equipa do Azure pode acionar uma ativação pós-falha georreplicação e alterar Olá primário DNS entradas toopoint toosecondary armazenamento.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-386">If it turns out toobe a significant outage, hello Azure team may trigger a geo-failover and change hello primary DNS entries toopoint toosecondary storage.</span></span> <span data-ttu-id="ec3a6-387">Neste momento, se tiver o GRS ou RA-GRS ativado, pode aceder a dados Olá na região de Olá que utilizado toobe Olá secundário.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-387">At this point, if you have either GRS or RA-GRS enabled, you can access hello data in hello region that used toobe hello secondary.</span></span> <span data-ttu-id="ec3a6-388">Por outras palavras, se a sua conta de armazenamento GRS e não existe um problema, pode aceder armazenamento secundário Olá apenas se não houver uma ativação pós-falha georreplicação.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-388">In other words, if your storage account is GRS and there is a problem, you can access hello secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="ec3a6-389">Para obter mais informações, consulte [que toodo se ocorrer uma falha de armazenamento do Azure](storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="ec3a6-389">For more information, see [What toodo if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="ec3a6-390">Tenha em atenção que a Microsoft controla se ocorrer uma ativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="ec3a6-391">Ativação pós-falha não é controlada por conta de armazenamento, por conseguinte não foi decidido por clientes individuais.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="ec3a6-392">tooimplement recuperação após desastre para as contas de armazenamento específicas ou discos da máquina virtual, tem de utilizar as técnicas de Olá descritas anteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="ec3a6-392">tooimplement Disaster Recovery for specific storage accounts or virtual machine disks, you must use hello techniques described previously in this article.</span></span>
