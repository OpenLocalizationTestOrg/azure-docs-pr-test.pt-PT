---
title: "aaaBest práticas para melhorar o desempenho da utilização do Azure Service Bus | Microsoft Docs"
description: Descreve como toouse desempenho de toooptimize do Service Bus ao comutar mediadas mensagens.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: 52764d227757cbb11246675878933f21685817f1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="d8549-103">Melhores práticas para melhorias de desempenho através de mensagens do Service Bus</span><span class="sxs-lookup"><span data-stu-id="d8549-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="d8549-104">Este artigo descreve como toouse [mensagens do Service Bus do Azure](https://azure.microsoft.com/services/service-bus/) toooptimize desempenho ao trocar as mensagens mediadas.</span><span class="sxs-lookup"><span data-stu-id="d8549-104">This article describes how toouse [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) toooptimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="d8549-105">Olá primeira parte deste tópico descreve os mecanismos de diferentes Olá que são oferecidos toohelp aumento do desempenho.</span><span class="sxs-lookup"><span data-stu-id="d8549-105">hello first part of this topic describes hello different mechanisms that are offered toohelp increase performance.</span></span> <span data-ttu-id="d8549-106">segunda parte do Olá fornece orientações para a forma como toouse Service Bus de forma a que pode oferecer Olá melhor desempenho num determinado cenário.</span><span class="sxs-lookup"><span data-stu-id="d8549-106">hello second part provides guidance on how toouse Service Bus in a way that can offer hello best performance in a given scenario.</span></span>

<span data-ttu-id="d8549-107">Ao longo deste tópico, o termo de Olá "cliente" refere-se tooany entidade que acede ao Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-107">Throughout this topic, hello term "client" refers tooany entity that accesses Service Bus.</span></span> <span data-ttu-id="d8549-108">Um cliente pode levar a função de Olá de um remetente ou um recetor.</span><span class="sxs-lookup"><span data-stu-id="d8549-108">A client can take hello role of a sender or a receiver.</span></span> <span data-ttu-id="d8549-109">termo Olá ". o remetente" é utilizado para um cliente de fila ou um tópico de barramento de serviço que envia mensagens tooa barramento de serviço fila ou um tópico.</span><span class="sxs-lookup"><span data-stu-id="d8549-109">hello term "sender" is used for a Service Bus queue or topic client that sends messages tooa Service Bus queue or topic.</span></span> <span data-ttu-id="d8549-110">termo Olá "recetor" refere-se tooa fila ou a subscrição do cliente do Service Bus que recebe mensagens a partir de uma fila do Service Bus ou uma subscrição.</span><span class="sxs-lookup"><span data-stu-id="d8549-110">hello term "receiver" refers tooa Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="d8549-111">Estas secções apresentam alguns conceitos que o Service Bus utiliza toohelp desempenho de aumento.</span><span class="sxs-lookup"><span data-stu-id="d8549-111">These sections introduce several concepts that Service Bus uses toohelp boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="d8549-112">Protocolos</span><span class="sxs-lookup"><span data-stu-id="d8549-112">Protocols</span></span>
<span data-ttu-id="d8549-113">Permite que os clientes toosend ao Service Bus e receber mensagens através de um dos três protocolos:</span><span class="sxs-lookup"><span data-stu-id="d8549-113">Service Bus enables clients toosend and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="d8549-114">(AMQP) do protocolo de colocação de mensagens de avançadas</span><span class="sxs-lookup"><span data-stu-id="d8549-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="d8549-115">Mensagens (SBMP) do protocolo do Service Bus</span><span class="sxs-lookup"><span data-stu-id="d8549-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="d8549-116">HTTP</span><span class="sxs-lookup"><span data-stu-id="d8549-116">HTTP</span></span>

<span data-ttu-id="d8549-117">AMQP e SBMP são mais eficientes porque sejam mantidas Olá ligação tooService Bus, desde a fábrica de mensagens hello existe.</span><span class="sxs-lookup"><span data-stu-id="d8549-117">AMQP and SBMP are more efficient, because they maintain hello connection tooService Bus as long as hello messaging factory exists.</span></span> <span data-ttu-id="d8549-118">Também implementa a criação de batches e prefetching.</span><span class="sxs-lookup"><span data-stu-id="d8549-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="d8549-119">A menos que explicitamente mencionado, todo o conteúdo deste tópico assume que a utilização Olá AMQP ou SBMP.</span><span class="sxs-lookup"><span data-stu-id="d8549-119">Unless explicitly mentioned, all content in this topic assumes hello use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="d8549-120">Reutilizar fábricas e clientes</span><span class="sxs-lookup"><span data-stu-id="d8549-120">Reusing factories and clients</span></span>
<span data-ttu-id="d8549-121">Cliente do Service Bus objetos, tais como [QueueClient] [ QueueClient] ou [MessageSender][MessageSender], são criados através de um [ MessagingFactory] [ MessagingFactory] objeto, que também fornece gestão interno de ligações.</span><span class="sxs-lookup"><span data-stu-id="d8549-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="d8549-122">Não deve fechar fábricas de mensagens ou fila, tópico, subscrição clientes e depois de enviar uma mensagem e, em seguida, recrie-las quando enviar mensagem de saudação seguinte.</span><span class="sxs-lookup"><span data-stu-id="d8549-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send hello next message.</span></span> <span data-ttu-id="d8549-123">Fechar uma fábrica de mensagens elimina o serviço do Service Bus Olá ligação toohello e uma nova ligação é estabelecida quando recriar fábrica Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-123">Closing a messaging factory deletes hello connection toohello Service Bus service, and a new connection is established when recreating hello factory.</span></span> <span data-ttu-id="d8549-124">Estabelecer que uma ligação é uma operação dispendiosa, que pode evitar utilizando novamente Olá mesmo definições de fábrica e cliente objetos para várias operações.</span><span class="sxs-lookup"><span data-stu-id="d8549-124">Establishing a connection is an expensive operation that you can avoid by re-using hello same factory and client objects for multiple operations.</span></span> <span data-ttu-id="d8549-125">Pode utilizar em segurança Olá [QueueClient] [ QueueClient] objeto para envio de mensagens de operações assíncronas em simultâneo e de vários threads.</span><span class="sxs-lookup"><span data-stu-id="d8549-125">You can safely use hello [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="d8549-126">Operações simultâneas</span><span class="sxs-lookup"><span data-stu-id="d8549-126">Concurrent operations</span></span>
<span data-ttu-id="d8549-127">Efetuar uma operação (enviar, receber, eliminar, etc.) demora algum tempo.</span><span class="sxs-lookup"><span data-stu-id="d8549-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="d8549-128">Neste momento inclui o processamento de Olá da operação de Olá pelo Olá serviço do Service Bus na latência de toohello adição do pedido de Olá e resposta de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-128">This time includes hello processing of hello operation by hello Service Bus service in addition toohello latency of hello request and hello reply.</span></span> <span data-ttu-id="d8549-129">tooincrease Olá diversas operações por hora, operações tem de executar em simultâneo.</span><span class="sxs-lookup"><span data-stu-id="d8549-129">tooincrease hello number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="d8549-130">Pode fazê-lo de várias formas diferentes:</span><span class="sxs-lookup"><span data-stu-id="d8549-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="d8549-131">**Operações assíncronas**: cliente Olá agendas operações através de operações assíncronas.</span><span class="sxs-lookup"><span data-stu-id="d8549-131">**Asynchronous operations**: hello client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="d8549-132">pedido seguinte Olá é iniciado antes de Olá anterior é concluído.</span><span class="sxs-lookup"><span data-stu-id="d8549-132">hello next request is started before hello previous request is completed.</span></span> <span data-ttu-id="d8549-133">Olá segue-se um exemplo de uma operação de envio assíncrono:</span><span class="sxs-lookup"><span data-stu-id="d8549-133">hello following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="d8549-134">Este é um exemplo de uma recepção assíncrona a operação:</span><span class="sxs-lookup"><span data-stu-id="d8549-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="d8549-135">**Várias fábricas**: Olá, todos os clientes (remetentes na adição tooreceivers) que são criados pela mesma fábrica partilha uma ligação TCP.</span><span class="sxs-lookup"><span data-stu-id="d8549-135">**Multiple factories**: all clients (senders in addition tooreceivers) that are created by hello same factory share one TCP connection.</span></span> <span data-ttu-id="d8549-136">o débito de mensagem máximo de Olá é limitado pelo número de Olá de operações que pode seguir esta ligação de TCP.</span><span class="sxs-lookup"><span data-stu-id="d8549-136">hello maximum message throughput is limited by hello number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="d8549-137">débito Olá que pode ser obtido com uma única fábrica varia bastante com vezes reportadas round-trip TCP e tamanho da mensagem.</span><span class="sxs-lookup"><span data-stu-id="d8549-137">hello throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="d8549-138">tooobtain taxas de débito superiores, deve utilizar várias fábricas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-138">tooobtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="d8549-139">Receber modo</span><span class="sxs-lookup"><span data-stu-id="d8549-139">Receive mode</span></span>
<span data-ttu-id="d8549-140">Ao criar um cliente de fila ou a subscrição, pode especificar um modo de receção: *bloqueio observar* ou *receber e eliminar*.</span><span class="sxs-lookup"><span data-stu-id="d8549-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="d8549-141">predefinição de Olá receber modo é [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="d8549-141">hello default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="d8549-142">Durante o funcionamento neste modo, Olá cliente envia um pedido tooreceive uma mensagem do barramento de serviço.</span><span class="sxs-lookup"><span data-stu-id="d8549-142">When operating in this mode, hello client sends a request tooreceive a message from Service Bus.</span></span> <span data-ttu-id="d8549-143">Após ter recebido uma mensagem de saudação cliente Olá, envia uma mensagem de saudação do pedido toocomplete.</span><span class="sxs-lookup"><span data-stu-id="d8549-143">After hello client has received hello message, it sends a request toocomplete hello message.</span></span>

<span data-ttu-id="d8549-144">Quando definir Olá receber modo demasiado[ReceiveAndDelete][ReceiveAndDelete], os dois passos são combinados num único pedido.</span><span class="sxs-lookup"><span data-stu-id="d8549-144">When setting hello receive mode too[ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="d8549-145">Esta reduz Olá global número de operações e pode melhorar o Olá débito global de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-145">This reduces hello overall number of operations, and can improve hello overall message throughput.</span></span> <span data-ttu-id="d8549-146">Este ganhos de desempenho é fornecido em risco de Olá de perda de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-146">This performance gain comes at hello risk of losing messages.</span></span>

<span data-ttu-id="d8549-147">Barramento de serviço não suporta transações para receber e-eliminação de operações.</span><span class="sxs-lookup"><span data-stu-id="d8549-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="d8549-148">Além disso, é necessária para os cenários em que Olá cliente pretende toodefer semântica de bloqueio peek ou [entregues](service-bus-dead-letter-queues.md) uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="d8549-148">In addition, peek-lock semantics are required for any scenarios in which hello client wants toodefer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="d8549-149">A criação de batches de lado do cliente</span><span class="sxs-lookup"><span data-stu-id="d8549-149">Client-side batching</span></span>
<span data-ttu-id="d8549-150">A criação de batches de lado do cliente permite que uma fila ou um tópico cliente toodelay Olá envio de uma mensagem para um determinado período de tempo.</span><span class="sxs-lookup"><span data-stu-id="d8549-150">Client-side batching enables a queue or topic client toodelay hello sending of a message for a certain period of time.</span></span> <span data-ttu-id="d8549-151">Se o cliente de Olá envia mensagens adicionais durante este período de tempo, transmite mensagens hello do batch único.</span><span class="sxs-lookup"><span data-stu-id="d8549-151">If hello client sends additional messages during this time period, it transmits hello messages in a single batch.</span></span> <span data-ttu-id="d8549-152">A criação de batches de lado do cliente também faz com que um toobatch de cliente fila ou a subscrição vários **concluída** pedidos num único pedido.</span><span class="sxs-lookup"><span data-stu-id="d8549-152">Client-side batching also causes a queue or subscription client toobatch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="d8549-153">Só está disponível para criação de batches assíncrona **enviar** e **concluída** operações.</span><span class="sxs-lookup"><span data-stu-id="d8549-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="d8549-154">Operações síncronas são imediatamente enviadas toohello o serviço do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-154">Synchronous operations are immediately sent toohello Service Bus service.</span></span> <span data-ttu-id="d8549-155">Criação de batches não ocorrer para peek ou receber operações nem criação de batches ocorre em clientes.</span><span class="sxs-lookup"><span data-stu-id="d8549-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="d8549-156">Por predefinição, um cliente utiliza um intervalo de lote de 20ms.</span><span class="sxs-lookup"><span data-stu-id="d8549-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="d8549-157">Pode alterar o intervalo de lote Olá por definição Olá [BatchFlushInterval] [ BatchFlushInterval] propriedade antes de criar Olá fábrica de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-157">You can change hello batch interval by setting hello [BatchFlushInterval][BatchFlushInterval] property before creating hello messaging factory.</span></span> <span data-ttu-id="d8549-158">Esta definição afeta todos os clientes que são criados por esta fábrica.</span><span class="sxs-lookup"><span data-stu-id="d8549-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="d8549-159">criação de batches toodisable, defina Olá [BatchFlushInterval] [ BatchFlushInterval] propriedade demasiado**TimeSpan**.</span><span class="sxs-lookup"><span data-stu-id="d8549-159">toodisable batching, set hello [BatchFlushInterval][BatchFlushInterval] property too**TimeSpan.Zero**.</span></span> <span data-ttu-id="d8549-160">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="d8549-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="d8549-161">Criação de batches não afeta o número de Olá de operações de mensagens sujeito a faturação e só está disponível para Olá o protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-161">Batching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="d8549-162">Olá protocolo HTTP não suporta a criação de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-162">hello HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="d8549-163">Acesso à loja de criação de batches</span><span class="sxs-lookup"><span data-stu-id="d8549-163">Batching store access</span></span>
<span data-ttu-id="d8549-164">débito de Olá tooincrease de uma fila, tópico ou subscrição, o Service Bus lotes várias mensagens quando escreve arquivo interno tooits.</span><span class="sxs-lookup"><span data-stu-id="d8549-164">tooincrease hello throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes tooits internal store.</span></span> <span data-ttu-id="d8549-165">Se estiver ativada numa fila ou um tópico, escrever mensagens no arquivo de Olá será possível criar batch.</span><span class="sxs-lookup"><span data-stu-id="d8549-165">If enabled on a queue or topic, writing messages into hello store will be batched.</span></span> <span data-ttu-id="d8549-166">Se estiver ativada num fila ou subscrição, eliminar as mensagens a partir da loja de Olá será possível criar batch.</span><span class="sxs-lookup"><span data-stu-id="d8549-166">If enabled on a queue or subscription, deleting messages from hello store will be batched.</span></span> <span data-ttu-id="d8549-167">Se o acesso à loja de batches é ativado para uma entidade, o Service Bus atrasa uma operação de escrita de arquivo sobre essa entidade pela cópia de segurança too20ms.</span><span class="sxs-lookup"><span data-stu-id="d8549-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up too20ms.</span></span> <span data-ttu-id="d8549-168">Operações de arquivo adicionais que ocorrem durante este intervalo são adicionadas toohello batch.</span><span class="sxs-lookup"><span data-stu-id="d8549-168">Additional store operations that occur during this interval are added toohello batch.</span></span> <span data-ttu-id="d8549-169">Em lotes afeta apenas o arquivo de acesso **enviar** e **concluída** operações; receber operações não são afetadas.</span><span class="sxs-lookup"><span data-stu-id="d8549-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="d8549-170">Acesso à loja de batches é uma propriedade numa entidade.</span><span class="sxs-lookup"><span data-stu-id="d8549-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="d8549-171">Criação de batches ocorre em todas as entidades que permitem acesso à loja de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="d8549-172">Ao criar uma nova fila, tópico ou uma subscrição, o acesso à loja de batches está ativado por predefinição.</span><span class="sxs-lookup"><span data-stu-id="d8549-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="d8549-173">acesso à loja, conjunto Olá em lotes de toodisable [EnableBatchedOperations] [ EnableBatchedOperations] propriedade demasiado**falso** antes de criar a entidade de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-173">toodisable batched store access, set hello [EnableBatchedOperations][EnableBatchedOperations] property too**false** before creating hello entity.</span></span> <span data-ttu-id="d8549-174">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="d8549-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="d8549-175">Acesso à loja de batches não afeta o número de Olá de operações de mensagens sujeito a faturação e é uma propriedade de uma fila, tópico ou uma subscrição.</span><span class="sxs-lookup"><span data-stu-id="d8549-175">Batched store access does not affect hello number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="d8549-176">É independente da Olá receber modo e Olá protocolo que é utilizado entre um cliente e Olá serviço do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-176">It is independent of hello receive mode and hello protocol that is used between a client and hello Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="d8549-177">Prefetching</span><span class="sxs-lookup"><span data-stu-id="d8549-177">Prefetching</span></span>
<span data-ttu-id="d8549-178">Prefetching permite a fila ou a subscrição do cliente tooload adicionais mensagens hello do serviço de Olá quando ele efetuar uma operação de receção.</span><span class="sxs-lookup"><span data-stu-id="d8549-178">Prefetching enables hello queue or subscription client tooload additional messages from hello service when it performs a receive operation.</span></span> <span data-ttu-id="d8549-179">cliente de Olá armazena estas mensagens numa cache local.</span><span class="sxs-lookup"><span data-stu-id="d8549-179">hello client stores these messages in a local cache.</span></span> <span data-ttu-id="d8549-180">o tamanho da cache de Olá Olá é determinado pelo Olá [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] ou [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] Propriedades.</span><span class="sxs-lookup"><span data-stu-id="d8549-180">hello size of hello cache is determined by hello [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="d8549-181">Cada cliente que permitem prefetching mantém a sua própria cache.</span><span class="sxs-lookup"><span data-stu-id="d8549-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="d8549-182">Uma cache não é partilhada entre os clientes.</span><span class="sxs-lookup"><span data-stu-id="d8549-182">A cache is not shared across clients.</span></span> <span data-ttu-id="d8549-183">Se o cliente de Olá inicia uma operação de receção e respetiva cache está vazia, o serviço de Olá transmite um lote de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-183">If hello client initiates a receive operation and its cache is empty, hello service transmits a batch of messages.</span></span> <span data-ttu-id="d8549-184">o tamanho do lote de Olá Olá é igual ao tamanho de Olá da cache de Olá ou 256 KB, que for mais pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-184">hello size of hello batch equals hello size of hello cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="d8549-185">Se o cliente de Olá inicia uma operação de receção e cache Olá contém uma mensagem, mensagem de saudação é obtida a partir da cache de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-185">If hello client initiates a receive operation and hello cache contains a message, hello message is taken from hello cache.</span></span>

<span data-ttu-id="d8549-186">Quando uma mensagem é prefetched, mensagem de saudação de bloqueios serviço do Olá prefetched.</span><span class="sxs-lookup"><span data-stu-id="d8549-186">When a message is prefetched, hello service locks hello prefetched message.</span></span> <span data-ttu-id="d8549-187">Ao fazê-lo, mensagem de saudação prefetched não ser recebida por um recetor diferentes.</span><span class="sxs-lookup"><span data-stu-id="d8549-187">By doing this, hello prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="d8549-188">Se o recetor Olá não é possível concluir a mensagem de saudação antes do bloqueio de Olá, mensagem de saudação torna-se disponíveis tooother recetores.</span><span class="sxs-lookup"><span data-stu-id="d8549-188">If hello receiver cannot complete hello message before hello lock expires, hello message becomes available tooother receivers.</span></span> <span data-ttu-id="d8549-189">cópia de Olá prefetched da mensagem de saudação permanece na cache de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-189">hello prefetched copy of hello message remains in hello cache.</span></span> <span data-ttu-id="d8549-190">Olá recetor que consome Olá expirou em cache cópia irá receber uma exceção quando tenta toocomplete essa mensagem.</span><span class="sxs-lookup"><span data-stu-id="d8549-190">hello receiver that consumes hello expired cached copy will receive an exception when it tries toocomplete that message.</span></span> <span data-ttu-id="d8549-191">Por predefinição, o bloqueio de mensagem de Olá expira após 60 segundos.</span><span class="sxs-lookup"><span data-stu-id="d8549-191">By default, hello message lock expires after 60 seconds.</span></span> <span data-ttu-id="d8549-192">Este valor pode ser expandida too5 minutos.</span><span class="sxs-lookup"><span data-stu-id="d8549-192">This value can be extended too5 minutes.</span></span> <span data-ttu-id="d8549-193">consumo de Olá tooprevent de mensagens expiradas, o tamanho da cache Olá deve ser sempre inferior ao número de Olá de mensagens em fila que pode ser utilizada por um cliente dentro do intervalo de tempo limite de bloqueio de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-193">tooprevent hello consumption of expired messages, hello cache size should always be smaller than hello number of messages that can be consumed by a client within hello lock time-out interval.</span></span>

<span data-ttu-id="d8549-194">Quando utilizar a expiração do bloqueio predefinido Olá de 60 segundos, o valor é uma boa para [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] é 20 vezes Olá máximo as taxas de processamento de todos os recetores do factory Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-194">When using hello default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times hello maximum processing rates of all receivers of hello factory.</span></span> <span data-ttu-id="d8549-195">Por exemplo, uma fábrica cria 3 recetores e cada recetor pode processar segurança too10 mensagens por segundo.</span><span class="sxs-lookup"><span data-stu-id="d8549-195">For example, a factory creates 3 receivers, and each receiver can process up too10 messages per second.</span></span> <span data-ttu-id="d8549-196">Contagem de obtenção prévia Olá não deve exceder 20 X 3, 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="d8549-196">hello prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="d8549-197">Por predefinição, [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] é too0 conjunto, o que significa que não existem mensagens adicionais são recuperadas do serviço de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set too0, which means that no additional messages are fetched from hello service.</span></span>

<span data-ttu-id="d8549-198">Prefetching mensagens aumenta Olá débito global para uma fila ou a subscrição porque esta reduz Olá global número de operações de mensagem ou ida e volta.</span><span class="sxs-lookup"><span data-stu-id="d8549-198">Prefetching messages increases hello overall throughput for a queue or subscription because it reduces hello overall number of message operations, or round trips.</span></span> <span data-ttu-id="d8549-199">Obter a mensagem de saudação primeiro, no entanto, irá demorar mais tempo (devido toohello aumentada o tamanho da mensagem).</span><span class="sxs-lookup"><span data-stu-id="d8549-199">Fetching hello first message, however, will take longer (due toohello increased message size).</span></span> <span data-ttu-id="d8549-200">Receber mensagens prefetched irá ser mais rápida porque estas mensagens já foram transferidas pelo cliente de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-200">Receiving prefetched messages will be faster because these messages have already been downloaded by hello client.</span></span>

<span data-ttu-id="d8549-201">Olá time-to-live (TTL) propriedade de uma mensagem está marcada pelo servidor Olá momento Olá servidor Olá envia o cliente de toohello Olá mensagem.</span><span class="sxs-lookup"><span data-stu-id="d8549-201">hello time-to-live (TTL) property of a message is checked by hello server at hello time hello server sends hello message toohello client.</span></span> <span data-ttu-id="d8549-202">cliente de Olá não verificar a propriedade TTL da mensagem de saudação quando é recebida a mensagem de saudação.</span><span class="sxs-lookup"><span data-stu-id="d8549-202">hello client does not check hello message’s TTL property when hello message is received.</span></span> <span data-ttu-id="d8549-203">Em vez disso, a mensagem de saudação pode ser recebida, mesmo se o TTL da mensagem de saudação passou enquanto a mensagem de saudação foi colocado em cache pelo cliente de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-203">Instead, hello message can be received even if hello message’s TTL has passed while hello message was cached by hello client.</span></span>

<span data-ttu-id="d8549-204">Prefetching não afeta o número de Olá de operações de mensagens sujeito a faturação e só está disponível para Olá o protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-204">Prefetching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="d8549-205">Olá protocolo HTTP não suporta prefetching.</span><span class="sxs-lookup"><span data-stu-id="d8549-205">hello HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="d8549-206">Prefetching está disponível para operações síncronas e assíncronas recebem operações.</span><span class="sxs-lookup"><span data-stu-id="d8549-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="d8549-207">Express filas e tópicos</span><span class="sxs-lookup"><span data-stu-id="d8549-207">Express queues and topics</span></span>

<span data-ttu-id="d8549-208">Entidades expressas ativar cenários de latência reduzidos e débito alto e são suportadas apenas no escalão de serviço de mensagens Standard Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in hello Standard messaging tier.</span></span> <span data-ttu-id="d8549-209">Entidades criadas numa [espaços de nomes Premium](service-bus-premium-messaging.md) não suportam a opção rápida Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support hello express option.</span></span> <span data-ttu-id="d8549-210">Com entidades expressas, se é enviada uma mensagem de fila de tooa ou um tópico, mensagem de saudação não será imediatamente armazenada no arquivo de mensagens hello.</span><span class="sxs-lookup"><span data-stu-id="d8549-210">With express entities, if a message is sent tooa queue or topic, hello message is not immediately stored in hello messaging store.</span></span> <span data-ttu-id="d8549-211">Em vez disso, este é colocado em cache na memória.</span><span class="sxs-lookup"><span data-stu-id="d8549-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="d8549-212">Se uma mensagem permanece na fila de Olá por mais do que alguns segundos, automaticamente, é escrito armazenamento toostable, deste modo, a proteger contra a perda de devido a indisponibilidade de tooan.</span><span class="sxs-lookup"><span data-stu-id="d8549-212">If a message remains in hello queue for more than a few seconds, it is automatically written toostable storage, thus protecting it against loss due tooan outage.</span></span> <span data-ttu-id="d8549-213">Armazenamento na mensagem de saudação do tempo de Olá escrita de mensagem de saudação para uma cache de memória aumenta o débito e reduz a latência porque não há nenhum toostable de acesso é enviado.</span><span class="sxs-lookup"><span data-stu-id="d8549-213">Writing hello message into a memory cache increases throughput and reduces latency because there is no access toostable storage at hello time hello message is sent.</span></span> <span data-ttu-id="d8549-214">As mensagens que são consumidas dentro de alguns segundos não são escritas toohello arquivo de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-214">Messages that are consumed within a few seconds are not written toohello messaging store.</span></span> <span data-ttu-id="d8549-215">Olá seguinte exemplo cria um tópico rápido.</span><span class="sxs-lookup"><span data-stu-id="d8549-215">hello following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="d8549-216">Se uma mensagem que contém informações críticas que não devem ser perdidas é enviada entidade rápida tooan, remetente Olá pode forçar o Service Bus tooimmediately manter o armazenamento de toostable Olá mensagem por definição Olá [ForcePersistence] [ ForcePersistence] propriedade demasiado**verdadeiro**.</span><span class="sxs-lookup"><span data-stu-id="d8549-216">If a message containing critical information that must not be lost is sent tooan express entity, hello sender can force Service Bus tooimmediately persist hello message toostable storage by setting hello [ForcePersistence][ForcePersistence] property too**true**.</span></span>

> [!NOTE]
> <span data-ttu-id="d8549-217">Entidades expressas não suporta transações.</span><span class="sxs-lookup"><span data-stu-id="d8549-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="d8549-218">Utilização de filas particionadas ou tópicos</span><span class="sxs-lookup"><span data-stu-id="d8549-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="d8549-219">Internamente, o Service Bus utiliza Olá mesmo nó de mensagens e arquivo tooprocess e armazenar todas as mensagens de uma entidade de mensagens (fila ou um tópico).</span><span class="sxs-lookup"><span data-stu-id="d8549-219">Internally, Service Bus uses hello same node and messaging store tooprocess and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="d8549-220">Uma fila particionada ou um tópico, no Olá por outro lado, é distribuído por vários nós e arquivos de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-220">A partitioned queue or topic, on hello other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="d8549-221">Particionada filas e tópicos não só produzem um débito mais elevado do que o regulares filas e tópicos, estes também apresentem um disponibilidade superior.</span><span class="sxs-lookup"><span data-stu-id="d8549-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="d8549-222">toocreate uma entidade particionada, conjunto Olá [EnablePartitioning] [ EnablePartitioning] propriedade demasiado**verdadeiro**, conforme mostrado no seguinte exemplo de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-222">toocreate a partitioned entity, set hello [EnablePartitioning][EnablePartitioning] property too**true**, as shown in hello following example.</span></span> <span data-ttu-id="d8549-223">Para obter mais informações sobre entidades particionadas, consulte [entidades de mensagens Particionadas][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="d8549-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="d8549-224">Utilização de várias filas</span><span class="sxs-lookup"><span data-stu-id="d8549-224">Use of multiple queues</span></span>

<span data-ttu-id="d8549-225">Se não for possível toouse esperada uma fila particionada ou tópico ou Olá carga não pode ser processada por um único fila particionada ou um tópico, tem de utilizar várias entidades de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-225">If it is not possible toouse a partitioned queue or topic, or hello expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="d8549-226">Ao utilizar várias entidades, criar um cliente dedicado para cada entidade, em vez de utilizar Olá mesmo cliente para todas as entidades.</span><span class="sxs-lookup"><span data-stu-id="d8549-226">When using multiple entities, create a dedicated client for each entity, instead of using hello same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="d8549-227">Desenvolvimento e teste de funcionalidades</span><span class="sxs-lookup"><span data-stu-id="d8549-227">Development and testing features</span></span>

<span data-ttu-id="d8549-228">Barramento de serviço possui uma funcionalidade que é utilizada especificamente para o desenvolvimento que **nunca deve ser utilizado em configurações de produção**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="d8549-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="d8549-229">Quando novas regras ou filtros são adicionados toohello tópico, pode utilizar [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify Olá nova expressão de filtro está a funcionar conforme esperado.</span><span class="sxs-lookup"><span data-stu-id="d8549-229">When new rules or filters are added toohello topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify that hello new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="d8549-230">Cenários</span><span class="sxs-lookup"><span data-stu-id="d8549-230">Scenarios</span></span>
<span data-ttu-id="d8549-231">Olá secções seguintes descrevem cenários típicos de mensagens e descrevem as definições de Service Bus Olá preferido.</span><span class="sxs-lookup"><span data-stu-id="d8549-231">hello following sections describe typical messaging scenarios and outline hello preferred Service Bus settings.</span></span> <span data-ttu-id="d8549-232">Taxas de débito são classificadas como pequenos (menos 1 mensagem por segundo), moderada (1 mensagem por segundo ou superior, mas inferior a 100 mensagens por segundo) e a elevada (100 mensagens/segundo ou superior).</span><span class="sxs-lookup"><span data-stu-id="d8549-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="d8549-233">Olá número de clientes que está classificado como pequena moderada (5 ou menos), (mais de 5, mas inferior a ou igual too20) e grande (mais do que 20).</span><span class="sxs-lookup"><span data-stu-id="d8549-233">hello number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal too20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="d8549-234">Fila de débito elevado</span><span class="sxs-lookup"><span data-stu-id="d8549-234">High-throughput queue</span></span>
<span data-ttu-id="d8549-235">Objetivo: Maximize o débito de Olá de uma fila única.</span><span class="sxs-lookup"><span data-stu-id="d8549-235">Goal: Maximize hello throughput of a single queue.</span></span> <span data-ttu-id="d8549-236">número de Olá de remetentes e os recetores é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-236">hello number of senders and receivers is small.</span></span>

* <span data-ttu-id="d8549-237">Utilize uma fila de mensagens particionada para um melhor desempenho e disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d8549-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="d8549-238">Olá tooincrease geral taxa de envio na fila de Olá, utilize vários remetentes de toocreate de fábricas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-238">tooincrease hello overall send rate into hello queue, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="d8549-239">Para cada remetente, utilize operações assíncronas ou de vários threads.</span><span class="sxs-lookup"><span data-stu-id="d8549-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="d8549-240">Olá tooincrease geral receber taxa da fila de Olá, utilize vários recetores de toocreate de fábricas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-240">tooincrease hello overall receive rate from hello queue, use multiple message factories toocreate receivers.</span></span>
* <span data-ttu-id="d8549-241">Utilize a vantagem de tootake operações assíncronas do lado do cliente de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-241">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="d8549-242">Definir Olá intervalo too50ms tooreduce Olá número as transmissões de protocolo de cliente do Service Bus de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-242">Set hello batching interval too50ms tooreduce hello number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="d8549-243">Se forem utilizados várias os remetentes, aumente Olá too100ms de intervalo de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-243">If multiple senders are used, increase hello batching interval too100ms.</span></span>
* <span data-ttu-id="d8549-244">Deixe o acesso de arquivo de batches ativado.</span><span class="sxs-lookup"><span data-stu-id="d8549-244">Leave batched store access enabled.</span></span> <span data-ttu-id="d8549-245">Isto aumenta Olá geral taxa a que as mensagens podem ser escritas na fila de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-245">This increases hello overall rate at which messages can be written into hello queue.</span></span>
* <span data-ttu-id="d8549-246">Defina as horas de too20 de contagem de obtenção prévia Olá taxas de processamento máximo Olá de todos os recetores de uma fábrica.</span><span class="sxs-lookup"><span data-stu-id="d8549-246">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="d8549-247">Isto reduz o número de Olá de transmissões de protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-247">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="d8549-248">Várias filas de débito elevado</span><span class="sxs-lookup"><span data-stu-id="d8549-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="d8549-249">Objetivo: Maximize o débito global de várias filas.</span><span class="sxs-lookup"><span data-stu-id="d8549-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="d8549-250">débito de Olá de uma fila individuais é moderada ou elevada.</span><span class="sxs-lookup"><span data-stu-id="d8549-250">hello throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="d8549-251">o débito máximo tooobtain distribuídos por várias filas, utilize as definições de Olá descritos débito de Olá toomaximize de uma fila única.</span><span class="sxs-lookup"><span data-stu-id="d8549-251">tooobtain maximum throughput across multiple queues, use hello settings outlined toomaximize hello throughput of a single queue.</span></span> <span data-ttu-id="d8549-252">Além disso, utilize fábricas diferentes toocreate clientes enviar ou recebem as filas diferentes.</span><span class="sxs-lookup"><span data-stu-id="d8549-252">In addition, use different factories toocreate clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="d8549-253">Fila de latência baixa</span><span class="sxs-lookup"><span data-stu-id="d8549-253">Low latency queue</span></span>
<span data-ttu-id="d8549-254">Objetivo: Minimize a latência de ponto a ponto de uma fila ou tópico.</span><span class="sxs-lookup"><span data-stu-id="d8549-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="d8549-255">número de Olá de remetentes e os recetores é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-255">hello number of senders and receivers is small.</span></span> <span data-ttu-id="d8549-256">débito de Olá da fila de Olá é pequeno ou moderada.</span><span class="sxs-lookup"><span data-stu-id="d8549-256">hello throughput of hello queue is small or moderate.</span></span>

* <span data-ttu-id="d8549-257">Utilize uma fila particionada para disponibilidade melhorada.</span><span class="sxs-lookup"><span data-stu-id="d8549-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="d8549-258">Desative a criação de batches do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="d8549-258">Disable client-side batching.</span></span> <span data-ttu-id="d8549-259">cliente de Olá imediatamente envia uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="d8549-259">hello client immediately sends a message.</span></span>
* <span data-ttu-id="d8549-260">Desative o acesso à loja de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-260">Disable batched store access.</span></span> <span data-ttu-id="d8549-261">serviço de Olá escreve imediatamente o arquivo de toohello Olá mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-261">hello service immediately writes hello message toohello store.</span></span>
* <span data-ttu-id="d8549-262">Se utilizar um único cliente, defina Olá obtenção prévia contagem too20 vezes Olá taxa de processamento do recetor Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-262">If using a single client, set hello prefetch count too20 times hello processing rate of hello receiver.</span></span> <span data-ttu-id="d8549-263">Se várias mensagens chegam a fila de Olá em Olá mesmo tempo, Olá o protocolo de cliente do Service Bus transmite-os, todos num Olá mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="d8549-263">If multiple messages arrive at hello queue at hello same time, hello Service Bus client protocol transmits them all at hello same time.</span></span> <span data-ttu-id="d8549-264">Quando o cliente de Olá recebe a mensagem seguinte Olá, essa mensagem já se encontra na cache local Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-264">When hello client receives hello next message, that message is already in hello local cache.</span></span> <span data-ttu-id="d8549-265">cache de Olá deve ser pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-265">hello cache should be small.</span></span>
* <span data-ttu-id="d8549-266">Se utilizar vários clientes, defina too0 de contagem de obtenção prévia Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-266">If using multiple clients, set hello prefetch count too0.</span></span> <span data-ttu-id="d8549-267">Ao fazê-lo, o cliente segundo Olá pode receber mensagem de saudação segundo enquanto cliente primeiro Olá ainda está a processar mensagem de saudação primeiro.</span><span class="sxs-lookup"><span data-stu-id="d8549-267">By doing this, hello second client can receive hello second message while hello first client is still processing hello first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="d8549-268">Fila com um grande número de remetentes de</span><span class="sxs-lookup"><span data-stu-id="d8549-268">Queue with a large number of senders</span></span>
<span data-ttu-id="d8549-269">Objetivo: Maximize o débito de uma fila ou um tópico com um grande número de remetentes.</span><span class="sxs-lookup"><span data-stu-id="d8549-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="d8549-270">Cada remetente envia mensagens com uma velocidade de moderada.</span><span class="sxs-lookup"><span data-stu-id="d8549-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="d8549-271">número de Olá de recetores é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-271">hello number of receivers is small.</span></span>

<span data-ttu-id="d8549-272">O Service Bus permite cópias de segurança too1000 ligações simultâneas tooa entidades de mensagens (ou 5000 através de AMQP).</span><span class="sxs-lookup"><span data-stu-id="d8549-272">Service Bus enables up too1000 concurrent connections tooa messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="d8549-273">Este limite é aplicado ao nível do espaço de nomes de Olá, e tópicos/filas/subscrições são limitadas pelo limite Olá de ligações em simultâneo por espaço de nomes.</span><span class="sxs-lookup"><span data-stu-id="d8549-273">This limit is enforced at hello namespace level, and queues/topics/subscriptions are capped by hello limit of concurrent connections per namespace.</span></span> <span data-ttu-id="d8549-274">Para as filas, este número é partilhado entre os remetentes e os recetores.</span><span class="sxs-lookup"><span data-stu-id="d8549-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="d8549-275">Se a todas as ligações de 1000 são necessárias para os remetentes, deve substituir fila Olá com um tópico e uma única subscrição.</span><span class="sxs-lookup"><span data-stu-id="d8549-275">If all 1000 connections are required for senders, you should replace hello queue with a topic and a single subscription.</span></span> <span data-ttu-id="d8549-276">Um tópico aceita segurança too1000 ligações simultâneas de remetentes, enquanto que a subscrição de Olá aceita um ligações simultâneas de 1000 adicionais de recetores.</span><span class="sxs-lookup"><span data-stu-id="d8549-276">A topic accepts up too1000 concurrent connections from senders, whereas hello subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="d8549-277">Se forem necessários mais de 1000 remetentes em simultâneo, os remetentes de Olá devem enviar mensagens toohello protocolo de Service Bus através de HTTP.</span><span class="sxs-lookup"><span data-stu-id="d8549-277">If more than 1000 concurrent senders are required, hello senders should send messages toohello Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="d8549-278">débito toomaximize, Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="d8549-278">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="d8549-279">Utilize uma fila de mensagens particionada para um melhor desempenho e disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d8549-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="d8549-280">Se o remetente de cada um reside num processo diferente, utilize apenas uma único fábrica por processo.</span><span class="sxs-lookup"><span data-stu-id="d8549-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="d8549-281">Utilize a vantagem de tootake operações assíncronas do lado do cliente de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-281">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="d8549-282">Utilize predefinição de Olá criação de batches de intervalo de 20ms tooreduce Olá número as transmissões de protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-282">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="d8549-283">Deixe o acesso de arquivo de batches ativado.</span><span class="sxs-lookup"><span data-stu-id="d8549-283">Leave batched store access enabled.</span></span> <span data-ttu-id="d8549-284">Isto aumenta Olá geral taxa a que as mensagens podem ser escritas na fila Olá ou um tópico.</span><span class="sxs-lookup"><span data-stu-id="d8549-284">This increases hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="d8549-285">Defina as horas de too20 de contagem de obtenção prévia Olá taxas de processamento máximo Olá de todos os recetores de uma fábrica.</span><span class="sxs-lookup"><span data-stu-id="d8549-285">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="d8549-286">Isto reduz o número de Olá de transmissões de protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-286">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="d8549-287">Fila com um grande número de recetores</span><span class="sxs-lookup"><span data-stu-id="d8549-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="d8549-288">Objetivo: Maximizar Olá receber a taxa de uma fila ou a subscrição com um grande número de recetores.</span><span class="sxs-lookup"><span data-stu-id="d8549-288">Goal: Maximize hello receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="d8549-289">Cada recetor recebe mensagens de uma taxa moderada.</span><span class="sxs-lookup"><span data-stu-id="d8549-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="d8549-290">número de Olá de remetentes é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-290">hello number of senders is small.</span></span>

<span data-ttu-id="d8549-291">O Service Bus permite cópias de segurança Entidade de tooan too1000 ligações em simultâneo.</span><span class="sxs-lookup"><span data-stu-id="d8549-291">Service Bus enables up too1000 concurrent connections tooan entity.</span></span> <span data-ttu-id="d8549-292">Se uma fila precisar de mais de 1000 recetores, deve substituir fila Olá com um tópico e várias subscrições.</span><span class="sxs-lookup"><span data-stu-id="d8549-292">If a queue requires more than 1000 receivers, you should replace hello queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="d8549-293">Cada subscrição pode suportar cópias de segurança too1000 de ligações em simultâneo.</span><span class="sxs-lookup"><span data-stu-id="d8549-293">Each subscription can support up too1000 concurrent connections.</span></span> <span data-ttu-id="d8549-294">Em alternativa, recetores podem aceder a fila de Olá através de Olá protocolo HTTP.</span><span class="sxs-lookup"><span data-stu-id="d8549-294">Alternatively, receivers can access hello queue via hello HTTP protocol.</span></span>

<span data-ttu-id="d8549-295">débito toomaximize, Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="d8549-295">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="d8549-296">Utilize uma fila de mensagens particionada para um melhor desempenho e disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d8549-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="d8549-297">Se cada recetor reside num processo diferente, utilize apenas uma único fábrica por processo.</span><span class="sxs-lookup"><span data-stu-id="d8549-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="d8549-298">Recetores podem utilizar operações síncronas ou assíncronas.</span><span class="sxs-lookup"><span data-stu-id="d8549-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="d8549-299">Olá moderada fornecido receber taxa de um recetor individuais, do lado do cliente de lotes de um pedido de conclusão não afetam o débito do recetor.</span><span class="sxs-lookup"><span data-stu-id="d8549-299">Given hello moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="d8549-300">Deixe o acesso de arquivo de batches ativado.</span><span class="sxs-lookup"><span data-stu-id="d8549-300">Leave batched store access enabled.</span></span> <span data-ttu-id="d8549-301">Esta reduz Olá carga geral da entidade de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-301">This reduces hello overall load of hello entity.</span></span> <span data-ttu-id="d8549-302">Também reduz Olá geral taxa a que as mensagens podem ser escritas na fila Olá ou um tópico.</span><span class="sxs-lookup"><span data-stu-id="d8549-302">It also reduces hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="d8549-303">Defina o valor de tooa de contagem de obtenção prévia do Olá pequeno (por exemplo, PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="d8549-303">Set hello prefetch count tooa small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="d8549-304">Isto impede que recetores inatividade enquanto outros recetores têm de grandes quantidades de mensagens colocadas em cache.</span><span class="sxs-lookup"><span data-stu-id="d8549-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="d8549-305">Tópico com um pequeno número de subscrições</span><span class="sxs-lookup"><span data-stu-id="d8549-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="d8549-306">Objetivo: Maximize o débito de Olá de um tópico com um pequeno número de subscrições.</span><span class="sxs-lookup"><span data-stu-id="d8549-306">Goal: Maximize hello throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="d8549-307">Uma mensagem é recebida por várias subscrições, que significa Olá combinado receber taxa através de todas as subscrições é maior do que a velocidade de envio de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-307">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is larger than hello send rate.</span></span> <span data-ttu-id="d8549-308">número de Olá de remetentes é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-308">hello number of senders is small.</span></span> <span data-ttu-id="d8549-309">número de Olá de recetores por subscrição é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-309">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="d8549-310">débito toomaximize, Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="d8549-310">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="d8549-311">Utilize um tópico particionado para um melhor desempenho e disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d8549-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="d8549-312">Olá tooincrease geral taxa de envio para o tópico Olá, utilize vários remetentes de toocreate de fábricas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-312">tooincrease hello overall send rate into hello topic, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="d8549-313">Para cada remetente, utilize operações assíncronas ou de vários threads.</span><span class="sxs-lookup"><span data-stu-id="d8549-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="d8549-314">Olá tooincrease geral taxa de receção de uma subscrição, utilize vários recetores de toocreate de fábricas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="d8549-314">tooincrease hello overall receive rate from a subscription, use multiple message factories toocreate receivers.</span></span> <span data-ttu-id="d8549-315">Para cada recetor, utilize operações assíncronas ou de vários threads.</span><span class="sxs-lookup"><span data-stu-id="d8549-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="d8549-316">Utilize a vantagem de tootake operações assíncronas do lado do cliente de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-316">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="d8549-317">Utilize predefinição de Olá criação de batches de intervalo de 20ms tooreduce Olá número as transmissões de protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-317">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="d8549-318">Deixe o acesso de arquivo de batches ativado.</span><span class="sxs-lookup"><span data-stu-id="d8549-318">Leave batched store access enabled.</span></span> <span data-ttu-id="d8549-319">Isto aumenta Olá geral taxa a que as mensagens podem ser escritas no tópico Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-319">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="d8549-320">Defina as horas de too20 de contagem de obtenção prévia Olá taxas de processamento máximo Olá de todos os recetores de uma fábrica.</span><span class="sxs-lookup"><span data-stu-id="d8549-320">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="d8549-321">Isto reduz o número de Olá de transmissões de protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-321">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="d8549-322">Tópico com um grande número de subscrições</span><span class="sxs-lookup"><span data-stu-id="d8549-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="d8549-323">Objetivo: Maximize o débito de Olá de um tópico com um grande número de subscrições.</span><span class="sxs-lookup"><span data-stu-id="d8549-323">Goal: Maximize hello throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="d8549-324">Uma mensagem é recebida por várias subscrições, que significa Olá combinado receber taxa através de todas as subscrições é muito maior do que a velocidade de envio de Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-324">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is much larger than hello send rate.</span></span> <span data-ttu-id="d8549-325">número de Olá de remetentes é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-325">hello number of senders is small.</span></span> <span data-ttu-id="d8549-326">número de Olá de recetores por subscrição é pequeno.</span><span class="sxs-lookup"><span data-stu-id="d8549-326">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="d8549-327">Tópicos com um grande número de subscrições expõem normalmente um débito global baixo se todas as mensagens são encaminhadas tooall subscrições.</span><span class="sxs-lookup"><span data-stu-id="d8549-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed tooall subscriptions.</span></span> <span data-ttu-id="d8549-328">Isto é provocado pelo facto de Olá que cada mensagem é recebida demasiadas vezes e todas as mensagens que estão contidas num tópico e todas as respetivas subscrições são armazenadas no Olá mesmo arquivo.</span><span class="sxs-lookup"><span data-stu-id="d8549-328">This is caused by hello fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in hello same store.</span></span> <span data-ttu-id="d8549-329">Presume-se que são pequenos número de Olá de remetentes e número de recetores por subscrição.</span><span class="sxs-lookup"><span data-stu-id="d8549-329">It is assumed that hello number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="d8549-330">Service Bus suporta até too2, 000 subscrições por tópico.</span><span class="sxs-lookup"><span data-stu-id="d8549-330">Service Bus supports up too2,000 subscriptions per topic.</span></span>

<span data-ttu-id="d8549-331">débito toomaximize, Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="d8549-331">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="d8549-332">Utilize um tópico particionado para um melhor desempenho e disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d8549-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="d8549-333">Utilize a vantagem de tootake operações assíncronas do lado do cliente de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="d8549-333">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="d8549-334">Utilize predefinição de Olá criação de batches de intervalo de 20ms tooreduce Olá número as transmissões de protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-334">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="d8549-335">Deixe o acesso de arquivo de batches ativado.</span><span class="sxs-lookup"><span data-stu-id="d8549-335">Leave batched store access enabled.</span></span> <span data-ttu-id="d8549-336">Isto aumenta Olá geral taxa a que as mensagens podem ser escritas no tópico Olá.</span><span class="sxs-lookup"><span data-stu-id="d8549-336">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="d8549-337">Defina as Olá obtenção prévia contagem too20 horas Olá esperado receber taxa em segundos.</span><span class="sxs-lookup"><span data-stu-id="d8549-337">Set hello prefetch count too20 times hello expected receive rate in seconds.</span></span> <span data-ttu-id="d8549-338">Isto reduz o número de Olá de transmissões de protocolo de cliente do Service Bus.</span><span class="sxs-lookup"><span data-stu-id="d8549-338">This reduces hello number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d8549-339">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="d8549-339">Next steps</span></span>
<span data-ttu-id="d8549-340">toolearn mais informações sobre a otimizar o desempenho do Service Bus, consulte [entidades de mensagens Particionadas][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="d8549-340">toolearn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing
