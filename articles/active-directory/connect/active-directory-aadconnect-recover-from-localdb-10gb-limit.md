---
title: 'O Azure AD Connect: Como toorecover da LocalDB 10GB limitar problema | Microsoft Docs'
description: "Este tópico descreve como toorecover sincronização do Azure AD Connect do serviço quando encontra LocalDB 10GB limitar o problema."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 7b8ce6e19b68837639017bb0315eda4b924d525a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-how-toorecover-from-localdb-10-gb-limit"></a><span data-ttu-id="c251c-103">O Azure AD Connect: Como toorecover do limite de 10 GB LocalDB</span><span class="sxs-lookup"><span data-stu-id="c251c-103">Azure AD Connect: How toorecover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="c251c-104">O Azure AD Connect requer um dados de identidade do toostore de base de dados do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c251c-104">Azure AD Connect requires a SQL Server database toostore identity data.</span></span> <span data-ttu-id="c251c-105">Pode utilizar a predefinição de Olá que SQL Server 2012 Express LocalDB instalado com o Azure AD Connect ou utilizar o seu próprio SQL completo.</span><span class="sxs-lookup"><span data-stu-id="c251c-105">You can either use hello default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="c251c-106">O SQL Server Express impõe um limite de tamanho de 10 GB.</span><span class="sxs-lookup"><span data-stu-id="c251c-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="c251c-107">Ao utilizar a LocalDB e este limite ser atingido, o Serviço de Sincronização do Azure AD Connect já não pode iniciar ou sincronizar corretamente.</span><span class="sxs-lookup"><span data-stu-id="c251c-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="c251c-108">Este artigo fornece os passos de recuperação Olá.</span><span class="sxs-lookup"><span data-stu-id="c251c-108">This article provides hello recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="c251c-109">Sintomas</span><span class="sxs-lookup"><span data-stu-id="c251c-109">Symptoms</span></span>
<span data-ttu-id="c251c-110">Existem dois sintomas comuns:</span><span class="sxs-lookup"><span data-stu-id="c251c-110">There are two common symptoms:</span></span>

* <span data-ttu-id="c251c-111">Serviço de sincronização ligar do Azure AD **está em execução** , mas falhar toosynchronize com *"parou-base de dados-disco-completa"* erro.</span><span class="sxs-lookup"><span data-stu-id="c251c-111">Azure AD Connect Synchronization Service **is running** but fails toosynchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="c251c-112">Serviço de sincronização ligar do Azure AD **é toostart não é possível**.</span><span class="sxs-lookup"><span data-stu-id="c251c-112">Azure AD Connect Synchronization Service **is unable toostart**.</span></span> <span data-ttu-id="c251c-113">Quando a tentativa de serviço de Olá toostart falhar com eventos 6323 e a mensagem de erro *"o servidor de Olá encontrou um erro porque o SQL Server está fora do espaço em disco."*</span><span class="sxs-lookup"><span data-stu-id="c251c-113">When you attempt toostart hello service, it fails with event 6323 and error message *"hello server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="c251c-114">Passos de recuperação de curta duração</span><span class="sxs-lookup"><span data-stu-id="c251c-114">Short-term recovery steps</span></span>
<span data-ttu-id="c251c-115">Esta secção fornece Olá passos tooreclaim DB o espaço necessário para a operação de tooresume do serviço de sincronização ligar do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c251c-115">This section provides hello steps tooreclaim DB space required for Azure AD Connect Synchronization Service tooresume operation.</span></span> <span data-ttu-id="c251c-116">Olá passos incluem:</span><span class="sxs-lookup"><span data-stu-id="c251c-116">hello steps include:</span></span>
1. [<span data-ttu-id="c251c-117">Determinar o estado do serviço de sincronização Olá</span><span class="sxs-lookup"><span data-stu-id="c251c-117">Determine hello Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="c251c-118">Base de dados de operação de encolhimento Olá</span><span class="sxs-lookup"><span data-stu-id="c251c-118">Shrink hello database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="c251c-119">Eliminar dados do histórico de execução</span><span class="sxs-lookup"><span data-stu-id="c251c-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="c251c-120">Reduza o período de retenção de dados do histórico de execução</span><span class="sxs-lookup"><span data-stu-id="c251c-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-hello-synchronization-service-status"></a><span data-ttu-id="c251c-121">Determinar o estado do serviço de sincronização Olá</span><span class="sxs-lookup"><span data-stu-id="c251c-121">Determine hello Synchronization Service status</span></span>
<span data-ttu-id="c251c-122">Em primeiro lugar, determine se Olá serviço de sincronização ainda está em execução ou não:</span><span class="sxs-lookup"><span data-stu-id="c251c-122">First, determine whether hello Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="c251c-123">Inicie sessão no tooyour do Azure AD Connect servidor como administrador.</span><span class="sxs-lookup"><span data-stu-id="c251c-123">Log in tooyour Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="c251c-124">Aceda demasiado**Service Control Manager**.</span><span class="sxs-lookup"><span data-stu-id="c251c-124">Go too**Service Control Manager**.</span></span>

3. <span data-ttu-id="c251c-125">Verificar o estado de Olá de **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="c251c-125">Check hello status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="c251c-126">Se estiver em execução, não parar ou reiniciar o serviço de Olá.</span><span class="sxs-lookup"><span data-stu-id="c251c-126">If it is running, do not stop or restart hello service.</span></span> <span data-ttu-id="c251c-127">Ignorar [base de dados de operação de encolhimento Olá](#shrink-the-database) passo e vá demasiado[eliminar dados do histórico de execução](#delete-run-history-data) passo.</span><span class="sxs-lookup"><span data-stu-id="c251c-127">Skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="c251c-128">Se não está em execução, tente o serviço de Olá toostart.</span><span class="sxs-lookup"><span data-stu-id="c251c-128">If it is not running, try toostart hello service.</span></span> <span data-ttu-id="c251c-129">Se o serviço de Olá é iniciado com êxito, ignore [base de dados de operação de encolhimento Olá](#shrink-the-database) passo e vá demasiado[eliminar dados do histórico de execução](#delete-run-history-data) passo.</span><span class="sxs-lookup"><span data-stu-id="c251c-129">If hello service starts successfully, skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="c251c-130">Caso contrário, continue com [base de dados de operação de encolhimento Olá](#shrink-the-database) passo.</span><span class="sxs-lookup"><span data-stu-id="c251c-130">Otherwise, continue with [Shrink hello database](#shrink-the-database) step.</span></span>

### <a name="shrink-hello-database"></a><span data-ttu-id="c251c-131">Base de dados de operação de encolhimento Olá</span><span class="sxs-lookup"><span data-stu-id="c251c-131">Shrink hello database</span></span>
<span data-ttu-id="c251c-132">Utilize toofree de operação de encolhimento Olá segurança Olá de toostart espaço suficiente DB serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="c251c-132">Use hello Shrink operation toofree up enough DB space toostart hello Synchronization Service.</span></span> <span data-ttu-id="c251c-133">-Liberta espaço de base de dados removendo espaços em branco na base de dados de Olá.</span><span class="sxs-lookup"><span data-stu-id="c251c-133">It frees up DB space by removing whitespaces in hello database.</span></span> <span data-ttu-id="c251c-134">Este passo é melhor esforço, como não é garantido que pode recuperar sempre espaço.</span><span class="sxs-lookup"><span data-stu-id="c251c-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="c251c-135">toolearn mais informações sobre a operação de encolhimento, leia este artigo [diminuir uma base de dados](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="c251c-135">toolearn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c251c-136">Ignore este passo se pode obter Olá toorun de serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="c251c-136">Skip this step if you can get hello Synchronization Service toorun.</span></span> <span data-ttu-id="c251c-137">Não é recomendado tooshrink Olá BD do SQL que pode levar toopoor desempenho devido a fragmentação de tooincreased.</span><span class="sxs-lookup"><span data-stu-id="c251c-137">It is not recommended tooshrink hello SQL DB as it can lead toopoor performance due tooincreased fragmentation.</span></span>

<span data-ttu-id="c251c-138">Olá nome da base de dados de Olá criada para o Azure AD Connect é **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="c251c-138">hello name of hello database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="c251c-139">uma operação de encolhimento tooperform, tem de iniciar sessão como Olá sysadmin ou DBO da base de dados de Olá.</span><span class="sxs-lookup"><span data-stu-id="c251c-139">tooperform a Shrink operation, you must log in either as hello sysadmin or DBO of hello database.</span></span> <span data-ttu-id="c251c-140">Durante a instalação do Azure AD Connect, Olá seguintes contas é concedido direitos de administrador do sistema:</span><span class="sxs-lookup"><span data-stu-id="c251c-140">During Azure AD Connect installation, hello following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="c251c-141">Administradores locais</span><span class="sxs-lookup"><span data-stu-id="c251c-141">Local Administrators</span></span>
* <span data-ttu-id="c251c-142">conta de utilizador de Olá que foi utilizado toorun do Azure AD Connect instalação.</span><span class="sxs-lookup"><span data-stu-id="c251c-142">hello user account that was used toorun Azure AD Connect installation.</span></span>
* <span data-ttu-id="c251c-143">Olá conta de serviço de sincronização que é utilizada como Olá operativo contexto do serviço de sincronização ligar do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c251c-143">hello Sync Service account that is used as hello operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="c251c-144">grupo local de Olá ADSyncAdmins que foi criada durante a instalação.</span><span class="sxs-lookup"><span data-stu-id="c251c-144">hello local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="c251c-145">Cópia de segurança da base de dados de Olá copiando **ADSync.mdf** e **ADSync_log.ldf** ficheiros localizados em `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa de localização segura.</span><span class="sxs-lookup"><span data-stu-id="c251c-145">Back up hello database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa safe location.</span></span>

2. <span data-ttu-id="c251c-146">Inicie uma nova sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c251c-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="c251c-147">Navegue toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="c251c-147">Navigate toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="c251c-148">Iniciar **sqlcmd** utilitário executando o comando de Olá `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, utilizando credenciais Olá um sysadmin ou Olá DBO da base de dados.</span><span class="sxs-lookup"><span data-stu-id="c251c-148">Start **sqlcmd** utility by running hello command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using hello credential of a sysadmin or hello database DBO.</span></span>

5. <span data-ttu-id="c251c-149">base de dados da Olá tooshrink, na linha de comandos do Olá sqlcmd (1 >), introduza `DBCC Shrinkdatabase(ADSync,1);`, seguido `GO` na linha seguinte Olá.</span><span class="sxs-lookup"><span data-stu-id="c251c-149">tooshrink hello database, at hello sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in hello next line.</span></span>

6. <span data-ttu-id="c251c-150">Se a operação de Olá for bem-sucedida, tente novamente toostart Olá serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="c251c-150">If hello operation is successful, try toostart hello Synchronization Service again.</span></span> <span data-ttu-id="c251c-151">Se começar Olá serviço de sincronização, aceda demasiado[eliminar dados do histórico de execução](#delete-run-history-data) passo.</span><span class="sxs-lookup"><span data-stu-id="c251c-151">If you can start hello Synchronization Service, go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="c251c-152">Caso contrário, contacte o suporte.</span><span class="sxs-lookup"><span data-stu-id="c251c-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="c251c-153">Eliminar dados do histórico de execução</span><span class="sxs-lookup"><span data-stu-id="c251c-153">Delete run history data</span></span>
<span data-ttu-id="c251c-154">Por predefinição, o Azure AD Connect mantém até compreendendo tooseven dias de dados do histórico de execução.</span><span class="sxs-lookup"><span data-stu-id="c251c-154">By default, Azure AD Connect retains up tooseven days’ worth of run history data.</span></span> <span data-ttu-id="c251c-155">Neste passo, vamos eliminar Olá espaço de tooreclaim DB de dados do histórico de execução para que o serviço de sincronização ligar do Azure AD pode começar a sincronizar novamente.</span><span class="sxs-lookup"><span data-stu-id="c251c-155">In this step, we delete hello run history data tooreclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="c251c-156">Iniciar **Synchronization Service Manager** por vai → de tooSTART serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="c251c-156">Start **Synchronization Service Manager** by going tooSTART → Synchronization Service.</span></span>

2.  <span data-ttu-id="c251c-157">Aceda toohello **operações** separador.</span><span class="sxs-lookup"><span data-stu-id="c251c-157">Go toohello **Operations** tab.</span></span>

3.  <span data-ttu-id="c251c-158">Em **ações**, selecione **executa limpar**...</span><span class="sxs-lookup"><span data-stu-id="c251c-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="c251c-159">Pode optar por **limpar todas as execuções** ou **encriptado é executado antes de... <date>**  opção.</span><span class="sxs-lookup"><span data-stu-id="c251c-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="c251c-160">Recomenda-se que comece por limpar executar histórico de dados que são mais antigo do que dois dias.</span><span class="sxs-lookup"><span data-stu-id="c251c-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="c251c-161">Se continuar toorun no problema de tamanho de base de dados, em seguida, escolha Olá **limpar todas as execuções** opção.</span><span class="sxs-lookup"><span data-stu-id="c251c-161">If you continue toorun into DB size issue, then choose hello **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="c251c-162">Reduza o período de retenção de dados do histórico de execução</span><span class="sxs-lookup"><span data-stu-id="c251c-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="c251c-163">Este passo é a probabilidade de Olá tooreduce de execução para o problema de limite de 10 GB Olá após vários ciclos de sincronização.</span><span class="sxs-lookup"><span data-stu-id="c251c-163">This step is tooreduce hello likelihood of running into hello 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="c251c-164">Abra uma nova sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c251c-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="c251c-165">Executar `Get-ADSyncScheduler` e tome nota dos Olá PurgeRunHistoryInterval propriedade, o que especifica o período de retenção atual Olá.</span><span class="sxs-lookup"><span data-stu-id="c251c-165">Run `Get-ADSyncScheduler` and take note of hello PurgeRunHistoryInterval property, which specifies hello current retention period.</span></span>

3. <span data-ttu-id="c251c-166">Executar `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` dias de tootwo período de retenção de Olá tooset.</span><span class="sxs-lookup"><span data-stu-id="c251c-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello retention period tootwo days.</span></span> <span data-ttu-id="c251c-167">Ajuste o período de retenção de Olá conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="c251c-167">Adjust hello retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-toofull-sql"></a><span data-ttu-id="c251c-168">Solução de longa duração – migrar toofull SQL</span><span class="sxs-lookup"><span data-stu-id="c251c-168">Long-term solution – Migrate toofull SQL</span></span>
<span data-ttu-id="c251c-169">Em geral, o problema de Olá é facto de que o tamanho de base de dados de 10 GB já não é suficiente para o Azure AD Connect toosynchronize sua tooAzure do Active Directory no local AD.</span><span class="sxs-lookup"><span data-stu-id="c251c-169">In general, hello issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect toosynchronize your on-premises Active Directory tooAzure AD.</span></span> <span data-ttu-id="c251c-170">Recomenda-se que mude toousing versão completa do Olá do SQL server.</span><span class="sxs-lookup"><span data-stu-id="c251c-170">It is recommended that you switch toousing hello full version of SQL server.</span></span> <span data-ttu-id="c251c-171">Não é possível diretamente substituir Olá LocalDB de uma implementação existente do Azure AD Connect com base de dados de Olá da versão completa do Olá do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c251c-171">You cannot directly replace hello LocalDB of an existing Azure AD Connect deployment with hello database of hello full version of SQL.</span></span> <span data-ttu-id="c251c-172">Em vez disso, tem de implementar um novo servidor do Azure AD Connect com a versão completa do Olá do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c251c-172">Instead, you must deploy a new Azure AD Connect server with hello full version of SQL.</span></span> <span data-ttu-id="c251c-173">Recomenda-se que efetue uma migração swing que em que o novo Azure AD Connect servidor Olá (com base de dados do SQL Server) é implementado como um servidor de teste, seguinte toohello existente servidor do Azure AD Connect (com LocalDB).</span><span class="sxs-lookup"><span data-stu-id="c251c-173">It is recommended that you do a swing migration where hello new Azure AD Connect server (with SQL DB) is deployed as a staging server, next toohello existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="c251c-174">Para obter instruções sobre como tooconfigure SQL remoto com o Azure AD Connect, consulte tooarticle [instalação personalizada do Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="c251c-174">For instruction on how tooconfigure remote SQL with Azure AD Connect, refer tooarticle [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="c251c-175">Para obter instruções sobre a migração de swing para a atualização do Azure AD Connect, consulte tooarticle [do Azure AD Connect: atualização a partir de uma anterior toohello versão mais recente](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="c251c-175">For instructions on swing migration for Azure AD Connect upgrade, refer tooarticle [Azure AD Connect: Upgrade from a previous version toohello latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="c251c-176">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="c251c-176">Next steps</span></span>
<span data-ttu-id="c251c-177">Saiba mais sobre como [Integrar as identidades no local ao Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="c251c-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
