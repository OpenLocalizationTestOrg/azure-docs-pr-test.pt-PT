---
title: "funcionalidades de aaaCreate para dados de um cluster de Hadoop através de consultas do Hive | Microsoft Docs"
description: Exemplos de consultas do Hive que geram funcionalidades em dados armazenados no cluster Azure HDInsight Hadoop.
services: machine-learning
documentationcenter: 
author: bradsev
manager: jhubbard
editor: cgronlun
ms.assetid: e8a94c71-979b-4707-b8fd-85b47d309a30
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/24/2017
ms.author: hangzh;bradsev
ms.openlocfilehash: 686282bf0fb84ea82758d3c5b7de2bd90f0cf159
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="create-features-for-data-in-an-hadoop-cluster-using-hive-queries"></a><span data-ttu-id="8a4b2-103">Criar características para dados num cluster do Hadoop com consultas do Hive</span><span class="sxs-lookup"><span data-stu-id="8a4b2-103">Create features for data in an Hadoop cluster using Hive queries</span></span>
<span data-ttu-id="8a4b2-104">Este documento mostra como as funcionalidades de toocreate para dados armazenados no cluster Azure HDInsight Hadoop através de consultas do Hive.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-104">This document shows how toocreate features for data stored in an Azure HDInsight Hadoop cluster using Hive queries.</span></span> <span data-ttu-id="8a4b2-105">Estas consultas do Hive utilizam incorporados do Hive funções definidas pelo utilizador (UDFs), scripts de Olá para os quais são fornecidas.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-105">These Hive queries use embedded Hive User Defined Functions (UDFs), hello scripts for which are provided.</span></span>

<span data-ttu-id="8a4b2-106">Olá operações necessárias toocreate funcionalidades podem ser consomem muita memória.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-106">hello operations needed toocreate features can be memory intensive.</span></span> <span data-ttu-id="8a4b2-107">desempenho de Olá de consultas do Hive se torne mais crítico nestes casos e pode ser melhorado determinados parâmetros de otimização.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-107">hello performance of Hive queries becomes more critical in such cases and can be improved by tuning certain parameters.</span></span> <span data-ttu-id="8a4b2-108">Olá otimização destes parâmetros mencionado na secção final Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-108">hello tuning of these parameters is discussed in hello final section.</span></span>

<span data-ttu-id="8a4b2-109">Exemplos de consultas de Olá que são apresentadas são toohello específico [NYC Taxi viagem dados](http://chriswhong.com/open-data/foil_nyc_taxi/) cenários também são fornecidos no [repositório do GitHub](https://github.com/Azure/Azure-MachineLearning-DataScience/tree/master/Misc/DataScienceProcess/DataScienceScripts).</span><span class="sxs-lookup"><span data-stu-id="8a4b2-109">Examples of hello queries that are presented are specific toohello [NYC Taxi Trip Data](http://chriswhong.com/open-data/foil_nyc_taxi/) scenarios are also provided in [GitHub repository](https://github.com/Azure/Azure-MachineLearning-DataScience/tree/master/Misc/DataScienceProcess/DataScienceScripts).</span></span> <span data-ttu-id="8a4b2-110">Estas consultas já tiver o esquema de dados especificado e estão pronto toobe submetido toorun.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-110">These queries already have data schema specified and are ready toobe submitted toorun.</span></span> <span data-ttu-id="8a4b2-111">Na secção final Olá, os parâmetros que os utilizadores podem otimizar para que Olá o desempenho de consultas do Hive pode ser melhorado também são debatidos.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-111">In hello final section, parameters that users can tune so that hello performance of Hive queries can be improved are  also discussed.</span></span>

[!INCLUDE [cap-create-features-data-selector](../../includes/cap-create-features-selector.md)]

<span data-ttu-id="8a4b2-112">Isto **menu** liga tootopics que descrevem como toocreate funcionalidades para os dados em vários ambientes.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-112">This **menu** links tootopics that describe how toocreate features for data in various environments.</span></span> <span data-ttu-id="8a4b2-113">Esta tarefa é um passo Olá [processo de ciência de dados de equipa (TDSP)](https://azure.microsoft.com/documentation/learning-paths/cortana-analytics-process/).</span><span class="sxs-lookup"><span data-stu-id="8a4b2-113">This task is a step in hello [Team Data Science Process (TDSP)](https://azure.microsoft.com/documentation/learning-paths/cortana-analytics-process/).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8a4b2-114">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="8a4b2-114">Prerequisites</span></span>
<span data-ttu-id="8a4b2-115">Este artigo pressupõe que tem:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-115">This article assumes that you have:</span></span>

* <span data-ttu-id="8a4b2-116">Criar uma conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-116">Created an Azure storage account.</span></span> <span data-ttu-id="8a4b2-117">Se precisar de instruções, consulte [criar uma conta de armazenamento do Azure](../storage/common/storage-create-storage-account.md#create-a-storage-account)</span><span class="sxs-lookup"><span data-stu-id="8a4b2-117">If you need instructions, see [Create an Azure Storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account)</span></span>
* <span data-ttu-id="8a4b2-118">Aprovisionar um cluster de Hadoop personalizado com Olá serviço HDInsight.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-118">Provisioned a customized Hadoop cluster with hello HDInsight service.</span></span>  <span data-ttu-id="8a4b2-119">Se precisar de instruções, consulte [personalizar Azure HDInsight Clusters do Hadoop para análise avançada](machine-learning-data-science-customize-hadoop-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="8a4b2-119">If you need instructions, see [Customize Azure HDInsight Hadoop Clusters for Advanced Analytics](machine-learning-data-science-customize-hadoop-cluster.md).</span></span>
* <span data-ttu-id="8a4b2-120">dados de Olá foi carregado tooHive tabelas do Azure HDInsight Hadoop clusters.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-120">hello data has been uploaded tooHive tables in Azure HDInsight Hadoop clusters.</span></span> <span data-ttu-id="8a4b2-121">Se não tiver, siga [criar e carga tabelas de tooHive dados](machine-learning-data-science-move-hive-tables.md) tooupload dados tooHive tabelas pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-121">If it has not, please follow [Create and load data tooHive tables](machine-learning-data-science-move-hive-tables.md) tooupload data tooHive tables first.</span></span>
* <span data-ttu-id="8a4b2-122">Cluster de toohello de acesso remoto ativado.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-122">Enabled remote access toohello cluster.</span></span> <span data-ttu-id="8a4b2-123">Se precisar de instruções, consulte [Olá acesso Head nó de Cluster do Hadoop](machine-learning-data-science-customize-hadoop-cluster.md#headnode).</span><span class="sxs-lookup"><span data-stu-id="8a4b2-123">If you need instructions, see [Access hello Head Node of Hadoop Cluster](machine-learning-data-science-customize-hadoop-cluster.md#headnode).</span></span>

## <span data-ttu-id="8a4b2-124"><a name="hive-featureengineering"></a>Geração de funcionalidade</span><span class="sxs-lookup"><span data-stu-id="8a4b2-124"><a name="hive-featureengineering"></a>Feature Generation</span></span>
<span data-ttu-id="8a4b2-125">Nesta secção são descritos vários exemplos de formas de Olá na qual podem gerar funcionalidades através de consultas do Hive.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-125">In this section, several examples of hello ways in which features can be generating using Hive queries are described.</span></span> <span data-ttu-id="8a4b2-126">Depois de ter gerado funcionalidades adicionais, pode adicioná-los como tabela do colunas toohello existente ou criar uma nova tabela com funcionalidades adicionais Olá e a chave primária, o que, em seguida, pode ser associado com a tabela original Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-126">Once you have generated additional features, you can either add them as columns toohello existing table or create a new table with hello additional features and primary key, which can then be joined with hello original table.</span></span> <span data-ttu-id="8a4b2-127">Seguem-se exemplos de Olá apresentados:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-127">Here are hello examples presented:</span></span>

1. [<span data-ttu-id="8a4b2-128">Frequência baseada geração de funcionalidade</span><span class="sxs-lookup"><span data-stu-id="8a4b2-128">Frequency based Feature Generation</span></span>](#hive-frequencyfeature)
2. [<span data-ttu-id="8a4b2-129">Riscos de variáveis Categórico na classificação binária</span><span class="sxs-lookup"><span data-stu-id="8a4b2-129">Risks of Categorical Variables in Binary Classification</span></span>](#hive-riskfeature)
3. [<span data-ttu-id="8a4b2-130">Extrair as funcionalidades do campo Datetime</span><span class="sxs-lookup"><span data-stu-id="8a4b2-130">Extract features from Datetime Field</span></span>](#hive-datefeatures)
4. [<span data-ttu-id="8a4b2-131">Extrair as funcionalidades do campo de texto</span><span class="sxs-lookup"><span data-stu-id="8a4b2-131">Extract features from Text Field</span></span>](#hive-textfeatures)
5. [<span data-ttu-id="8a4b2-132">Calcular a distância entre GPS coordenadas</span><span class="sxs-lookup"><span data-stu-id="8a4b2-132">Calculate distance between GPS coordinates</span></span>](#hive-gpsdistance)

### <span data-ttu-id="8a4b2-133"><a name="hive-frequencyfeature"></a>Frequência baseada geração de funcionalidade</span><span class="sxs-lookup"><span data-stu-id="8a4b2-133"><a name="hive-frequencyfeature"></a>Frequency based Feature Generation</span></span>
<span data-ttu-id="8a4b2-134">É frequentemente frequências de Olá toocalculate útil de níveis de Olá de uma variável categórico ou frequências de Olá de determinados combinações de níveis de várias variáveis categórico.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-134">It is often useful toocalculate hello frequencies of hello levels of a categorical variable, or hello frequencies of certain combinations of levels from multiple categorical variables.</span></span> <span data-ttu-id="8a4b2-135">Os utilizadores podem utilizar Olá toocalculate de script a seguir estes frequências:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-135">Users can use hello following script toocalculate these frequencies:</span></span>

        select
            a.<column_name1>, a.<column_name2>, a.sub_count/sum(a.sub_count) over () as frequency
        from
        (
            select
                <column_name1>,<column_name2>, count(*) as sub_count
            from <databasename>.<tablename> group by <column_name1>, <column_name2>
        )a
        order by frequency desc;


### <span data-ttu-id="8a4b2-136"><a name="hive-riskfeature"></a>Riscos de variáveis Categórico na classificação binária</span><span class="sxs-lookup"><span data-stu-id="8a4b2-136"><a name="hive-riskfeature"></a>Risks of Categorical Variables in Binary Classification</span></span>
<span data-ttu-id="8a4b2-137">Na classificação binária, precisamos variáveis de categórico tooconvert não numéricos em funcionalidades numérico quando os modelos de Olá a ser utilizados apenas o funcionalidades numérico.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-137">In binary classification, we need tooconvert non-numeric categorical variables into numeric features when hello models being used only take numeric features.</span></span> <span data-ttu-id="8a4b2-138">Isto é feito ao substituir a cada nível de não sejam numéricos por um risco de um valor numérico.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-138">This is done by replacing each non-numeric level with a numeric risk.</span></span> <span data-ttu-id="8a4b2-139">Nesta secção, mostramos algumas consultas do Hive genéricas que calcular valores de risco Olá (registo odds) de uma variável categórico.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-139">In this section, we show some generic Hive queries that calculate hello risk values (log odds) of a categorical variable.</span></span>

        set smooth_param1=1;
        set smooth_param2=20;
        select
            <column_name1>,<column_name2>,
            ln((sum_target+${hiveconf:smooth_param1})/(record_count-sum_target+${hiveconf:smooth_param2}-${hiveconf:smooth_param1})) as risk
        from
            (
            select
                <column_nam1>, <column_name2>, sum(binary_target) as sum_target, sum(1) as record_count
            from
                (
                select
                    <column_name1>, <column_name2>, if(target_column>0,1,0) as binary_target
                from <databasename>.<tablename>
                )a
            group by <column_name1>, <column_name2>
            )b

<span data-ttu-id="8a4b2-140">Neste exemplo, as variáveis `smooth_param1` e `smooth_param2` são conjunto toosmooth Olá risco valores calculados a partir dos dados de Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-140">In this example, variables `smooth_param1` and `smooth_param2` are set toosmooth hello risk values calculated from hello data.</span></span> <span data-ttu-id="8a4b2-141">Riscos tem um intervalo entre -Inf e Inf.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-141">Risks have a range between -Inf and Inf.</span></span> <span data-ttu-id="8a4b2-142">A riscos > 0 indica se a probabilidade de Olá que o destino Olá é igual too1 é superior a 0,5.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-142">A risks > 0 indicates that hello probability that hello target is equal too1 is greater than 0.5.</span></span>

<span data-ttu-id="8a4b2-143">Depois de tabela de risco Olá é calculada, os utilizadores podem atribuir a tabela de tooa de valores de risco ao associá-lo com a tabela de risco Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-143">After hello risk table is calculated, users can assign risk values tooa table by joining it with hello risk table.</span></span> <span data-ttu-id="8a4b2-144">a consulta de associação do Hive do Olá foi fornecida na secção anterior.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-144">hello Hive joining query was provided in previous section.</span></span>

### <span data-ttu-id="8a4b2-145"><a name="hive-datefeatures"></a>Extrair as funcionalidades dos campos Datetime</span><span class="sxs-lookup"><span data-stu-id="8a4b2-145"><a name="hive-datefeatures"></a>Extract features from Datetime Fields</span></span>
<span data-ttu-id="8a4b2-146">Ramo de registo é fornecido com um conjunto de UDFs para processar os campos datetime.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-146">Hive comes with a set of UDFs for processing datetime fields.</span></span> <span data-ttu-id="8a4b2-147">No ramo de registo, o formato de datetime Olá predefinido é ' aaaa-MM-dd 00:00:00 ' ('1970-01-01-12:21:32 ' por exemplo).</span><span class="sxs-lookup"><span data-stu-id="8a4b2-147">In Hive, hello default datetime format is 'yyyy-MM-dd 00:00:00' ('1970-01-01 12:21:32' for example).</span></span> <span data-ttu-id="8a4b2-148">Nesta secção, mostramos exemplos que extrair o dia de Olá de um mês, o mês Olá de um campo datetime e outros exemplos para converter uma cadeia de datetime num formato que cadeia do Olá predefinida formato tooa datetime predefinidas no formato.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-148">In this section, we show examples that extract hello day of a month, hello month from a datetime field, and other examples that convert a datetime string in a format other than hello default format tooa datetime string in default format.</span></span>

        select day(<datetime field>), month(<datetime field>)
        from <databasename>.<tablename>;

<span data-ttu-id="8a4b2-149">Esta consulta do Hive assume que Olá *&#60; campo datetime >* está no formato datetime, Olá predefinido.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-149">This Hive query assumes that hello *&#60;datetime field>* is in hello default datetime format.</span></span>

<span data-ttu-id="8a4b2-150">Se um campo datetime não se encontra no formato predefinido das Olá, terá de campo de datetime tooconvert Olá para o carimbo de hora Unix primeiro e, em seguida, converter Olá Unix carimbo tooa datetime de cadeia que ocorre na predefinição Olá formato.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-150">If a datetime field is not in hello default format, you need tooconvert hello datetime field into Unix time stamp first, and then convert hello Unix time stamp tooa datetime string that is in hello default format.</span></span> <span data-ttu-id="8a4b2-151">Quando Olá datetime predefinidas no formato, os utilizadores podem aplicar Olá incorporado datetime UDFs tooextract funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-151">When hello datetime is in default format, users can apply hello embedded datetime UDFs tooextract features.</span></span>

        select from_unixtime(unix_timestamp(<datetime field>,'<pattern of hello datetime field>'))
        from <databasename>.<tablename>;

<span data-ttu-id="8a4b2-152">Esta consulta, se hello *&#60; campo datetime >* tem padrão Olá como *26/03/2015 04:12:39*, Olá *' &#60; padrão do campo de datetime Olá >'* deve ser `'MM/dd/yyyy HH:mm:ss'`.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-152">In this query, if hello *&#60;datetime field>* has hello pattern like *03/26/2015 12:04:39*, hello *'&#60;pattern of hello datetime field>'* should be `'MM/dd/yyyy HH:mm:ss'`.</span></span> <span data-ttu-id="8a4b2-153">tootest, os utilizadores podem executar</span><span class="sxs-lookup"><span data-stu-id="8a4b2-153">tootest it, users can run</span></span>

        select from_unixtime(unix_timestamp('05/15/2015 09:32:10','MM/dd/yyyy HH:mm:ss'))
        from hivesampletable limit 1;

<span data-ttu-id="8a4b2-154">Olá *hivesampletable* nesta consulta vem pré-instalada em todos os clusters do Hadoop do Azure HDInsight por predefinição quando clusters Olá são aprovisionados.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-154">hello *hivesampletable* in this query comes preinstalled on all Azure HDInsight Hadoop clusters by default when hello clusters are provisioned.</span></span>

### <span data-ttu-id="8a4b2-155"><a name="hive-textfeatures"></a>Extrair as funcionalidades de campos de texto</span><span class="sxs-lookup"><span data-stu-id="8a4b2-155"><a name="hive-textfeatures"></a>Extract features from Text Fields</span></span>
<span data-ttu-id="8a4b2-156">Quando a tabela de Hive Olá tem um campo de texto que contém uma cadeia de palavras são delimitados por espaços, hello seguinte consulta extrai o comprimento da cadeia de Olá e o número de Olá de palavras na cadeia de Olá Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-156">When hello Hive table has a text field that contains a string of words that are delimited by spaces, hello following query extracts hello length of hello string, and hello number of words in hello string.</span></span>

        select length(<text field>) as str_len, size(split(<text field>,' ')) as word_num
        from <databasename>.<tablename>;

### <span data-ttu-id="8a4b2-157"><a name="hive-gpsdistance"></a>Calcular as distâncias entre conjuntos de coordenadas GPS</span><span class="sxs-lookup"><span data-stu-id="8a4b2-157"><a name="hive-gpsdistance"></a>Calculate distances between sets of GPS coordinates</span></span>
<span data-ttu-id="8a4b2-158">consulta de Olá indicada nesta secção pode ser aplicado diretamente toohello NYC Taxi viagem dados.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-158">hello query given in this section can be directly applied toohello NYC Taxi Trip Data.</span></span> <span data-ttu-id="8a4b2-159">objetivo Olá esta consulta é tooshow como tooapply um embedded matemática funções no ramo de registo toogenerate funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-159">hello purpose of this query is tooshow how tooapply an embedded mathematical functions in Hive toogenerate features.</span></span>

<span data-ttu-id="8a4b2-160">Olá campos que são utilizados nesta consulta são coordenadas GPS Olá das localizações de recolha e dropoff, com o nome *recolha\_longitude*, *recolha\_latitude*,  *dropoff\_longitude*, e *dropoff\_latitude*.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-160">hello fields that are used in this query are hello GPS coordinates of pickup and dropoff locations, named *pickup\_longitude*, *pickup\_latitude*, *dropoff\_longitude*, and *dropoff\_latitude*.</span></span> <span data-ttu-id="8a4b2-161">as consultas de Olá calcular distância direta de Olá entre coordenadas de recolha e dropoff Olá são:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-161">hello queries that calculate hello direct distance between hello pickup and dropoff coordinates are:</span></span>

        set R=3959;
        set pi=radians(180);
        select pickup_longitude, pickup_latitude, dropoff_longitude, dropoff_latitude,
            ${hiveconf:R}*2*2*atan((1-sqrt(1-pow(sin((dropoff_latitude-pickup_latitude)
            *${hiveconf:pi}/180/2),2)-cos(pickup_latitude*${hiveconf:pi}/180)
            *cos(dropoff_latitude*${hiveconf:pi}/180)*pow(sin((dropoff_longitude-pickup_longitude)*${hiveconf:pi}/180/2),2)))
            /sqrt(pow(sin((dropoff_latitude-pickup_latitude)*${hiveconf:pi}/180/2),2)
            +cos(pickup_latitude*${hiveconf:pi}/180)*cos(dropoff_latitude*${hiveconf:pi}/180)*
            pow(sin((dropoff_longitude-pickup_longitude)*${hiveconf:pi}/180/2),2))) as direct_distance
        from nyctaxi.trip
        where pickup_longitude between -90 and 0
        and pickup_latitude between 30 and 90
        and dropoff_longitude between -90 and 0
        and dropoff_latitude between 30 and 90
        limit 10;

<span data-ttu-id="8a4b2-162">as equações matemática Olá que calcular distância Olá entre duas coordenadas GPS podem ser encontradas no Olá <a href="http://www.movable-type.co.uk/scripts/latlong.html" target="_blank">Movable tipo Scripts</a> site, criada por Peter Lapisu.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-162">hello mathematical equations that calculate hello distance between two GPS coordinates can be found on hello <a href="http://www.movable-type.co.uk/scripts/latlong.html" target="_blank">Movable Type Scripts</a> site, authored by Peter Lapisu.</span></span> <span data-ttu-id="8a4b2-163">No seu Javascript, Olá função `toRad()` é apenas *lat_or_lon*pi/180 *, que converte tooradians graus.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-163">In his Javascript, hello function `toRad()` is just *lat_or_lon*pi/180*, which converts degrees tooradians.</span></span> <span data-ttu-id="8a4b2-164">Aqui, *lat_or_lon* latitude Olá ou longitude.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-164">Here, *lat_or_lon* is hello latitude or longitude.</span></span> <span data-ttu-id="8a4b2-165">Uma vez que o ramo de registo não fornece a função de Olá `atan2`, mas fornece a função de Olá `atan`, Olá `atan2` função é implementada por `atan` funcionar em Olá acima consulta do Hive com a definição de Olá fornecida <a href="http://en.wikipedia.org/wiki/Atan2" target="_blank"> Wikipedia</a>.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-165">Since Hive does not provide hello function `atan2`, but provides hello function `atan`, hello `atan2` function is implemented by `atan` function in hello above Hive query using hello definition provided in <a href="http://en.wikipedia.org/wiki/Atan2" target="_blank">Wikipedia</a>.</span></span>

![Criar a área de trabalho](./media/machine-learning-data-science-create-features-hive/atan2new.png)

<span data-ttu-id="8a4b2-167">Uma lista completa de ramo de registo UDFs incorporados podem ser encontrados na Olá **funções incorporadas** secção em Olá <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions" target="_blank">Apache Hive wiki</a>).</span><span class="sxs-lookup"><span data-stu-id="8a4b2-167">A full list of Hive embedded UDFs can be found in hello **Built-in Functions** section on hello <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions" target="_blank">Apache Hive wiki</a>).</span></span>  

## <span data-ttu-id="8a4b2-168"><a name="tuning"></a>Tópicos de avançadas: parâmetros de ramo de registo de otimizar tooImprove velocidade de consulta</span><span class="sxs-lookup"><span data-stu-id="8a4b2-168"><a name="tuning"></a> Advanced topics: Tune Hive Parameters tooImprove Query Speed</span></span>
<span data-ttu-id="8a4b2-169">Olá parâmetro predefinido definições do cluster de ramo de registo poderão não ser adequadas para consultas do Hive de Olá e os dados de Olá que consultas Olá são de processamento.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-169">hello default parameter settings of Hive cluster might not be suitable for hello Hive queries and hello data that hello queries are processing.</span></span> <span data-ttu-id="8a4b2-170">Nesta secção, vamos discutir alguns parâmetros que os utilizadores podem otimizar que melhoram o desempenho de Olá de consultas do Hive.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-170">In this section, we discuss some parameters that users can tune that improve hello performance of Hive queries.</span></span> <span data-ttu-id="8a4b2-171">Os utilizadores precisam de parâmetro de Olá tooadd otimização consultas antes de consultas de Olá de processamento de dados.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-171">Users need tooadd hello parameter tuning queries before hello queries of processing data.</span></span>

1. <span data-ttu-id="8a4b2-172">**Espaço de área dinâmica para dados de Java**: para consultas que envolvem grandes conjuntos de dados de associação ou processar registos longos, **a ficar sem espaço de pilha** é um erro comum Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-172">**Java heap space**: For queries involving joining large datasets, or processing long records, **running out of heap space** is one of hello common error.</span></span> <span data-ttu-id="8a4b2-173">Isto pode ser otimizado ao definir os parâmetros *mapreduce.map.java.opts* e *mapreduce.task.io.sort.mb* toodesired valores.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-173">This can be tuned by setting parameters *mapreduce.map.java.opts* and *mapreduce.task.io.sort.mb* toodesired values.</span></span> <span data-ttu-id="8a4b2-174">Segue-se um exemplo:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-174">Here is an example:</span></span>
   
        set mapreduce.map.java.opts=-Xmx4096m;
        set mapreduce.task.io.sort.mb=-Xmx1024m;

    <span data-ttu-id="8a4b2-175">Este parâmetro atribui 4GB de memória tooJava área dinâmica para dados espaço e também facilita a ordenação mais eficiente ao alocar mais memória para o mesmo.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-175">This parameter allocates 4GB memory tooJava heap space and also makes sorting more efficient by allocating more memory for it.</span></span> <span data-ttu-id="8a4b2-176">É um tooplay boa ideia com estas alocações se existir qualquer tarefa falha erros relacionados tooheap espaço.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-176">It is a good idea tooplay with these allocations if there are any job failure errors related tooheap space.</span></span>

1. <span data-ttu-id="8a4b2-177">**Tamanho do bloco de DFS** : este parâmetro define a unidade de menor Olá dos dados Olá arquivos de sistema de ficheiros.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-177">**DFS block size** : This parameter sets hello smallest unit of data that hello file system stores.</span></span> <span data-ttu-id="8a4b2-178">Por exemplo, se Olá DFS o tamanho do bloco é de 128MB, em seguida, quaisquer dados de tamanho inferior e cópia de segurança too128MB são armazenados num único bloco, enquanto os dados que são maiores do que 128MB é atribuído blocos adicionais.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-178">As an example, if hello DFS block size is 128MB, then any data of size less than and up too128MB is stored in a single block, while data that is larger than 128MB is allotted extra blocks.</span></span> <span data-ttu-id="8a4b2-179">Escolher um tamanho de bloco muito pequenos faz com que grandes sobrecargas no Hadoop, uma vez que o nó de nome de Olá tem tooprocess muitos mais pedidos toofind Olá relevantes bloco relativas toohello ficheiro.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-179">Choosing a very small block size causes large overheads in Hadoop since hello name node has tooprocess many more requests toofind hello relevant block pertaining toohello file.</span></span> <span data-ttu-id="8a4b2-180">Uma definição recomendada quando lidar com gigabytes (ou superior) os dados são:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-180">A recommended setting when dealing with gigabytes (or larger) data is :</span></span>
   
        set dfs.block.size=128m;
2. <span data-ttu-id="8a4b2-181">**Otimizar a operação de associação no ramo** : enquanto as operações de associação a estrutura de mapa/reduzir Olá ocorrer normalmente no Olá reduzir fase, por vezes, podem ser conseguidos ganhos bastantes agendando associações na fase de mapa de Olá (também denominada "mapjoins").</span><span class="sxs-lookup"><span data-stu-id="8a4b2-181">**Optimizing join operation in Hive** : While join operations in hello map/reduce framework typically take place in hello reduce phase, sometimes, enormous gains can be achieved by scheduling joins in hello map phase (also called "mapjoins").</span></span> <span data-ttu-id="8a4b2-182">toodirect Hive toodo isto sempre que possível, iremos pode definir:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-182">toodirect Hive toodo this whenever possible, we can set :</span></span>
   
        set hive.auto.convert.join=true;
3. <span data-ttu-id="8a4b2-183">**Especificar o número de Olá de mappers tooHive** : Hadoop enquanto permite Olá utilizador tooset Olá diversas reducers, número de Olá de mappers é, geralmente, não estar definido pelo utilizador Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-183">**Specifying hello number of mappers tooHive** : While Hadoop allows hello user tooset hello number of reducers, hello number of mappers is typically not be set by hello user.</span></span> <span data-ttu-id="8a4b2-184">Um truque que permite que algumas grau de controlo deste número é variáveis de Hadoop toochoose Olá *mapred.min.split.size* e *mapred.max.split.size* como tamanho Olá de mapa de cada tarefa é determinada por:</span><span class="sxs-lookup"><span data-stu-id="8a4b2-184">A trick that allows some degree of control on this number is toochoose hello Hadoop variables, *mapred.min.split.size* and *mapred.max.split.size* as hello size of each map task is determined by :</span></span>
   
        num_maps = max(mapred.min.split.size, min(mapred.max.split.size, dfs.block.size))
   
    <span data-ttu-id="8a4b2-185">Olá, normalmente, o valor predefinido de *mapred.min.split.size* for 0, de *mapred.max.split.size* é **Long.MAX** e *dfs.block.size* é 64MB.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-185">Typically, hello default value of *mapred.min.split.size* is 0, that of *mapred.max.split.size* is **Long.MAX** and that of *dfs.block.size* is 64MB.</span></span> <span data-ttu-id="8a4b2-186">Como é possível ver, tamanho de dados indicado Olá, otimização estes parâmetros por "definição"-las nos permite tootune Olá diversas mappers utilizado.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-186">As we can see, given hello data size, tuning these parameters by "setting" them allows us tootune hello number of mappers used.</span></span>
4. <span data-ttu-id="8a4b2-187">Outros mais alguns **opções avançadas** para otimizar o ramo de registo desempenho são mencionados abaixo.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-187">A few other more **advanced options** for optimizing Hive performance are mentioned below.</span></span> <span data-ttu-id="8a4b2-188">Estas permitem-lhe tooset Olá memória alocada toomap reduzir as tarefas e podem ser útil para ajustar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-188">These allow you tooset hello memory allocated toomap and reduce tasks, and can be useful in tweaking performance.</span></span> <span data-ttu-id="8a4b2-189">. Tenha em atenção que Olá *mapreduce.reduce.memory.mb* não pode ser superior ao tamanho da memória física Olá de cada nó de trabalho no cluster de Hadoop do Olá.</span><span class="sxs-lookup"><span data-stu-id="8a4b2-189">Please keep in mind that hello *mapreduce.reduce.memory.mb* cannot be greater than hello physical memory size of each worker node in hello Hadoop cluster.</span></span>
   
        set mapreduce.map.memory.mb = 2048;
        set mapreduce.reduce.memory.mb=6144;
        set mapreduce.reduce.java.opts=-Xmx8192m;
        set mapred.reduce.tasks=128;
        set mapred.tasktracker.reduce.tasks.maximum=128;

