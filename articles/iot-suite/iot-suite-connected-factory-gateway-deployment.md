---
title: aaaDeploy ligado do Azure IoT Suite factory gateway | Microsoft Docs
description: "Como toodeploy um gateway no Windows ou Linux toohello de conectividade tooenable ligadas fábrica solução pré-configurada."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="4e01c-103">Implementar um gateway no Windows ou Linux para a solução de fábrica pré-configurada Olá ligado</span><span class="sxs-lookup"><span data-stu-id="4e01c-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="4e01c-104">Olá software necessário toodeploy um gateway para a solução de fábrica pré-configurada Olá ligado tem dois componentes:</span><span class="sxs-lookup"><span data-stu-id="4e01c-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="4e01c-105">Olá *OPC Proxy* estabelece uma ligação tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="4e01c-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="4e01c-106">Olá *OPC Proxy* , em seguida, aguarda para mensagens de comando e controlo de Olá integrado OPC Browser, que é executado no portal de solução Olá fábrica ligado.</span><span class="sxs-lookup"><span data-stu-id="4e01c-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="4e01c-107">Olá *OPC publicador* liga os servidores OPC UA tooexisting no local e reencaminha as mensagens de telemetria dos mesmos tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="4e01c-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="4e01c-108">Ambos os componentes são open source e estão disponíveis como origem no GitHub e como contentores de Docker:</span><span class="sxs-lookup"><span data-stu-id="4e01c-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="4e01c-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="4e01c-109">GitHub</span></span> | <span data-ttu-id="4e01c-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="4e01c-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="4e01c-111">[Publicador OPC][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="4e01c-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="4e01c-112">[Publicador OPC][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="4e01c-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="4e01c-113">[OPC Proxy][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="4e01c-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="4e01c-114">[OPC Proxy][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="4e01c-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="4e01c-115">Nenhum destinado ao público endereço IP ou holes na firewall do gateway Olá são necessários para o componente.</span><span class="sxs-lookup"><span data-stu-id="4e01c-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="4e01c-116">Olá OPC Proxy e o publicador OPC utilizam apenas saídas portas 443, 5671 e 8883.</span><span class="sxs-lookup"><span data-stu-id="4e01c-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="4e01c-117">Olá passos neste artigo mostram-lhe como toodeploy um gateway com o Docker numa [Windows](#windows-deployment) ou [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="4e01c-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="4e01c-118">gateway de Olá permite conectividade toohello ligado fábrica pré-configurada solução.</span><span class="sxs-lookup"><span data-stu-id="4e01c-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="4e01c-119">Olá gateway software que é executado no contentor de Docker Olá é [Azure IoT Edge].</span><span class="sxs-lookup"><span data-stu-id="4e01c-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="4e01c-120">Implementação do Windows</span><span class="sxs-lookup"><span data-stu-id="4e01c-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="4e01c-121">Se ainda não tiver um dispositivo de gateway, a Microsoft recomenda que comprar um gateway comercial a partir de um dos nossos parceiros.</span><span class="sxs-lookup"><span data-stu-id="4e01c-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="4e01c-122">Visite Olá [catálogo de dispositivos do IoT do Azure] para obter uma lista de dispositivos de gateway compatíveis com Olá ligado solução de fábrica.</span><span class="sxs-lookup"><span data-stu-id="4e01c-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="4e01c-123">Siga as instruções de Olá que vêm com Olá dispositivo tooset segurança gateway Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="4e01c-124">Em alternativa, utilize Olá toomanually instruções dos gateways de existentes configurar os seguintes.</span><span class="sxs-lookup"><span data-stu-id="4e01c-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="4e01c-125">Instalar Docker</span><span class="sxs-lookup"><span data-stu-id="4e01c-125">Install Docker</span></span>

<span data-ttu-id="4e01c-126">Instalar [Docker para Windows] no seu dispositivo de gateway baseado no Windows.</span><span class="sxs-lookup"><span data-stu-id="4e01c-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="4e01c-127">Durante a configuração do Windows Docker, selecione uma unidade no seu tooshare da máquina de anfitrião com o Docker.</span><span class="sxs-lookup"><span data-stu-id="4e01c-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="4e01c-128">Olá seguinte captura de ecrã mostra a partilha de unidade de Olá D no seu sistema do Windows:</span><span class="sxs-lookup"><span data-stu-id="4e01c-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Instalar Docker][img-install-docker]

<span data-ttu-id="4e01c-130">Em seguida, crie uma pasta denominada **docker** na raiz de Olá da Olá as unidades partilhadas.</span><span class="sxs-lookup"><span data-stu-id="4e01c-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="4e01c-131">Também pode efetuar este passo depois de instalar o docker de Olá **definições** menu.</span><span class="sxs-lookup"><span data-stu-id="4e01c-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="4e01c-132">Configurar o gateway de Olá</span><span class="sxs-lookup"><span data-stu-id="4e01c-132">Configure hello gateway</span></span>

1. <span data-ttu-id="4e01c-133">Terá de Olá **iothubowner** cadeia de ligação do seu Azure IoT Suite ligado a implementação do factory implementação toocomplete Olá gateway.</span><span class="sxs-lookup"><span data-stu-id="4e01c-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="4e01c-134">No Olá [portal do Azure], navegue até tooyour IoT Hub no grupo de recursos de Olá criado quando implementou a solução de fábrica Olá ligado.</span><span class="sxs-lookup"><span data-stu-id="4e01c-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="4e01c-135">Clique em **políticas de acesso partilhado** tooaccess Olá **iothubowner** cadeia de ligação:</span><span class="sxs-lookup"><span data-stu-id="4e01c-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Determinar Olá cadeia de ligação do IoT Hub][img-hub-connection]

    <span data-ttu-id="4e01c-137">Olá cópia **cadeia de ligação - chave primária** valor.</span><span class="sxs-lookup"><span data-stu-id="4e01c-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="4e01c-138">Configurar o gateway de Olá para o seu IoT Hub através da execução de módulos de gateway Olá dois **depois** numa linha de comandos com:</span><span class="sxs-lookup"><span data-stu-id="4e01c-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="4e01c-139">**&lt;ApplicationName&gt;**  é Olá nome toogive tooyour OPC UA publicador no formato de Olá **publicador.&lt; o nome de domínio completamente qualificado&gt;**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="4e01c-140">Por exemplo, se denomina-se a sua rede de fábrica **myfactorynetwork.com**, Olá **ApplicationName** valor é **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="4e01c-141">**&lt;IoTHubOwnerConnectionString&gt;**  é Olá **iothubowner** cadeia de ligação que copiou no passo anterior Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="4e01c-142">Esta cadeia de ligação é apenas utilizada neste passo, não precisa, no Olá os seguintes passos:</span><span class="sxs-lookup"><span data-stu-id="4e01c-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="4e01c-143">Utilizar Olá mapeado d:\\pasta docker (Olá `-v` argumento) toopersist posterior Olá dois certificados x. 509 que utilizam módulos de gateway Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="4e01c-144">Executar Olá gateway</span><span class="sxs-lookup"><span data-stu-id="4e01c-144">Run hello gateway</span></span>

1. <span data-ttu-id="4e01c-145">Reinicie o gateway de Olá utilizando Olá os seguintes comandos:</span><span class="sxs-lookup"><span data-stu-id="4e01c-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="4e01c-146">Por motivos de segurança, certificados de x. 509 Olá dois continuada no Olá d:\\pasta docker contém a chave privada Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="4e01c-147">Limitar acesso toothis pasta toohello credenciais (normalmente **administradores**) utilizar o contentor de Docker toorun Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="4e01c-148">Contexto Olá d:\\pasta docker, escolha **propriedades**, em seguida, **segurança**e, em seguida, **editar**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="4e01c-149">Dê **administradores** controlo total e remover todas as pessoas pessoa:</span><span class="sxs-lookup"><span data-stu-id="4e01c-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Partilha de tooDocker conceder permissões][img-docker-share]

1. <span data-ttu-id="4e01c-151">Verifique a conectividade de rede.</span><span class="sxs-lookup"><span data-stu-id="4e01c-151">Verify network connectivity.</span></span> <span data-ttu-id="4e01c-152">Numa linha de comandos, introduza o comando de Olá `ping publisher.<your fully qualified domain name>` tooping o gateway.</span><span class="sxs-lookup"><span data-stu-id="4e01c-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="4e01c-153">Se o destino de Olá está inacessível, adicione endereço IP de Olá e o nome do seu ficheiro de anfitriões do gateway toohello no seu gateway.</span><span class="sxs-lookup"><span data-stu-id="4e01c-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="4e01c-154">ficheiro de anfitriões de Olá está localizado na Olá **Windows\\System32\\controladores\\etc** pasta.</span><span class="sxs-lookup"><span data-stu-id="4e01c-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="4e01c-155">Em seguida, tente tooconnect toohello publicador utilizando um cliente de OPC UA local em execução no gateway de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="4e01c-156">Olá ponto final de OPC UA URL é `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="4e01c-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="4e01c-157">Se não tiver um cliente de OPC UA, pode transferir e utilizar um [cliente de OPC UA open source].</span><span class="sxs-lookup"><span data-stu-id="4e01c-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="4e01c-158">Quando tiver concluído com êxito estes testes locais, procurar toohello **ligar o seu próprio servidor de UA OPC** página no portal de solução Olá fábrica ligado.</span><span class="sxs-lookup"><span data-stu-id="4e01c-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="4e01c-159">Introduza o URL de ponto final do publicador Olá (`tcp://publisher.<your fully qualified domain name>:62222`) e clique em **Connect**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="4e01c-160">Receber um aviso de certificado, em seguida, clique em **continuar.**</span><span class="sxs-lookup"><span data-stu-id="4e01c-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="4e01c-161">Em seguida obtiver um erro que Olá publicador não confia Olá UA Web cliente.</span><span class="sxs-lookup"><span data-stu-id="4e01c-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="4e01c-162">tooresolve este erro, Olá cópia **UA Web cliente** certificado Olá **D:\\docker\\rejeitado certificados\\certificados** pasta toohello **D:\\docker\\UA aplicações\\certificados** pasta no gateway de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="4e01c-163">Não é necessário toorestart do gateway de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="4e01c-164">Repita este passo.</span><span class="sxs-lookup"><span data-stu-id="4e01c-164">Repeat this step.</span></span> <span data-ttu-id="4e01c-165">Pode agora ligar toohello gateway de nuvem Olá e estiver pronto tooadd solução de toohello OPC UA servidores.</span><span class="sxs-lookup"><span data-stu-id="4e01c-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="4e01c-166">Adicionar os servidores de OPC UA</span><span class="sxs-lookup"><span data-stu-id="4e01c-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="4e01c-167">Procurar toohello **ligar o seu próprio servidor de UA OPC** página no portal de solução Olá fábrica ligado.</span><span class="sxs-lookup"><span data-stu-id="4e01c-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="4e01c-168">Siga os passos da Olá anterior a secção tooestablish ends confiam entre o Olá portal fábrica ligado e hello do servidor de OPC UA de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="4e01c-169">Este passo estabelece uma confiança de certificados de Olá da Olá mútua ligado portal de fábrica e Olá servidor OPC UA e cria uma ligação.</span><span class="sxs-lookup"><span data-stu-id="4e01c-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="4e01c-170">Procurar Olá árvore de nós de OPC UA do seu servidor de OPC UA, nós OPC Olá com o botão direito e selecione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="4e01c-171">Para publicação toowork desta forma, Olá servidor OPC UA e Olá publicador tem de ser no Olá mesma rede.</span><span class="sxs-lookup"><span data-stu-id="4e01c-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="4e01c-172">Por outras palavras, se Olá totalmente qualificado o nome de domínio do publicador Olá é **publisher.mydomain.com** , em seguida, nome de domínio completamente qualificado Olá de Olá OPC UA servidor tem de ser, por exemplo, **myopcuaserver.mydomain.com**. Se o programa de configuração for diferente, pode adicionar manualmente ficheiros publishesnodes.json toohello de nós encontrado no Olá **D:\\docker** pasta.</span><span class="sxs-lookup"><span data-stu-id="4e01c-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="4e01c-173">Olá publishesnodes.json ficheiro é gerado automaticamente no Olá primeiro bem-sucedida publicar de um nó OPC.</span><span class="sxs-lookup"><span data-stu-id="4e01c-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="4e01c-174">Agora flui de telemetria do dispositivo de gateway Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="4e01c-175">Pode ver a telemetria Olá no Olá **fábrica localizações** vista do portal de fábrica ligado Olá em **nova fábrica**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="4e01c-176">Implementação do Linux</span><span class="sxs-lookup"><span data-stu-id="4e01c-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="4e01c-177">Se ainda não tiver um dispositivo de gateway, a Microsoft recomenda que comprar um gateway comercial a partir de um dos nossos parceiros.</span><span class="sxs-lookup"><span data-stu-id="4e01c-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="4e01c-178">Visite Olá [catálogo de dispositivos do IoT do Azure] para obter uma lista de dispositivos de gateway compatíveis com Olá ligado solução de fábrica.</span><span class="sxs-lookup"><span data-stu-id="4e01c-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="4e01c-179">Siga as instruções de Olá que vêm com Olá dispositivo tooset segurança gateway Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="4e01c-180">Em alternativa, utilize Olá toomanually instruções dos gateways de existentes configurar os seguintes.</span><span class="sxs-lookup"><span data-stu-id="4e01c-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="4e01c-181">[Instalar Docker] no seu dispositivo de gateway do Linux.</span><span class="sxs-lookup"><span data-stu-id="4e01c-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="4e01c-182">Configurar o gateway de Olá</span><span class="sxs-lookup"><span data-stu-id="4e01c-182">Configure hello gateway</span></span>

1. <span data-ttu-id="4e01c-183">Terá de Olá **iothubowner** cadeia de ligação do seu Azure IoT Suite ligado a implementação do factory implementação toocomplete Olá gateway.</span><span class="sxs-lookup"><span data-stu-id="4e01c-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="4e01c-184">No Olá [portal do Azure], navegue até tooyour IoT Hub no grupo de recursos de Olá criado quando implementou a solução de fábrica Olá ligado.</span><span class="sxs-lookup"><span data-stu-id="4e01c-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="4e01c-185">Clique em **políticas de acesso partilhado** tooaccess Olá **iothubowner** cadeia de ligação:</span><span class="sxs-lookup"><span data-stu-id="4e01c-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Determinar Olá cadeia de ligação do IoT Hub][img-hub-connection]

    <span data-ttu-id="4e01c-187">Olá cópia **cadeia de ligação - chave primária** valor.</span><span class="sxs-lookup"><span data-stu-id="4e01c-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="4e01c-188">Configurar o gateway de Olá para o seu IoT Hub através da execução de módulos de gateway Olá dois **depois** de uma shell com:</span><span class="sxs-lookup"><span data-stu-id="4e01c-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="4e01c-189">**&lt;ApplicationName&gt;**  é Olá nome de Olá gateway de Olá OPC UA aplicação cria no formato de Olá **publicador.&lt; o nome de domínio completamente qualificado&gt;**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="4e01c-190">Por exemplo, **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="4e01c-191">**&lt;IoTHubOwnerConnectionString&gt;**  é Olá **iothubowner** cadeia de ligação que copiou no passo anterior Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="4e01c-192">Esta cadeia de ligação é apenas utilizada neste passo, não precisa, no Olá os seguintes passos:</span><span class="sxs-lookup"><span data-stu-id="4e01c-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="4e01c-193">Utilizar Olá **/ partilhado** pasta (Olá `-v` argumento) toopersist posterior Olá dois certificados x. 509 que utilizam módulos de gateway Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="4e01c-194">Executar Olá gateway</span><span class="sxs-lookup"><span data-stu-id="4e01c-194">Run hello gateway</span></span>

1. <span data-ttu-id="4e01c-195">Reinicie o gateway de Olá utilizando Olá os seguintes comandos:</span><span class="sxs-lookup"><span data-stu-id="4e01c-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="4e01c-196">Por motivos de segurança, certificados de x. 509 Olá dois continuada no Olá **/ partilhado** pasta contém a chave privada Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="4e01c-197">Limite acesso toothis pasta toohello credenciais a utilizar toorun Olá contentor de Docker.</span><span class="sxs-lookup"><span data-stu-id="4e01c-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="4e01c-198">permissões de Olá tooset para **raiz** apenas, utilize Olá `chmod` shell de comandos na pasta Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="4e01c-199">Verifique a conectividade de rede.</span><span class="sxs-lookup"><span data-stu-id="4e01c-199">Verify network connectivity.</span></span> <span data-ttu-id="4e01c-200">A partir de uma shell, introduza o comando de Olá `ping publisher.<your fully qualified domain name>` tooping o gateway.</span><span class="sxs-lookup"><span data-stu-id="4e01c-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="4e01c-201">Se o destino de Olá está inacessível, adicione endereço IP de Olá e o nome do seu ficheiro de anfitriões do gateway tooyour no seu gateway.</span><span class="sxs-lookup"><span data-stu-id="4e01c-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="4e01c-202">ficheiro de anfitriões de Olá está localizado na Olá **/etc** pasta.</span><span class="sxs-lookup"><span data-stu-id="4e01c-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="4e01c-203">Em seguida, tente tooconnect toohello publicador utilizando um cliente de OPC UA local em execução no gateway de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="4e01c-204">Olá ponto final de OPC UA URL é `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="4e01c-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="4e01c-205">Se não tiver um cliente de OPC UA, pode transferir e utilizar um [cliente de OPC UA open source].</span><span class="sxs-lookup"><span data-stu-id="4e01c-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="4e01c-206">Quando tiver concluído com êxito estes testes locais, procurar toohello **ligar o seu próprio servidor de UA OPC** página no portal de solução Olá fábrica ligado.</span><span class="sxs-lookup"><span data-stu-id="4e01c-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="4e01c-207">Introduza o URL de ponto final do publicador Olá (`tcp://publisher.<your fully qualified domain name>:62222`) e clique em **Connect**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="4e01c-208">Receber um aviso de certificado, em seguida, clique em **continuar.**</span><span class="sxs-lookup"><span data-stu-id="4e01c-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="4e01c-209">Em seguida obtiver um erro que Olá publicador não confia Olá UA Web cliente.</span><span class="sxs-lookup"><span data-stu-id="4e01c-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="4e01c-210">tooresolve este erro, Olá cópia **UA Web cliente** certificado Olá **partilhado/rejeitado certificados/certificados** pasta toohello **/shared/UA aplicações/certificados** pasta no gateway de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="4e01c-211">Não é necessário toorestart do gateway de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="4e01c-212">Repita este passo.</span><span class="sxs-lookup"><span data-stu-id="4e01c-212">Repeat this step.</span></span> <span data-ttu-id="4e01c-213">Pode agora ligar toohello gateway de nuvem Olá e estiver pronto tooadd solução de toohello OPC UA servidores.</span><span class="sxs-lookup"><span data-stu-id="4e01c-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="4e01c-214">Adicionar os servidores de OPC UA</span><span class="sxs-lookup"><span data-stu-id="4e01c-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="4e01c-215">Procurar toohello **ligar o seu próprio servidor de UA OPC** página no portal de solução Olá fábrica ligado.</span><span class="sxs-lookup"><span data-stu-id="4e01c-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="4e01c-216">Siga os passos da Olá anterior a secção tooestablish ends confiam entre o Olá portal fábrica ligado e hello do servidor de OPC UA de Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="4e01c-217">Este passo estabelece uma confiança de certificados de Olá da Olá mútua ligado portal de fábrica e Olá servidor OPC UA e cria uma ligação.</span><span class="sxs-lookup"><span data-stu-id="4e01c-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="4e01c-218">Procurar Olá árvore de nós de OPC UA do seu servidor de OPC UA, nós OPC Olá com o botão direito e selecione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="4e01c-219">Para publicação toowork desta forma, Olá servidor OPC UA e Olá publicador tem de ser no Olá mesma rede.</span><span class="sxs-lookup"><span data-stu-id="4e01c-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="4e01c-220">Por outras palavras, se Olá totalmente qualificado o nome de domínio do publicador Olá é **publisher.mydomain.com** , em seguida, nome de domínio completamente qualificado Olá de Olá OPC UA servidor tem de ser, por exemplo, **myopcuaserver.mydomain.com**. Se o programa de configuração for diferente, pode adicionar manualmente ficheiros publishesnodes.json toohello de nós encontrado no Olá **/ partilhado** pasta.</span><span class="sxs-lookup"><span data-stu-id="4e01c-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="4e01c-221">Olá publishesnodes.json é gerado automaticamente no Olá primeiro bem-sucedida publicar de um nó OPC.</span><span class="sxs-lookup"><span data-stu-id="4e01c-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="4e01c-222">Agora flui de telemetria do dispositivo de gateway Olá.</span><span class="sxs-lookup"><span data-stu-id="4e01c-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="4e01c-223">Pode ver a telemetria Olá no Olá **fábrica localizações** vista do portal de fábrica ligado Olá em **nova fábrica**.</span><span class="sxs-lookup"><span data-stu-id="4e01c-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4e01c-224">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="4e01c-224">Next steps</span></span>

<span data-ttu-id="4e01c-225">toolearn mais informações sobre a arquitetura de Olá do factory ligado Olá solução pré-configurada, consulte [instruções sobre a solução pré-configurada de fábrica ligada][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="4e01c-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker para Windows]: https://www.docker.com/docker-windows
[catálogo de dispositivos do IoT do Azure]: https://catalog.azureiotsuite.com/?q=opc
[portal do Azure]: http://portal.azure.com/
[cliente de OPC UA open source]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Instalar Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT Edge]: https://github.com/Azure/iot-edge

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy