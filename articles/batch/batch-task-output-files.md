---
title: "aaaPersist tarefas e saída tooAzure armazenamento com Olá API do serviço Azure Batch | Microsoft Docs"
description: "Saiba como tarefas de lote de toopersist toouse API do serviço Batch e tarefa tooAzure armazenamento de saída."
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 71b3f7c0dda2d2a9d8eb3eef83229873c70ca22c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="persist-task-data-tooazure-storage-with-hello-batch-service-api"></a><span data-ttu-id="28661-103">Manter tarefas dados tooAzure armazenamento com Olá API do serviço de Batch</span><span class="sxs-lookup"><span data-stu-id="28661-103">Persist task data tooAzure Storage with hello Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="28661-104">A partir da versão de 2017-05-01, Olá API do serviço Batch suporta persistentes tooAzure de dados de saída armazenamento para tarefas e tarefas de Gestor de tarefas que são executadas em conjuntos com a configuração da máquina virtual Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-104">Starting with version 2017-05-01, hello Batch service API supports persisting output data tooAzure Storage for tasks and job manager tasks that run on pools with hello virtual machine configuration.</span></span> <span data-ttu-id="28661-105">Quando adiciona uma tarefa, pode especificar um contentor no armazenamento do Azure como destino de Olá para o resultado da tarefa de Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-105">When you add a task, you can specify a container in Azure Storage as hello destination for hello task's output.</span></span> <span data-ttu-id="28661-106">serviço de Batch de Olá, em seguida, qualquer contentor de toothat de dados de saída quando escreve Olá tarefa estar concluída.</span><span class="sxs-lookup"><span data-stu-id="28661-106">hello Batch service then writes any output data toothat container when hello task is complete.</span></span>

<span data-ttu-id="28661-107">Um Olá de toousing partido Batch resultado da tarefa do serviço API toopersist é que não precisa de aplicação Olá toomodify Olá tarefas está em execução.</span><span class="sxs-lookup"><span data-stu-id="28661-107">An advantage toousing hello Batch service API toopersist task output is that you do not need toomodify hello application that hello task is running.</span></span> <span data-ttu-id="28661-108">Em vez disso, com a aplicação de cliente de tooyour de algumas alterações simples, pode manter uma saída da tarefa de Olá da dentro do código de Olá que cria a tarefa de Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-108">Instead, with a few simple modifications tooyour client application, you can persist hello task's output from within hello code that creates hello task.</span></span>   

## <a name="when-do-i-use-hello-batch-service-api-toopersist-task-output"></a><span data-ttu-id="28661-109">Quando utilizar o resultado da tarefa toopersist Olá API do serviço de Batch?</span><span class="sxs-lookup"><span data-stu-id="28661-109">When do I use hello Batch service API toopersist task output?</span></span>

<span data-ttu-id="28661-110">O Azure Batch fornece mais de uma forma toopersist o resultado da tarefa.</span><span class="sxs-lookup"><span data-stu-id="28661-110">Azure Batch provides more than one way toopersist task output.</span></span> <span data-ttu-id="28661-111">A utilização de Olá API do serviço de Batch é uma abordagem conveniente que é melhor se adequam toothese cenários:</span><span class="sxs-lookup"><span data-stu-id="28661-111">Using hello Batch service API is a convenient approach that's best suited toothese scenarios:</span></span>

- <span data-ttu-id="28661-112">Pretende toowrite código toopersist o resultado da tarefa de dentro da sua aplicação de cliente, sem modificar aplicação Olá que está a executar a tarefa.</span><span class="sxs-lookup"><span data-stu-id="28661-112">You want toowrite code toopersist task output from within your client application, without modifying hello application that your task is running.</span></span>
- <span data-ttu-id="28661-113">Pretende toopersist saída de tarefas de lote e o Gestor de tarefas em conjuntos criados com a configuração da máquina virtual Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-113">You want toopersist output from Batch tasks and job manager tasks in pools created with hello virtual machine configuration.</span></span>
- <span data-ttu-id="28661-114">Pretende que o contentor de armazenamento do Azure do toopersist saída tooan com um nome arbitrário.</span><span class="sxs-lookup"><span data-stu-id="28661-114">You want toopersist output tooan Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="28661-115">Pretende toopersist saída tooan Storage do Azure contentor com o nome de acordo com toohello [padrão de convenções de ficheiro Batch](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="28661-115">You want toopersist output tooan Azure Storage container named according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="28661-116">Se o seu cenário difere de acordo com os listado acima, poderá ser necessário tooconsider uma abordagem diferente.</span><span class="sxs-lookup"><span data-stu-id="28661-116">If your scenario differs from those listed above, you may need tooconsider a different approach.</span></span> <span data-ttu-id="28661-117">Por exemplo, API do serviço de Batch de Olá não suporta atualmente transmissão em fluxo de saída de tooAzure armazenamento durante a execução Olá tarefa.</span><span class="sxs-lookup"><span data-stu-id="28661-117">For example, hello Batch service API does not currently support streaming output tooAzure Storage while hello task is running.</span></span> <span data-ttu-id="28661-118">toostream de saída, considere utilizar a biblioteca de convenções de ficheiro Batch Olá, disponível para o .NET.</span><span class="sxs-lookup"><span data-stu-id="28661-118">toostream output, consider using hello Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="28661-119">Para outros idiomas, terá de tooimplement sua própria solução.</span><span class="sxs-lookup"><span data-stu-id="28661-119">For other languages, you'll need tooimplement your own solution.</span></span> <span data-ttu-id="28661-120">Para obter mais informações sobre outras opções para persistentes resultado da tarefa, consulte [manter tarefas e saída tooAzure armazenamento](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="28661-120">For more information on other options for persisting task output, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="28661-121">Criar um contentor de armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="28661-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="28661-122">tarefa toopersist saída tooAzure armazenamento, terá de toocreate um contentor que funciona como destino de Olá para os ficheiros de saída.</span><span class="sxs-lookup"><span data-stu-id="28661-122">toopersist task output tooAzure Storage, you'll need toocreate a container that serves as hello destination for your output files.</span></span> <span data-ttu-id="28661-123">Crie contentor de Olá antes de executar a tarefa, preferencialmente, antes de submeter a tarefa.</span><span class="sxs-lookup"><span data-stu-id="28661-123">Create hello container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="28661-124">contentor de Olá toocreate, a biblioteca de clientes de armazenamento do Azure adequada do utilize Olá ou o SDK.</span><span class="sxs-lookup"><span data-stu-id="28661-124">toocreate hello container, use hello appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="28661-125">Para obter mais informações sobre as APIs de armazenamento do Azure, consulte Olá [documentação do Storage do Azure](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="28661-125">For more information about Azure Storage APIs, see hello [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="28661-126">Por exemplo, se estiver a escrever a aplicação em c#, utilizar Olá [biblioteca de clientes do Storage do Azure para .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="28661-126">For example, if you are writing your application in C#, use hello [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="28661-127">Olá seguinte exemplo mostra como toocreate um contentor:</span><span class="sxs-lookup"><span data-stu-id="28661-127">hello following example shows how toocreate a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-hello-container"></a><span data-ttu-id="28661-128">Obter uma assinatura de acesso partilhado do contentor de Olá</span><span class="sxs-lookup"><span data-stu-id="28661-128">Get a shared access signature for hello container</span></span>

<span data-ttu-id="28661-129">Depois de criar o contentor de Olá, obtenha uma assinatura de acesso partilhado (SAS) com acesso de escrita toohello contentor.</span><span class="sxs-lookup"><span data-stu-id="28661-129">After you create hello container, get a shared access signature (SAS) with write access toohello container.</span></span> <span data-ttu-id="28661-130">Uma SAS fornece o contentor de toohello acesso delegado.</span><span class="sxs-lookup"><span data-stu-id="28661-130">A SAS provides delegated access toohello container.</span></span> <span data-ttu-id="28661-131">Olá SAS concede acesso com um conjunto especificado de permissões e ao longo de um intervalo de tempo especificado.</span><span class="sxs-lookup"><span data-stu-id="28661-131">hello SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="28661-132">Olá serviço Batch tem um SAS com o contentor de toohello de saída de tarefas toowrite permissões escrita.</span><span class="sxs-lookup"><span data-stu-id="28661-132">hello Batch service needs a SAS with write permissions toowrite task output toohello container.</span></span> <span data-ttu-id="28661-133">Para obter mais informações sobre SAS, consulte [utilizar assinaturas de acesso partilhado \(SAS\) no armazenamento do Azure](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="28661-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="28661-134">Quando obtiver um SAS com Olá APIs de armazenamento do Azure, Olá API devolve uma cadeia de token SAS.</span><span class="sxs-lookup"><span data-stu-id="28661-134">When you get a SAS using hello Azure Storage APIs, hello API returns a SAS token string.</span></span> <span data-ttu-id="28661-135">Esta cadeia token inclui todos os parâmetros de Olá SAS, incluindo permissões Olá e o intervalo de Olá ao longo do que Olá SAS é válido.</span><span class="sxs-lookup"><span data-stu-id="28661-135">This token string includes all parameters of hello SAS, including hello permissions and hello interval over which hello SAS is valid.</span></span> <span data-ttu-id="28661-136">toouse Olá SAS tooaccess um contentor de armazenamento do Azure, terá de tooappend Olá SAS a cadeia do token toohello URI do recurso.</span><span class="sxs-lookup"><span data-stu-id="28661-136">toouse hello SAS tooaccess a container in Azure Storage, you need tooappend hello SAS token string toohello resource URI.</span></span> <span data-ttu-id="28661-137">Olá URI do recurso, juntamente com Olá anexado SAS token, que fornece acesso autenticado tooAzure armazenamento.</span><span class="sxs-lookup"><span data-stu-id="28661-137">hello resource URI, together with hello appended SAS token, provides authenticated access tooAzure Storage.</span></span>

<span data-ttu-id="28661-138">Olá exemplo seguinte mostra como tooget uma SAS só de escrita a cadeia do token para o contentor de Olá, em seguida, acrescenta contentor de toohello Olá SAS URI:</span><span class="sxs-lookup"><span data-stu-id="28661-138">hello following example shows how tooget a write-only SAS token string for hello container, then appends hello SAS toohello container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="28661-139">Especificar os ficheiros de saída de resultado da tarefa</span><span class="sxs-lookup"><span data-stu-id="28661-139">Specify output files for task output</span></span>

<span data-ttu-id="28661-140">ficheiros de saída toospecify para uma tarefa, criar uma coleção de [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objetos e atribua-lhe toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) propriedade quando criar tarefas de Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-140">toospecify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create hello task.</span></span> 

<span data-ttu-id="28661-141">Olá seguinte exemplo de código .NET cria uma tarefa que escreve o ficheiro de tooa de números aleatórios denominado `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="28661-141">hello following .NET code example creates a task that writes random numbers tooa file named `output.txt`.</span></span> <span data-ttu-id="28661-142">exemplo de Olá cria um ficheiro de saída para `output.txt` toobe escrito toohello contentor.</span><span class="sxs-lookup"><span data-stu-id="28661-142">hello example creates an output file for `output.txt` toobe written toohello container.</span></span> <span data-ttu-id="28661-143">exemplo de Olá também cria ficheiros de saída para todos os ficheiros de registo que correspondam ao padrão de ficheiro Olá `std*.txt` (_por exemplo,_, `stdout.txt` e `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="28661-143">hello example also creates output files for any log files that match hello file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="28661-144">URL do contentor Olá requer Olá SAS que foi criada anteriormente para o contentor de Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-144">hello container URL requires hello SAS that was created previously for hello container.</span></span> <span data-ttu-id="28661-145">Olá serviço Batch utiliza o contentor de toohello Olá SAS tooauthenticate acesso:</span><span class="sxs-lookup"><span data-stu-id="28661-145">hello Batch service uses hello SAS tooauthenticate access toohello container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="28661-146">Especificar um padrão de ficheiro para a correspondência</span><span class="sxs-lookup"><span data-stu-id="28661-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="28661-147">Quando especificar um ficheiro de saída, pode utilizar Olá [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) propriedade toospecify um padrão de ficheiro para a correspondência.</span><span class="sxs-lookup"><span data-stu-id="28661-147">When you specify an output file, you can use hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property toospecify a file pattern for matching.</span></span> <span data-ttu-id="28661-148">padrão de ficheiro Olá pode corresponder zero ficheiros, um único ficheiro ou um conjunto de ficheiros que são criados pela tarefa de Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-148">hello file pattern may match zero files, a single file, or a set of files that are created by hello task.</span></span>

<span data-ttu-id="28661-149">Olá **FilePattern** propriedade suporta carateres universais de sistema de ficheiros padrão, tais como `*` (para recursiva não corresponde a) e `**` (para recursiva corresponde).</span><span class="sxs-lookup"><span data-stu-id="28661-149">hello **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="28661-150">Por exemplo, o exemplo de código Olá acima Especifica Olá ficheiro padrão toomatch `std*.txt` modo não recursivo:</span><span class="sxs-lookup"><span data-stu-id="28661-150">For example, hello code sample above specifies hello file pattern toomatch `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="28661-151">tooupload um único ficheiro e especificar um padrão de ficheiro com carateres não universais.</span><span class="sxs-lookup"><span data-stu-id="28661-151">tooupload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="28661-152">Por exemplo, o exemplo de código Olá acima Especifica Olá ficheiro padrão toomatch `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="28661-152">For example, hello code sample above specifies hello file pattern toomatch `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="28661-153">Especifique uma condição de carregamento</span><span class="sxs-lookup"><span data-stu-id="28661-153">Specify an upload condition</span></span>

<span data-ttu-id="28661-154">Olá [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) propriedade permite condicional o carregamento de ficheiros de saída.</span><span class="sxs-lookup"><span data-stu-id="28661-154">hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="28661-155">Um cenário comum é um conjunto de tooupload de ficheiros se tarefas de Olá for bem sucedida e um conjunto diferente de ficheiros se falhar.</span><span class="sxs-lookup"><span data-stu-id="28661-155">A common scenario is tooupload one set of files if hello task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="28661-156">Por exemplo, poderá pretender que os ficheiros de registo verboso tooupload apenas quando a tarefa de Olá falha e sai com um código de saída diferente de zero.</span><span class="sxs-lookup"><span data-stu-id="28661-156">For example, you may want tooupload verbose log files only when hello task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="28661-157">Da mesma forma, poderá pretender que os ficheiros de resultado tooupload apenas se a tarefa de Olá for bem sucedida, como esses ficheiros poderão estar em falta ou incompletas se Olá tarefa falhar.</span><span class="sxs-lookup"><span data-stu-id="28661-157">Similarly, you may want tooupload result files only if hello task succeeds, as those files may be missing or incomplete if hello task fails.</span></span>

<span data-ttu-id="28661-158">Olá exemplo de código acima define Olá **UploadCondition** propriedade demasiado**TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="28661-158">hello code sample above sets hello **UploadCondition** property too**TaskCompletion**.</span></span> <span data-ttu-id="28661-159">Esta definição especifica que se o ficheiro de Olá é toobe carregado após a conclusão de tarefas Olá, independentemente do valor de Olá do código de saída Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-159">This setting specifies that hello file is toobe uploaded after hello tasks completes, regardless of hello value of hello exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="28661-160">Para outras definições, consulte Olá [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span><span class="sxs-lookup"><span data-stu-id="28661-160">For other settings, see hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-hello-same-name"></a><span data-ttu-id="28661-161">Ambiguidade ficheiros com Olá mesmo nome</span><span class="sxs-lookup"><span data-stu-id="28661-161">Disambiguate files with hello same name</span></span>

<span data-ttu-id="28661-162">tarefas de Olá numa tarefa podem produzir ficheiros que tenham Olá mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="28661-162">hello tasks in a job may produce files that have hello same name.</span></span> <span data-ttu-id="28661-163">Por exemplo, `stdout.txt` e `stderr.txt` são criadas para cada tarefa que é executada uma tarefa.</span><span class="sxs-lookup"><span data-stu-id="28661-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="28661-164">Uma vez cada tarefa é executada no seu próprio contexto, estes ficheiros não estão em conflito no sistema de ficheiros do nó de Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-164">Because each task runs in its own context, these files don't conflict on hello node's file system.</span></span> <span data-ttu-id="28661-165">No entanto, quando carregar ficheiros a partir do contentor partilhados de várias tarefas tooa, terá de ficheiros de toodisambiguate com Olá mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="28661-165">However, when you upload files from multiple tasks tooa shared container, you'll need toodisambiguate files with hello same name.</span></span>

<span data-ttu-id="28661-166">Olá [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) propriedade especifica o blob de destino Olá ou diretório virtual para ficheiros de saída.</span><span class="sxs-lookup"><span data-stu-id="28661-166">hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies hello destination blob or virtual directory for output files.</span></span> <span data-ttu-id="28661-167">Pode utilizar Olá **caminho** blob de Olá tooname de propriedade ou o diretório virtual de forma a que os ficheiros de saída com Olá mesmo nome exclusivamente são denominados no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="28661-167">You can use hello **Path** property tooname hello blob or virtual directory in such a way that output files with hello same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="28661-168">Com o ID de tarefa Olá no caminho de Olá é uma boa forma tooensure os nomes exclusivos de e identificar facilmente os ficheiros.</span><span class="sxs-lookup"><span data-stu-id="28661-168">Using hello task ID in hello path is a good way tooensure unique names and easily identify files.</span></span>

<span data-ttu-id="28661-169">Se hello **FilePattern** propriedade está definida a expressão com carateres universais de tooa, em seguida, todos os ficheiros que correspondam ao padrão Olá são carregados toohello diretório virtual especificado pelo Olá **caminho** propriedade.</span><span class="sxs-lookup"><span data-stu-id="28661-169">If hello **FilePattern** property is set tooa wildcard expression, then all files that match hello pattern are uploaded toohello virtual directory specified by hello **Path** property.</span></span> <span data-ttu-id="28661-170">Por exemplo, se hello contentor é `mycontainer`, tarefas Olá ID é `mytask`, e Olá padrão de ficheiro é `..\std*.txt`, em seguida, Olá absoluto URIs toohello ficheiros de saída no armazenamento do Azure será semelhantes a:</span><span class="sxs-lookup"><span data-stu-id="28661-170">For example, if hello container is `mycontainer`, hello task ID is `mytask`, and hello file pattern is `..\std*.txt`, then hello absolute URIs toohello output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="28661-171">Se hello **FilePattern** propriedade é o conjunto toomatch um nome de ficheiro único, que significa que não contém quaisquer carateres universais, Olá, em seguida, o valor de Olá **caminho** propriedade especifica o nome do blob completamente qualificado de Olá .</span><span class="sxs-lookup"><span data-stu-id="28661-171">If hello **FilePattern** property is set toomatch a single file name, meaning it does not contain any wildcard characters, then hello value of hello **Path** property specifies hello fully qualified blob name.</span></span> <span data-ttu-id="28661-172">Se prevê a atribuição de nome entra em conflito com um único ficheiro de várias tarefas, em seguida, inclua Olá nome do diretório virtual Olá como parte da toodisambiguate de nome de ficheiro Olá esses ficheiros.</span><span class="sxs-lookup"><span data-stu-id="28661-172">If you anticipate naming conflicts with a single file from multiple tasks, then include hello name of hello virtual directory as part of hello file name toodisambiguate those files.</span></span> <span data-ttu-id="28661-173">Por exemplo, o conjunto Olá **caminho** propriedade tooinclude Olá ID de tarefa, o caráter delimitador de Olá (normalmente, uma barra) e o nome de ficheiro Olá:</span><span class="sxs-lookup"><span data-stu-id="28661-173">For example, set hello **Path** property tooinclude hello task ID, hello delimiter character (typically a forward slash), and hello file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="28661-174">Olá absolutos URIs toohello ficheiros de saída para um conjunto de tarefas será semelhantes a:</span><span class="sxs-lookup"><span data-stu-id="28661-174">hello absolute URIs toohello output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="28661-175">Para obter mais informações sobre os diretórios virtuais no armazenamento do Azure, consulte [listar Olá blobs num contentor](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="28661-175">For more information about virtual directories in Azure Storage, see [List hello blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="28661-176">Diagnosticar erros de carregamento de ficheiros</span><span class="sxs-lookup"><span data-stu-id="28661-176">Diagnose file upload errors</span></span>

<span data-ttu-id="28661-177">Se a saída de carregar ficheiros tooAzure armazenamento falhar, então tarefas Olá move toohello **concluído** estado e Olá [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) propriedade está definida.</span><span class="sxs-lookup"><span data-stu-id="28661-177">If uploading output files tooAzure Storage fails, then hello task moves toohello **Completed** state and hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="28661-178">Examine Olá **FailureInformation** toodetermine propriedade Ocorreu o erro.</span><span class="sxs-lookup"><span data-stu-id="28661-178">Examine hello **FailureInformation** property toodetermine what error occurred.</span></span> <span data-ttu-id="28661-179">Por exemplo, é um erro que ocorre no carregamento do ficheiro se não é possível localizar o contentor de Olá aqui:</span><span class="sxs-lookup"><span data-stu-id="28661-179">For example, here is an error that occurs on file upload if hello container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of hello specified Azure container(s) was not found while attempting tooupload an output file
```

<span data-ttu-id="28661-180">Em cada carregamento de ficheiros, o Batch escreve dois nós de computação toohello de ficheiros, de registo `fileuploadout.txt` e `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="28661-180">On every file upload, Batch writes two log files toohello compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="28661-181">Pode examinar estes toolearn de ficheiros de registo mais informações sobre uma falha específica.</span><span class="sxs-lookup"><span data-stu-id="28661-181">You can examine these log files toolearn more about a specific failure.</span></span> <span data-ttu-id="28661-182">Nos casos em que carregamento do ficheiro Olá nunca tentou, por exemplo porque não foi possível executar a tarefa de Olá próprio, em seguida, estes ficheiros de registo não existirá.</span><span class="sxs-lookup"><span data-stu-id="28661-182">In cases where hello file upload was never attempted, for example because hello task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="28661-183">Diagnosticar o desempenho de carregamento de ficheiros</span><span class="sxs-lookup"><span data-stu-id="28661-183">Diagnose file upload performance</span></span>

<span data-ttu-id="28661-184">Olá `fileuploadout.txt` progresso do carregamento de registos de ficheiros.</span><span class="sxs-lookup"><span data-stu-id="28661-184">hello `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="28661-185">Pode examinar toolearn este ficheiro mais informações sobre quanto carrega o ficheiro estão a demorar.</span><span class="sxs-lookup"><span data-stu-id="28661-185">You can examine this file toolearn more about how long your file uploads are taking.</span></span> <span data-ttu-id="28661-186">Tenha em atenção que existem muitos fatores coadjuvantes desempenho tooupload, incluindo o tamanho de Olá do nó de Olá, outra atividade no nó de Olá momento Olá de carregamento de Olá, se é um contentor de destino Olá no Olá mesma região que o conjunto do Batch Olá, o número de nós são a carregar a conta de armazenamento toohello em Olá mesmo tempo e assim sucessivamente.</span><span class="sxs-lookup"><span data-stu-id="28661-186">Keep in mind that there are many contributing factors tooupload performance, including hello size of hello node, other activity on hello node at hello time of hello upload, whether hello target container is in hello same region as hello Batch pool, how many nodes are uploading toohello storage account at hello same time, and so on.</span></span>

## <a name="use-hello-batch-service-api-with-hello-batch-file-conventions-standard"></a><span data-ttu-id="28661-187">Utilizar a API do serviço de Batch de Olá com Olá convenções de ficheiros de lote standard</span><span class="sxs-lookup"><span data-stu-id="28661-187">Use hello Batch service API with hello Batch File Conventions standard</span></span>

<span data-ttu-id="28661-188">Quando a manter o resultado da tarefa com Olá API do serviço Batch, pode atribuir o nome do contentor de destino e no entanto, como de blobs.</span><span class="sxs-lookup"><span data-stu-id="28661-188">When you persist task output with hello Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="28661-189">Também pode escolher tooname-las de acordo com toohello [padrão de convenções de ficheiro Batch](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="28661-189">You can also choose tooname them according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="28661-190">padrão de ficheiro convenções de Olá determina Olá os nomes de contentor de destino Olá e blob no Storage do Azure para um ficheiro de saída determinado com base nos nomes de Olá de tarefas e projetos Olá.</span><span class="sxs-lookup"><span data-stu-id="28661-190">hello File Conventions standard determines hello names of hello destination container and blob in Azure Storage for a given output file based on hello names of hello job and task.</span></span> <span data-ttu-id="28661-191">Se utilizar Olá convenções de ficheiro padrão de nomenclatura de ficheiros de saída, em seguida, os ficheiros de saída estão disponíveis para visualização nos Olá [portal do Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="28661-191">If you do use hello File Conventions standard for naming output files, then your output files are available for viewing in hello [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="28661-192">Se estiver a desenvolver em c#, pode utilizar métodos de Olá construídos Olá [biblioteca convenções de ficheiro Batch para .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="28661-192">If you are developing in C#, you can use hello methods built into hello [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="28661-193">Esta biblioteca cria Olá corretamente com o nome contentores e BLOBs caminhos para si.</span><span class="sxs-lookup"><span data-stu-id="28661-193">This library creates hello properly named containers and blob paths for you.</span></span> <span data-ttu-id="28661-194">Por exemplo, pode chamar Olá API tooget Olá o nome de corretos para o contentor de Olá, com base no nome da tarefa Olá:</span><span class="sxs-lookup"><span data-stu-id="28661-194">For example, you can call hello API tooget hello correct name for hello container, based on hello job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="28661-195">Pode utilizar Olá [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) método tooreturn um URL de assinatura (SAS) de acesso partilhado que é utilizado toowrite toohello contentor.</span><span class="sxs-lookup"><span data-stu-id="28661-195">You can use hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method tooreturn a shared access signature (SAS) URL that is used toowrite toohello container.</span></span> <span data-ttu-id="28661-196">Em seguida, pode passar esta toohello SAS [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) construtor.</span><span class="sxs-lookup"><span data-stu-id="28661-196">You can then pass this SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="28661-197">Se estiver a desenvolver um idioma diferente do c#, será necessário padrão do tooimplement Olá convenções de ficheiro.</span><span class="sxs-lookup"><span data-stu-id="28661-197">If you are developing in a language other than C#, you will need tooimplement hello File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="28661-198">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="28661-198">Code sample</span></span>

<span data-ttu-id="28661-199">Olá [PersistOutputs] [ github_persistoutputs] projeto de exemplo é uma das Olá [exemplos de código do Azure Batch] [ github_samples] no GitHub.</span><span class="sxs-lookup"><span data-stu-id="28661-199">hello [PersistOutputs][github_persistoutputs] sample project is one of hello [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="28661-200">Esta solução do Visual Studio demonstra como a biblioteca de clientes do toouse Olá Batch para tarefas de toopersist .NET saída toodurable armazenamento.</span><span class="sxs-lookup"><span data-stu-id="28661-200">This Visual Studio solution demonstrates how toouse hello Batch client library for .NET toopersist task output toodurable storage.</span></span> <span data-ttu-id="28661-201">Olá toorun de exemplo, siga estes passos:</span><span class="sxs-lookup"><span data-stu-id="28661-201">toorun hello sample, follow these steps:</span></span>

1. <span data-ttu-id="28661-202">Projeto de Olá aberta no **Visual Studio versão 2015 ou mais recente**.</span><span class="sxs-lookup"><span data-stu-id="28661-202">Open hello project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="28661-203">Adicionar o Batch e armazenamento **credenciais de contas** demasiado**AccountSettings.settings** no projeto do Olá Microsoft.</span><span class="sxs-lookup"><span data-stu-id="28661-203">Add your Batch and Storage **account credentials** too**AccountSettings.settings** in hello Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="28661-204">**Criar** (mas não executam) Olá solução.</span><span class="sxs-lookup"><span data-stu-id="28661-204">**Build** (but do not run) hello solution.</span></span> <span data-ttu-id="28661-205">Restaure quaisquer pacotes NuGet, se lhe for pedido.</span><span class="sxs-lookup"><span data-stu-id="28661-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="28661-206">Olá utilize tooupload portal do Azure um [pacote de aplicação](batch-application-packages.md) para **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="28661-206">Use hello Azure portal tooupload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="28661-207">Incluir Olá `PersistOutputsTask.exe` e respetivas assemblagens dependentes no pacote. zip de Olá, ID da aplicação Olá conjunto demasiado "PersistOutputsTask" e aplicação Olá versão de pacote demasiado "1.0".</span><span class="sxs-lookup"><span data-stu-id="28661-207">Include hello `PersistOutputsTask.exe` and its dependent assemblies in hello .zip package, set hello application ID too"PersistOutputsTask", and hello application package version too"1.0".</span></span>
5. <span data-ttu-id="28661-208">**Iniciar** Olá (executar) **PersistOutputs** projeto.</span><span class="sxs-lookup"><span data-stu-id="28661-208">**Start** (run) hello **PersistOutputs** project.</span></span>
6. <span data-ttu-id="28661-209">Quando o pedido toochoose Olá persistência tecnologia toouse para em execução exemplo de Olá, introduza **2** exemplo de Olá toorun utilizando o resultado da tarefa toopersist Olá API do serviço Batch.</span><span class="sxs-lookup"><span data-stu-id="28661-209">When prompted toochoose hello persistence technology toouse for running hello sample, enter **2** toorun hello sample using hello Batch service API toopersist task output.</span></span>
7. <span data-ttu-id="28661-210">Se assim o desejar, execute o exemplo de Olá novamente, introduzir **3** toopersist resultado com a API do serviço de Batch de Olá bem como tooname Olá contentor e BLOBs de caminho de destino toohello convenções de ficheiro padrão de acordo com.</span><span class="sxs-lookup"><span data-stu-id="28661-210">If desired, run hello sample again, entering **3** toopersist output with hello Batch service API, and also tooname hello destination container and blob path according toohello File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="28661-211">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="28661-211">Next steps</span></span>

- <span data-ttu-id="28661-212">Para obter mais informações sobre o resultado da tarefa persistentes com biblioteca de convenções de ficheiro Olá para .NET, consulte [manter tarefas e tooAzure de dados armazenamento com biblioteca de convenções de ficheiro Batch Olá para .NET toopersist ](batch-task-output-file-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="28661-212">For more information on persisting task output with hello File Conventions library for .NET, see [Persist job and task data tooAzure Storage with hello Batch File Conventions library for .NET toopersist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="28661-213">Para obter informações sobre outras abordagens para dados de saída persistentes no Azure Batch, consulte [manter tarefas e saída tooAzure armazenamento](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="28661-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples
