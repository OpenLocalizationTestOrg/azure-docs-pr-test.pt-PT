---
title: "A ativação pós-falha TSQL:initiate SQL Database do Azure | Microsoft Docs"
description: "Inicie uma ativação pós-falha planeada ou não planeada para a base de dados do SQL do Azure com o Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="4c077-103">Inicie uma ativação pós-falha planeada ou não planeada para a base de dados do Azure SQL com o Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="4c077-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="4c077-104">Este artigo mostra como tooinitiate tooa de ativação pós-falha secundário base de dados SQL com o Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="4c077-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="4c077-105">tooconfigure georreplicação, consulte [configurar georreplicação da base de dados do Azure SQL](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="4c077-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="4c077-106">tooinitiate de ativação pós-falha, é necessário o seguinte Olá:</span><span class="sxs-lookup"><span data-stu-id="4c077-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="4c077-107">Um início de sessão que se encontra DBManager Olá primário</span><span class="sxs-lookup"><span data-stu-id="4c077-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="4c077-108">Ter db_ownership de Olá local da base de dados que irá replicar georreplicação</span><span class="sxs-lookup"><span data-stu-id="4c077-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="4c077-109">Ser DBManager no toowhich de servidor (es) de parceiro de Olá irá configurar georreplicação</span><span class="sxs-lookup"><span data-stu-id="4c077-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="4c077-110">Versão mais recente do SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="4c077-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4c077-111">É recomendado que utilize sempre Olá versão mais recente do Management Studio tooremain sincronizada com atualizações tooMicrosoft Azure e a base de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="4c077-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="4c077-112">[Atualize o SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="4c077-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="4c077-113">Inicie uma ativação pós-falha planeada promover um base de dados secundária toobecome Olá nova principal</span><span class="sxs-lookup"><span data-stu-id="4c077-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="4c077-114">Pode utilizar Olá **ALTER DATABASE** instrução toopromote um base de dados secundária toobecome Olá nova principal da base de dados de forma planeada, despromover toobecome de principal existente Olá uma secundária.</span><span class="sxs-lookup"><span data-stu-id="4c077-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="4c077-115">Esta declaração de é executada na base de dados mestra Olá no servidor de lógica de Olá SQL Database do Azure na qual Olá georreplicação base de dados secundária que está a ser promovido reside.</span><span class="sxs-lookup"><span data-stu-id="4c077-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="4c077-116">Esta funcionalidade foi concebida para ativação pós-falha planeada, tal como durante simulações de Olá DR e requer que essa base de dados primária Olá estar disponível.</span><span class="sxs-lookup"><span data-stu-id="4c077-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="4c077-117">comando Olá efetua Olá seguinte fluxo de trabalho:</span><span class="sxs-lookup"><span data-stu-id="4c077-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="4c077-118">Temporariamente o modo de toosynchronous de replicação de comutadores, fazendo com que todas as transações pendentes toobe descarregados toohello secundário e bloquear todas as transações do novo;</span><span class="sxs-lookup"><span data-stu-id="4c077-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="4c077-119">Comutadores Olá funções de Olá duas bases de dados na parceria de georreplicação Olá.</span><span class="sxs-lookup"><span data-stu-id="4c077-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="4c077-120">Esta sequência garante que Olá duas bases de dados estão sincronizados antes de mudar de funções de Olá e, por conseguinte, não irá ocorrer nenhuma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="4c077-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="4c077-121">Não há um curto período de tempo durante os quais não ambas as bases de dados estão disponíveis (na ordem de Olá de 0 too25 segundos) enquanto funções Olá são mudadas.</span><span class="sxs-lookup"><span data-stu-id="4c077-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="4c077-122">Se a base de dados primária Olá tem várias bases de dados secundárias, o comando de Olá será automaticamente reconfigure Olá outra bases de dados secundárias tooconnect toohello nova principal.</span><span class="sxs-lookup"><span data-stu-id="4c077-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="4c077-123">operação todo Olá deve demorar menos de um minuto toocomplete em circunstâncias normais.</span><span class="sxs-lookup"><span data-stu-id="4c077-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="4c077-124">Para obter mais informações, consulte [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) e [escalões de serviço](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="4c077-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="4c077-125">Utilize Olá os seguintes passos tooinitiate uma ativação pós-falha planeada.</span><span class="sxs-lookup"><span data-stu-id="4c077-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="4c077-126">No Management Studio, ligue o servidor de lógica de SQL Database do Azure de toohello em que reside um georreplicação base de dados secundária.</span><span class="sxs-lookup"><span data-stu-id="4c077-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="4c077-127">Abra a pasta de bases de dados de Olá, expanda Olá **bases de dados do sistema** pasta, o botão direito no **mestre**e, em seguida, clique em **nova consulta**.</span><span class="sxs-lookup"><span data-stu-id="4c077-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="4c077-128">Utilize o seguinte Olá **ALTER DATABASE** instrução tooswitch Olá base de dados secundária toohello função primária.</span><span class="sxs-lookup"><span data-stu-id="4c077-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="4c077-129">Clique em **executar** consulta de Olá toorun.</span><span class="sxs-lookup"><span data-stu-id="4c077-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="4c077-130">Em casos raros, é possível que a operação de Olá não é possível concluir e pode aparecer bloqueada.</span><span class="sxs-lookup"><span data-stu-id="4c077-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="4c077-131">Neste caso, o utilizador Olá pode executar o comando de ativação pós-falha de imposição de Olá e aceitar a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="4c077-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="4c077-132">Inicie uma ativação pós-falha não planeada do Olá base de dados primária toohello base de dados secundária</span><span class="sxs-lookup"><span data-stu-id="4c077-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="4c077-133">Pode utilizar Olá **ALTER DATABASE** instrução toopromote um base de dados secundária toobecome Olá nova principal da base de dados de forma não planeada, forçar a despromoção Olá do toobecome de principal existente Olá uma secundária num momento quando Olá base de dados primária já não está disponível.</span><span class="sxs-lookup"><span data-stu-id="4c077-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="4c077-134">Esta declaração de é executada na base de dados mestra Olá no servidor de lógica de Olá SQL Database do Azure na qual Olá georreplicação base de dados secundária que está a ser promovido reside.</span><span class="sxs-lookup"><span data-stu-id="4c077-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="4c077-135">Esta funcionalidade foi concebida para recuperação após desastre quando restaurar disponibilidade da base de dados de Olá é crítico e alguma perda de dados é aceitável.</span><span class="sxs-lookup"><span data-stu-id="4c077-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="4c077-136">Quando a ativação pós-falha forçada é invocada, Olá especificado base de dados secundária torna-se a base de dados primária Olá imediatamente e começa a aceitação de transações de escrita.</span><span class="sxs-lookup"><span data-stu-id="4c077-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="4c077-137">Assim que Olá original base de dados primária é capaz de tooreconnect com esta nova base de dados primária, cópia de segurança incremental é criada no Olá original base de dados primária e Olá antigo base de dados primária é efetuada numa base de dados secundária para Olá nova base de dados primária; posteriormente, é simplesmente uma réplica de sincronização de principal novo Olá.</span><span class="sxs-lookup"><span data-stu-id="4c077-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="4c077-138">No entanto, porque o ponto no tempo restaurar não é suportada em bases de dados secundária de Olá, se o utilizador de Olá pretende dados toorecover consolidados toohello antigo principal base de dados que não tinha sido replicados toohello nova principal da base de dados antes de ocorrer a ativação pós-falha de Olá forçado, Olá utilizador terá de tooengage suporte toorecover este caso de perda de dados.</span><span class="sxs-lookup"><span data-stu-id="4c077-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="4c077-139">Se a base de dados primária Olá tem várias bases de dados secundárias, o comando de Olá será automaticamente reconfigure Olá outra bases de dados secundárias tooconnect toohello nova principal.</span><span class="sxs-lookup"><span data-stu-id="4c077-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="4c077-140">Utilize Olá os seguintes passos tooinitiate uma ativação pós-falha não planeada.</span><span class="sxs-lookup"><span data-stu-id="4c077-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="4c077-141">No Management Studio, ligue o servidor de lógica de SQL Database do Azure de toohello em que reside um georreplicação base de dados secundária.</span><span class="sxs-lookup"><span data-stu-id="4c077-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="4c077-142">Abra a pasta de bases de dados de Olá, expanda Olá **bases de dados do sistema** pasta, o botão direito no **mestre**e, em seguida, clique em **nova consulta**.</span><span class="sxs-lookup"><span data-stu-id="4c077-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="4c077-143">Utilize o seguinte Olá **ALTER DATABASE** instrução tooswitch Olá base de dados secundária toohello função primária.</span><span class="sxs-lookup"><span data-stu-id="4c077-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="4c077-144">Clique em **executar** consulta de Olá toorun.</span><span class="sxs-lookup"><span data-stu-id="4c077-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="4c077-145">Se o comando de Olá é emitido quando principais e secundários estiverem online primário antigo Olá deixará de estar Olá novo secundário imediatamente sem sincronização de dados.</span><span class="sxs-lookup"><span data-stu-id="4c077-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="4c077-146">Se tiver Olá primário podem ocorrer ao consolidar transações quando o comando de Olá é emitido alguma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="4c077-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="4c077-147">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="4c077-147">Next steps</span></span>
* <span data-ttu-id="4c077-148">Após a ativação pós-falha, certifique-se requisitos de autenticação de Olá para o servidor e base de dados estão configurados no principal Olá de novo.</span><span class="sxs-lookup"><span data-stu-id="4c077-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="4c077-149">Para obter mais informações, consulte [segurança da base de dados do SQL Server após a recuperação de desastre](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="4c077-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="4c077-150">toolearn recuperação após desastres utilizando a replicação geográfica activa, incluindo os passos de recuperação de pré-lançamento e pós-recuperação e realizar um exercício de recuperação após desastre, consulte [recuperação após desastre](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="4c077-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="4c077-151">Para uma mensagem de blogue Sasha Nosov sobre replicação geográfica activa, consulte [Spotlight em novas capacidades de replicação geográfica](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="4c077-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="4c077-152">Para obter informações sobre como criar nuvem aplicações toouse replicação geográfica activa, consulte [aplicações em nuvem de conceção para utilizar a georreplicação de continuidade do negócio](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="4c077-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="4c077-153">Para obter informações sobre como utilizar a georreplicação ativa com conjuntos elásticos, consulte [estratégias de recuperação de desastre do conjunto elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="4c077-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="4c077-154">Para obter uma descrição geral da continuidade do negócio, consulte [descrição geral da continuidade de negócio](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="4c077-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

