---
title: "aaaDefragmentation das métricas no Service Fabric do Azure | Microsoft Docs"
description: "Uma descrição geral da utilização desfragmentação ou packing como uma estratégia de métricas no Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: d09045a6cf196d2771f1a0794637f4579d3eb96b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a><span data-ttu-id="b08f1-103">Desfragmentação de métricas e a carga no Service Fabric</span><span class="sxs-lookup"><span data-stu-id="b08f1-103">Defragmentation of metrics and load in Service Fabric</span></span>
<span data-ttu-id="b08f1-104">estratégia de predefinição de Olá recursos de infraestrutura Cluster recursos do Service Manager para gerir as métricas de carga num cluster de Olá é toodistribute Olá em carga.</span><span class="sxs-lookup"><span data-stu-id="b08f1-104">hello Service Fabric Cluster Resource Manager's default strategy for managing load metrics in hello cluster is toodistribute hello load.</span></span> <span data-ttu-id="b08f1-105">Garantir que os nós estão uniformemente utilizados evita oportunidades de acesso frequente e amovíveis que levar a contenção de tooboth e wasted recursos.</span><span class="sxs-lookup"><span data-stu-id="b08f1-105">Ensuring that nodes are evenly utilized avoids hot and cold spots that lead tooboth contention and wasted resources.</span></span> <span data-ttu-id="b08f1-106">Distribuição de cargas de trabalho no cluster de Olá também é Olá esta em termos de reiniciadas falhas, uma vez que garante que uma falha não remova uma grande percentagem de uma carga de trabalho especificada.</span><span class="sxs-lookup"><span data-stu-id="b08f1-106">Distributing workloads in hello cluster is also hello safest in terms of surviving failures since it ensures that a failure doesn’t take out a large percentage of a given workload.</span></span> 

<span data-ttu-id="b08f1-107">Olá Gestor de recursos de Cluster do serviço de recursos de infraestrutura suporta uma estratégia de diferentes para gerir a carga, o que é a desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="b08f1-107">hello Service Fabric Cluster Resource Manager does support a different strategy for managing load, which is defragmentation.</span></span> <span data-ttu-id="b08f1-108">Desfragmentação significa que, em vez de tentar a utilização de Olá toodistribute de uma métrica de cluster Olá, este é consolidado.</span><span class="sxs-lookup"><span data-stu-id="b08f1-108">Defragmentation means that instead of trying toodistribute hello utilization of a metric across hello cluster, it is consolidated.</span></span> <span data-ttu-id="b08f1-109">Consolidação é apenas um inversion da predefinição de Olá balanceamento estratégia – em vez de minimizar Olá desvio-padrão médio de métrica de carga, Olá Gestor de recursos de Cluster tenta tooincrease-lo.</span><span class="sxs-lookup"><span data-stu-id="b08f1-109">Consolidation is just an inversion of hello default balancing strategy – instead of minimizing hello average standard deviation of metric load, hello Cluster Resource Manager tries tooincrease it.</span></span>

## <a name="when-toouse-defragmentation"></a><span data-ttu-id="b08f1-110">Quando a desfragmentação de toouse</span><span class="sxs-lookup"><span data-stu-id="b08f1-110">When toouse defragmentation</span></span>
<span data-ttu-id="b08f1-111">Distribuição de carga num cluster de Olá consome alguns dos recursos de Olá em cada nó.</span><span class="sxs-lookup"><span data-stu-id="b08f1-111">Distributing load in hello cluster consumes some of hello resources on each node.</span></span> <span data-ttu-id="b08f1-112">Algumas cargas de trabalho criar serviços que são exceptionally grandes e consumam a maior parte ou a totalidade de um nó.</span><span class="sxs-lookup"><span data-stu-id="b08f1-112">Some workloads create services that are exceptionally large and consume most or all of a node.</span></span> <span data-ttu-id="b08f1-113">Nestes casos, é possível que quando existem grandes cargas de trabalho ser criadas não é suficiente espaço em qualquer nó toorun-los.</span><span class="sxs-lookup"><span data-stu-id="b08f1-113">In these cases, it's possible that when there are large workloads getting created that there isn't enough space on any node toorun them.</span></span> <span data-ttu-id="b08f1-114">Um problema no Service Fabric; não são de grandes cargas de trabalho no Olá casos Gestor de recursos do Cluster determina que necessita de espaço de toomake do tooreorganize Olá cluster para este grande carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b08f1-114">Large workloads aren't a problem in Service Fabric; in these cases hello Cluster Resource Manager determines that it needs tooreorganize hello cluster toomake room for this large workload.</span></span> <span data-ttu-id="b08f1-115">No entanto, Olá entretanto que carga de trabalho tem toobe toowait agendada no cluster de Olá.</span><span class="sxs-lookup"><span data-stu-id="b08f1-115">However, in hello meantime that workload has toowait toobe scheduled in hello cluster.</span></span>

<span data-ttu-id="b08f1-116">Se existirem vários serviços e estado toomove em torno, em seguida, pode demorar muito tempo para Olá grande carga de trabalho toobe colocado em cluster Olá.</span><span class="sxs-lookup"><span data-stu-id="b08f1-116">If there are many services and state toomove around, then it could take a long time for hello large workload toobe placed in hello cluster.</span></span> <span data-ttu-id="b08f1-117">Isto é mais provável se outras cargas de trabalho no cluster de Olá também são grandes e, por isso, demorar mais longo tooreorganize.</span><span class="sxs-lookup"><span data-stu-id="b08f1-117">This is more likely if other workloads in hello cluster are also large and so take longer tooreorganize.</span></span> <span data-ttu-id="b08f1-118">equipa de Service Fabric Olá medida tempos de criação no simulações deste cenário.</span><span class="sxs-lookup"><span data-stu-id="b08f1-118">hello Service Fabric team measured creation times in simulations of this scenario.</span></span> <span data-ttu-id="b08f1-119">Detetámos que demorou muito mais criar serviços grande assim que a utilização do cluster obteve acima entre 30% e 50%.</span><span class="sxs-lookup"><span data-stu-id="b08f1-119">We found that creating large services took much longer as soon as cluster utilization got above between 30% and 50%.</span></span> <span data-ttu-id="b08f1-120">toohandle neste cenário, introduzimos desfragmentação como uma estratégia de balanceamento.</span><span class="sxs-lookup"><span data-stu-id="b08f1-120">toohandle this scenario, we introduced defragmentation as a balancing strategy.</span></span> <span data-ttu-id="b08f1-121">Detetámos que para grandes cargas de trabalho, especialmente aqueles em que a hora de criação foi importante, desfragmentação realmente ajudou a estas novas cargas de trabalho obterem agendadas no cluster de Olá.</span><span class="sxs-lookup"><span data-stu-id="b08f1-121">We found that for large workloads, especially ones where creation time was important, defragmentation really helped those new workloads get scheduled in hello cluster.</span></span>

<span data-ttu-id="b08f1-122">Pode configurar a desfragmentação métricas toohave Olá carga do Gestor de recursos do Cluster tooproactively tente toocondense Olá dos serviços de Olá em menos de nós.</span><span class="sxs-lookup"><span data-stu-id="b08f1-122">You can configure defragmentation metrics toohave hello Cluster Resource Manager tooproactively try toocondense hello load of hello services into fewer nodes.</span></span> <span data-ttu-id="b08f1-123">Isto ajuda a garantir que existe quase sempre espaço para grandes serviços sem reorganizar cluster Olá.</span><span class="sxs-lookup"><span data-stu-id="b08f1-123">This helps ensure that there is almost always room for large services without reorganizing hello cluster.</span></span> <span data-ttu-id="b08f1-124">Não ter clusters de Olá tooreorganize permite criar rapidamente grandes cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b08f1-124">Not having tooreorganize hello cluster allows creating large workloads quickly.</span></span>

<span data-ttu-id="b08f1-125">A maioria das pessoas não precisam de desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="b08f1-125">Most people don’t need defragmentation.</span></span> <span data-ttu-id="b08f1-126">Os serviços são normalmente ser pequeno, pelo que não é do espaço de disco rígido toofind para-los num cluster de Olá.</span><span class="sxs-lookup"><span data-stu-id="b08f1-126">Services are usually be small, so it’s not hard toofind room for them in hello cluster.</span></span> <span data-ttu-id="b08f1-127">Quando a reorganização for possível, passa rapidamente, novamente porque a maioria dos serviços são pequenas e pode ser movida rapidamente e em paralelo.</span><span class="sxs-lookup"><span data-stu-id="b08f1-127">When reorganization is possible, it goes quickly, again because most services are small and can be moved quickly and in parallel.</span></span> <span data-ttu-id="b08f1-128">No entanto, se tem os serviços de grande e precisar deles criado rapidamente Olá estratégia de desfragmentação é que o utilizador.</span><span class="sxs-lookup"><span data-stu-id="b08f1-128">However, if you have large services and need them created quickly then hello defragmentation strategy is for you.</span></span> <span data-ttu-id="b08f1-129">Vamos abordar fala Olá da utilização de desfragmentação seguinte.</span><span class="sxs-lookup"><span data-stu-id="b08f1-129">We'll discuss hello tradeoffs of using defragmentation next.</span></span> 

## <a name="defragmentation-tradeoffs"></a><span data-ttu-id="b08f1-130">Desfragmentação fala</span><span class="sxs-lookup"><span data-stu-id="b08f1-130">Defragmentation tradeoffs</span></span>
<span data-ttu-id="b08f1-131">Desfragmentação pode aumentar impactfulness de falhas, uma vez que mais serviços estão em execução em nós que não obedeçam a.</span><span class="sxs-lookup"><span data-stu-id="b08f1-131">Defragmentation can increase impactfulness of failures, since more services are running on nodes that fail.</span></span> <span data-ttu-id="b08f1-132">Desfragmentação também pode aumentar os custos, uma vez que os recursos num cluster de Olá tem de ser contidos num reserva, a aguardar a criação de Olá de grandes cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b08f1-132">Defragmentation can also increase costs, since resources in hello cluster must be held in reserve, waiting for hello creation of large workloads.</span></span>

<span data-ttu-id="b08f1-133">Olá diagrama a seguir fornece uma representação visual de dois clusters, um que é defragmented e outro que não se encontra.</span><span class="sxs-lookup"><span data-stu-id="b08f1-133">hello following diagram gives a visual representation of two clusters, one that is defragmented and one that is not.</span></span> 

<span data-ttu-id="b08f1-134"><center>
![Comparar balanceamento e Defragmented Clusters][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="b08f1-134"><center>
![Comparing Balanced and Defragmented Clusters][Image1]
</center></span></span>

<span data-ttu-id="b08f1-135">No caso de Olá balanceado, considere o número de Olá de movimentos que seriam necessário tooplace um Olá maiores de objectos de serviço.</span><span class="sxs-lookup"><span data-stu-id="b08f1-135">In hello balanced case, consider hello number of movements that would be necessary tooplace one of hello largest service objects.</span></span> <span data-ttu-id="b08f1-136">Num cluster de defragmented Olá, carga de trabalho grande Olá foi possível colocar em nós quatro ou cinco sem ter toowait para quaisquer outro toomove de serviços.</span><span class="sxs-lookup"><span data-stu-id="b08f1-136">In hello defragmented cluster, hello large workload could be placed on nodes four or five without having toowait for any other services toomove.</span></span>

## <a name="defragmentation-pros-and-cons"></a><span data-ttu-id="b08f1-137">Os profissionais de desfragmentação e contras</span><span class="sxs-lookup"><span data-stu-id="b08f1-137">Defragmentation pros and cons</span></span>
<span data-ttu-id="b08f1-138">Por isso, quais são esses outras fala conceptual?</span><span class="sxs-lookup"><span data-stu-id="b08f1-138">So what are those other conceptual tradeoffs?</span></span> <span data-ttu-id="b08f1-139">Segue-se uma tabela rápida de coisas toothink sobre:</span><span class="sxs-lookup"><span data-stu-id="b08f1-139">Here’s a quick table of things toothink about:</span></span>

| <span data-ttu-id="b08f1-140">Profissionais de desfragmentação</span><span class="sxs-lookup"><span data-stu-id="b08f1-140">Defragmentation Pros</span></span> | <span data-ttu-id="b08f1-141">Contras de desfragmentação</span><span class="sxs-lookup"><span data-stu-id="b08f1-141">Defragmentation Cons</span></span> |
| --- | --- |
| <span data-ttu-id="b08f1-142">Permite a criação rápida dos serviços de grande</span><span class="sxs-lookup"><span data-stu-id="b08f1-142">Allows faster creation of large services</span></span> |<span data-ttu-id="b08f1-143">Carregar concentrates em menos nós, aumentando a contenção</span><span class="sxs-lookup"><span data-stu-id="b08f1-143">Concentrates load onto fewer nodes, increasing contention</span></span> |
| <span data-ttu-id="b08f1-144">Permite reduzir o movimento de dados durante a criação</span><span class="sxs-lookup"><span data-stu-id="b08f1-144">Enables lower data movement during creation</span></span> |<span data-ttu-id="b08f1-145">Falhas podem afetar mais serviços e fazer com que mais de volume de alterações</span><span class="sxs-lookup"><span data-stu-id="b08f1-145">Failures can impact more services and cause more churn</span></span> |
| <span data-ttu-id="b08f1-146">Permite avançada descrição dos requisitos e recuperação de espaço</span><span class="sxs-lookup"><span data-stu-id="b08f1-146">Allows rich description of requirements and reclamation of space</span></span> |<span data-ttu-id="b08f1-147">Configuração de gestão de recursos mais complexa global</span><span class="sxs-lookup"><span data-stu-id="b08f1-147">More complex overall Resource Management configuration</span></span> |

<span data-ttu-id="b08f1-148">Pode misturar defragmented e Olá de métricas normais no mesmo cluster.</span><span class="sxs-lookup"><span data-stu-id="b08f1-148">You can mix defragmented and normal metrics in hello same cluster.</span></span> <span data-ttu-id="b08f1-149">Olá Gestor de recursos de Cluster tenta tooconsolidate Olá desfragmentação métricas quanto possível durante propagando-se Olá outras pessoas.</span><span class="sxs-lookup"><span data-stu-id="b08f1-149">hello Cluster Resource Manager tries tooconsolidate hello defragmentation metrics as much as possible while spreading out hello others.</span></span> <span data-ttu-id="b08f1-150">resultados de Olá de balanceamento de estratégias e a combinação de desfragmentação depende de vários fatores, incluindo:</span><span class="sxs-lookup"><span data-stu-id="b08f1-150">hello results of mixing defragmentation and balancing strategies depends on several factors, including:</span></span>
  - <span data-ttu-id="b08f1-151">número de Olá de balanceamento de métricas vs número Olá das métricas de desfragmentação</span><span class="sxs-lookup"><span data-stu-id="b08f1-151">hello number of balancing metrics vs. hello number of defragmentation metrics</span></span>
  - <span data-ttu-id="b08f1-152">Se o serviço utiliza ambos os tipos de métricas</span><span class="sxs-lookup"><span data-stu-id="b08f1-152">Whether any service uses both types of metrics</span></span> 
  - <span data-ttu-id="b08f1-153">ponderações métrica Olá</span><span class="sxs-lookup"><span data-stu-id="b08f1-153">hello metric weights</span></span>
  - <span data-ttu-id="b08f1-154">carrega métrica atual</span><span class="sxs-lookup"><span data-stu-id="b08f1-154">current metric loads</span></span>
  
<span data-ttu-id="b08f1-155">Experimentação é necessário toodetermine Olá configuração exata necessária.</span><span class="sxs-lookup"><span data-stu-id="b08f1-155">Experimentation is required toodetermine hello exact configuration necessary.</span></span> <span data-ttu-id="b08f1-156">Recomendamos a medida de detalhado das cargas de trabalho antes de ativar as métricas de desfragmentação na produção.</span><span class="sxs-lookup"><span data-stu-id="b08f1-156">We recommend thorough measurement of your workloads before you enable defragmentation metrics in production.</span></span> <span data-ttu-id="b08f1-157">Isto é especialmente verdadeiro quando a combinação de desfragmentação e métricas equilibradas dentro Olá mesmo serviço.</span><span class="sxs-lookup"><span data-stu-id="b08f1-157">This is especially true when mixing defragmentation and balanced metrics within hello same service.</span></span> 

## <a name="configuring-defragmentation-metrics"></a><span data-ttu-id="b08f1-158">Configuração de desfragmentação de métricas</span><span class="sxs-lookup"><span data-stu-id="b08f1-158">Configuring defragmentation metrics</span></span>
<span data-ttu-id="b08f1-159">Configurar as métricas de desfragmentação é uma decisão global num cluster de Olá e métricas individuais podem ser selecionadas para desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="b08f1-159">Configuring defragmentation metrics is a global decision in hello cluster, and individual metrics can be selected for defragmentation.</span></span> <span data-ttu-id="b08f1-160">Olá fragmentos de configuração a seguir mostra como tooconfigure métricas de desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="b08f1-160">hello following config snippets show how tooconfigure metrics for defragmentation.</span></span> <span data-ttu-id="b08f1-161">Neste caso, "Metric1" está configurado como uma métrica de desfragmentação, enquanto "Metric2" continuará toobe balanceamento normalmente.</span><span class="sxs-lookup"><span data-stu-id="b08f1-161">In this case, "Metric1" is configured as a defragmentation metric, while "Metric2" will continue toobe balanced normally.</span></span> 

<span data-ttu-id="b08f1-162">ClusterManifest.xml:</span><span class="sxs-lookup"><span data-stu-id="b08f1-162">ClusterManifest.xml:</span></span>

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Metric1" Value="true" />
    <Parameter Name="Metric2" Value="false" />
</Section>
```

<span data-ttu-id="b08f1-163">através de Clusterconfig para implementações autónomas ou Template do Azure alojada clusters:</span><span class="sxs-lookup"><span data-stu-id="b08f1-163">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "DefragmentationMetrics",
    "parameters": [
      {
          "name": "Metric1",
          "value": "true"
      },
      {
          "name": "Metric2",
          "value": "false"
      }
    ]
  }
]
```


## <a name="next-steps"></a><span data-ttu-id="b08f1-164">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="b08f1-164">Next steps</span></span>
- <span data-ttu-id="b08f1-165">Olá Gestor de recursos do Cluster tem opções de man para descrever o cluster de Olá.</span><span class="sxs-lookup"><span data-stu-id="b08f1-165">hello Cluster Resource Manager has man options for describing hello cluster.</span></span> <span data-ttu-id="b08f1-166">toofind mais informações sobre os mesmos, consulte este artigo no [que descrevem um cluster do Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="b08f1-166">toofind out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
- <span data-ttu-id="b08f1-167">As métricas são como Olá Manager de recursos de Cluster de recursos de infraestrutura de serviço gere consumo e capacidade Olá cluster.</span><span class="sxs-lookup"><span data-stu-id="b08f1-167">Metrics are how hello Service Fabric Cluster Resource Manger manages consumption and capacity in hello cluster.</span></span> <span data-ttu-id="b08f1-168">mais informações sobre as métricas de toolearn e como tooconfigure-las, consulte [neste artigo](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="b08f1-168">toolearn more about metrics and how tooconfigure them, check out [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png
