---
title: "relatórios de estado de funcionamento de Service Fabric aaaAdd personalizados | Microsoft Docs"
description: "Descreve como entidades de estado de funcionamento do Service Fabric tooAzure os relatórios de estado personalizado toosend. Fornece recomendações para estruturar e implementar os relatórios de estado de funcionamento de qualidade."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="7ca22-104">Adicionar relatórios personalizados de estado de funcionamento do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="7ca22-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="7ca22-105">Azure Service Fabric apresenta um [modelo de estado de funcionamento](service-fabric-health-introduction.md) concebido cluster mau estado de funcionamento tooflag e condições de aplicação no entidades específicas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="7ca22-106">utiliza o modelo de estado de funcionamento de Olá **Informadores de estado de funcionamento** (componentes de sistema e watchdogs).</span><span class="sxs-lookup"><span data-stu-id="7ca22-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="7ca22-107">o objetivo de Olá é rápido e fácil de diagnóstico e de reparação.</span><span class="sxs-lookup"><span data-stu-id="7ca22-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="7ca22-108">Os escritores de serviço tem de antemão toothink sobre estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="7ca22-109">Deve ser comunicada qualquer condição que pode afetar o estado de funcionamento, especialmente se pode ajudar a problemas de sinalizador fechar toohello raiz.</span><span class="sxs-lookup"><span data-stu-id="7ca22-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="7ca22-110">informações de estado de funcionamento de Olá podem poupar tempo e esforço na depuração e investigação.</span><span class="sxs-lookup"><span data-stu-id="7ca22-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="7ca22-111">Olá utilidade é especialmente clara assim que o serviço de Olá está a funcionar à escala na nuvem de Olá (privada ou do Azure).</span><span class="sxs-lookup"><span data-stu-id="7ca22-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="7ca22-112">monitor de Informadores de Service Fabric Olá identificados condições de interesse.</span><span class="sxs-lookup"><span data-stu-id="7ca22-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="7ca22-113">Estes relatórios sobre as condições com base na respetiva vista local.</span><span class="sxs-lookup"><span data-stu-id="7ca22-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="7ca22-114">Olá [arquivo de estado de funcionamento](service-fabric-health-introduction.md#health-store) agrega dados de estado de funcionamento enviados por todos os Informadores toodetermine se entidades estão em bom estado de funcionamento global.</span><span class="sxs-lookup"><span data-stu-id="7ca22-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="7ca22-115">modelo de Olá é toouse avançado, flexíveis e fáceis de toobe pretendido.</span><span class="sxs-lookup"><span data-stu-id="7ca22-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="7ca22-116">qualidade de Olá dos relatórios de estado de funcionamento de Olá determina precisão Olá da vista de estado de funcionamento de Olá do cluster de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="7ca22-117">Falsos positivos que mostram erradamente problemas mau estado de funcionamento podem afetar negativamente as atualizações ou outros serviços que utilizam dados de estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="7ca22-118">Exemplos desses serviços são serviços de reparação e mecanismos de alertas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="7ca22-119">Por conseguinte, algumas profundamente é tooprovide necessários relatórios que capturam as condições de interesse no Olá melhor forma possível.</span><span class="sxs-lookup"><span data-stu-id="7ca22-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="7ca22-120">tem de toodesign e implementar estado de funcionamento de relatórios, watchdogs e sistema componentes:</span><span class="sxs-lookup"><span data-stu-id="7ca22-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="7ca22-121">Definir a condição de Olá que estão interessados, forma Olá que é monitorizado e Olá afetam a funcionalidade de cluster ou aplicação Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="7ca22-122">Com base nestas informações, opte por utilizar Olá relatório propriedade e o estado de funcionamento do Estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="7ca22-123">Determinar Olá [entidade](service-fabric-health-introduction.md#health-entities-and-hierarchy) que aplica-se ao relatório Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="7ca22-124">Determinar onde Olá relatórios é efetuada, a partir do Olá watchdog do serviço ou uma interno ou externo.</span><span class="sxs-lookup"><span data-stu-id="7ca22-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="7ca22-125">Defina um relatório de Olá tooidentify origem utilizada.</span><span class="sxs-lookup"><span data-stu-id="7ca22-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="7ca22-126">Escolha uma estratégia de criação de relatórios, periodicamente ou em transições.</span><span class="sxs-lookup"><span data-stu-id="7ca22-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="7ca22-127">Olá recomendado forma é periodicamente, necessita de código simples e menos propenso tooerrors.</span><span class="sxs-lookup"><span data-stu-id="7ca22-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="7ca22-128">Determine o relatório de Olá quanto para condições de mau estado de funcionamento devem permanecer no arquivo de estado de funcionamento de Olá e como deve ser desmarcada-lo.</span><span class="sxs-lookup"><span data-stu-id="7ca22-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="7ca22-129">Utilizando estas informações, decida Olá do tempo toolive e remover no expiração comportamento dos relatórios.</span><span class="sxs-lookup"><span data-stu-id="7ca22-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="7ca22-130">Conforme mencionado, Reporting Services podem ser efetuada a partir da:</span><span class="sxs-lookup"><span data-stu-id="7ca22-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="7ca22-131">Olá monitorizados réplica de serviço do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="7ca22-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="7ca22-132">Watchdogs internos implementados como um serviço do Service Fabric (por exemplo, um serviço sem monitorização de estado serviço Fabric que monitoriza condições e relatórios de problemas).</span><span class="sxs-lookup"><span data-stu-id="7ca22-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="7ca22-133">watchdogs Olá podem ser implementado um todos os nós ou podem ser serviço toohello com monitorizados.</span><span class="sxs-lookup"><span data-stu-id="7ca22-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="7ca22-134">Watchdogs internos serem executadas em nós de Service Fabric Olá, mas que estão *não* implementado como serviços do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="7ca22-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="7ca22-135">Externa watchdogs esse recurso Olá de sonda de *fora* cluster do Service Fabric Olá (por exemplo, serviço de monitorização, como Gomez).</span><span class="sxs-lookup"><span data-stu-id="7ca22-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="7ca22-136">Box Olá, cluster Olá é preenchido com os relatórios de estado de funcionamento enviados pelos componentes do sistema de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="7ca22-137">Leia mais em [utilizar o estado de funcionamento do sistema de relatórios para resolução de problemas](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="7ca22-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="7ca22-138">Olá relatórios de utilizador devem ser enviados [entidades de estado de funcionamento](service-fabric-health-introduction.md#health-entities-and-hierarchy) que já foram criadas pelo sistema Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="7ca22-139">Uma vez hello estrutura de relatórios de estado de funcionamento está desmarcada, os relatórios de estado de funcionamento podem ser enviados facilmente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="7ca22-140">Pode utilizar [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport de estado de funcionamento se o cluster Olá não está [segura](service-fabric-cluster-security.md) ou se o cliente de fabric Olá tem privilégios de administrador.</span><span class="sxs-lookup"><span data-stu-id="7ca22-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="7ca22-141">Relatórios podem ser feito Olá API por utilizando [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), através do PowerShell ou através de REST.</span><span class="sxs-lookup"><span data-stu-id="7ca22-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="7ca22-142">Botões de configuração do batch relatórios para um melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="7ca22-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="7ca22-143">Estado de funcionamento do relatório é síncrono e representa funciona para validação de Olá apenas do lado do cliente de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="7ca22-144">Olá facto Olá relatório é aceite pelo cliente do Estado de funcionamento de Olá ou Olá `Partition` ou `CodePackageActivationContext` objetos não significa que é aplicada no arquivo de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="7ca22-145">É enviada de forma assíncrona e, possivelmente, em lotes com outros relatórios.</span><span class="sxs-lookup"><span data-stu-id="7ca22-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="7ca22-146">Olá processamento no servidor de Olá ainda poderão falhar: número de sequência de Olá pode ser obsoleto, entidade Olá no qual Olá relatório tem de ser aplicado foi eliminado, etc.</span><span class="sxs-lookup"><span data-stu-id="7ca22-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="7ca22-147">Cliente do Estado de funcionamento</span><span class="sxs-lookup"><span data-stu-id="7ca22-147">Health client</span></span>
<span data-ttu-id="7ca22-148">relatórios de estado de funcionamento de Olá são enviados toohello o arquivo de estado de funcionamento através de um cliente do Estado de funcionamento, que se encontrem dentro de cliente de fabric Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="7ca22-149">cliente do Estado de funcionamento de Olá pode ser configurado com Olá seguintes definições:</span><span class="sxs-lookup"><span data-stu-id="7ca22-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="7ca22-150">**HealthReportSendInterval**: atraso Olá entre o relatório de Olá Olá hora está na altura de cliente e Olá do toohello adicionado é enviado toohello arquivo de estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="7ca22-151">Relatórios de toobatch utilizadas numa única mensagem, em vez de enviar uma mensagem para cada relatório.</span><span class="sxs-lookup"><span data-stu-id="7ca22-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="7ca22-152">a criação de batches de Olá melhora o desempenho.</span><span class="sxs-lookup"><span data-stu-id="7ca22-152">hello batching improves performance.</span></span> <span data-ttu-id="7ca22-153">Predefinição: 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="7ca22-154">**HealthReportRetrySendInterval**: intervalo de Olá no qual Olá cliente do Estado de funcionamento reenvia o estado de funcionamento acumulado relatórios toohello arquivo de estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="7ca22-155">Predefinição: 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="7ca22-156">**HealthOperationTimeout**: período de tempo limite de Olá de uma mensagem de relatório enviado toohello arquivo de estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="7ca22-157">Se uma mensagem exceder o tempo limite, o cliente do Estado de funcionamento de Olá tentará novamente-lo até o arquivo de estado de funcionamento de Olá confirma que o relatório de Olá foi processado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="7ca22-158">Predefinição: dois minutos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="7ca22-159">Quando Olá relatórios são em lotes, o cliente de fabric Olá deve ser mantido activa para, pelo menos, Olá tooensure HealthReportSendInterval que são enviadas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="7ca22-160">Se a mensagem de saudação for perdida ou arquivo de estado de funcionamento de Olá não é possível aplicar-lhes devido a erros de tootransient, o cliente de fabric Olá têm de ser mantido alive toogive mais do um tooretry hipótese.</span><span class="sxs-lookup"><span data-stu-id="7ca22-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="7ca22-161">colocação em memória intermédia Olá no cliente Olá demora exclusividade Olá Olá relatórios em consideração.</span><span class="sxs-lookup"><span data-stu-id="7ca22-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="7ca22-162">Por exemplo, se um relatório incorreto específico está a comunicar 100 relatórios por segundo no Olá mesma propriedade de Olá mesma entidade, Olá relatórios são substituídos com a última versão de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="7ca22-163">No máximo uma esses relatórios existe na fila de cliente Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="7ca22-164">Se a criação de batches é configurada, o número de Olá dos relatórios enviados toohello arquivo de estado de funcionamento é apenas uma por intervalo de envio.</span><span class="sxs-lookup"><span data-stu-id="7ca22-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="7ca22-165">Este relatório é Olá último adicionado relatório, que reflete o estado mais recente do Olá da entidade de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="7ca22-166">Especifique parâmetros de configuração quando `FabricClient` é criado através da transmissão [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) com Olá pretendido valores para as entradas relacionadas com o estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="7ca22-167">Olá exemplo seguinte cria um cliente de recursos de infraestrutura e especifica que os relatórios de Olá devem ser enviados quando são adicionados.</span><span class="sxs-lookup"><span data-stu-id="7ca22-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="7ca22-168">Em tempos limite e erros que podem ser repetidos, tentativas acontecer cada 40 segundos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="7ca22-169">Recomendamos que mantenha Olá predefinido dos recursos de infraestrutura de definições de cliente, definiram `HealthReportSendInterval` too30 segundos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="7ca22-170">Esta definição garante o desempenho ideal toobatching devida.</span><span class="sxs-lookup"><span data-stu-id="7ca22-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="7ca22-171">Para os relatórios críticos que devem ser enviados logo que possível, utilize `HealthReportSendOptions` com Immediate `true` no [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span><span class="sxs-lookup"><span data-stu-id="7ca22-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="7ca22-172">Relatórios de imediato ignorar Olá intervalo de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="7ca22-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="7ca22-173">Utilize este sinalizador com cuidado; Queremos tootake partido do cliente do Estado de funcionamento de Olá criação de batches sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="7ca22-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="7ca22-174">Enviar imediata também é útil quando está a fechar o cliente de fabric Olá (por exemplo, o processo de Olá determinou estado inválido e tem de tooshut baixo tooprevent lado efeitos).</span><span class="sxs-lookup"><span data-stu-id="7ca22-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="7ca22-175">Assegura um envio de melhor esforço de Olá acumulado relatórios.</span><span class="sxs-lookup"><span data-stu-id="7ca22-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="7ca22-176">Quando é adicionado um relatório com o sinalizador de imediato, o cliente do Estado de funcionamento de Olá lotes todos os relatórios de Olá acumulado desde o último envio.</span><span class="sxs-lookup"><span data-stu-id="7ca22-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="7ca22-177">É possível especificar parâmetros mesmos quando é criado um cluster de tooa de ligação através do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7ca22-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="7ca22-178">Olá seguinte o exemplo é iniciado um cluster local de tooa de ligação:</span><span class="sxs-lookup"><span data-stu-id="7ca22-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="7ca22-179">Da mesma forma tooAPI, relatórios podem ser enviados utilizando `-Immediate` comutador toobe enviado imediatamente, independentemente de Olá `HealthReportSendInterval` valor.</span><span class="sxs-lookup"><span data-stu-id="7ca22-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="7ca22-180">Para REST, Olá relatórios são enviados gateway de Service Fabric toohello, que tem um cliente de recursos de infraestrutura interna.</span><span class="sxs-lookup"><span data-stu-id="7ca22-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="7ca22-181">Por predefinição, este cliente está relatórios toosend configurado em lotes cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="7ca22-182">Pode alterar o intervalo de lote Olá com a definição de configuração de cluster Olá `HttpGatewayHealthReportSendInterval` no `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="7ca22-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="7ca22-183">Conforme mencionado, uma melhor opção é toosend Olá relatórios com `Immediate` verdadeiro.</span><span class="sxs-lookup"><span data-stu-id="7ca22-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="7ca22-184">tooensure não autorizado serviços não é possível comunicar o estado de funcionamento contra Olá as entidades de cluster Olá, configurar Olá tooaccept de pedidos de servidor apenas a partir de clientes protegidos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="7ca22-185">Olá `FabricClient` utilizada para os relatórios têm de ter com segurança ativada toobe toocommunicate consegue com cluster Olá (por exemplo, com o Kerberos ou autenticação de certificados).</span><span class="sxs-lookup"><span data-stu-id="7ca22-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="7ca22-186">Leia mais sobre [cluster segurança](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="7ca22-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="7ca22-187">Relatório de dentro de serviços de baixo privilégio</span><span class="sxs-lookup"><span data-stu-id="7ca22-187">Report from within low privilege services</span></span>
<span data-ttu-id="7ca22-188">Se os serviços do Service Fabric não dispõe de cluster de toohello de acesso de administrador, pode comunicar o estado de funcionamento entidades do contexto atual do Olá através de `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="7ca22-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="7ca22-189">Para os serviços sem monitorização de estado, utilize [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport na instância de serviço atual Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="7ca22-190">Para os serviços com monitorização de estado, utilize [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport na réplica atual.</span><span class="sxs-lookup"><span data-stu-id="7ca22-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="7ca22-191">Utilize [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport na entidade de partição atual Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="7ca22-192">Utilize [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport na aplicação atual.</span><span class="sxs-lookup"><span data-stu-id="7ca22-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="7ca22-193">Utilize [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport na aplicação atual Olá implementada no nó atual Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="7ca22-194">Utilize [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport num pacote de serviço para a aplicação Olá implementado no nó atual Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="7ca22-195">Internamente, Olá `Partition` e Olá `CodePackageActivationContext` conter um cliente do Estado de funcionamento configurado com predefinições.</span><span class="sxs-lookup"><span data-stu-id="7ca22-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="7ca22-196">Conforme explicado para Olá [cliente do Estado de funcionamento](service-fabric-report-health.md#health-client), relatórios são compilados em batch e enviados um temporizador.</span><span class="sxs-lookup"><span data-stu-id="7ca22-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="7ca22-197">objetos de Olá devem ser mantida alive toohave um relatório de Olá toosend hipótese.</span><span class="sxs-lookup"><span data-stu-id="7ca22-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="7ca22-198">Pode especificar `HealthReportSendOptions` quando enviar relatórios através de `Partition` e `CodePackageActivationContext` APIs de estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="7ca22-199">Se tiver relatórios críticos que devem ser enviados logo que possível, utilize `HealthReportSendOptions` com Immediate `true`.</span><span class="sxs-lookup"><span data-stu-id="7ca22-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="7ca22-200">Relatórios de imediato ignorar Olá intervalo do cliente do Estado de funcionamento interno de Olá de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="7ca22-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="7ca22-201">Tal como mencionado anteriormente, utilize este sinalizador com cuidado; Queremos tootake partido do cliente do Estado de funcionamento de Olá criação de batches sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="7ca22-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="7ca22-202">Relatórios de estado de funcionamento de design</span><span class="sxs-lookup"><span data-stu-id="7ca22-202">Design health reporting</span></span>
<span data-ttu-id="7ca22-203">Olá primeiro passo na geração de relatórios de alta qualidade está a identificar as condições de Olá que podem afetar o estado de funcionamento de Olá do serviço de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="7ca22-204">Quaisquer condições que podem ajudar a problemas de sinalizador num cluster ou de serviço Olá quando inicia - ou mesmo melhor, antes de um problema ocorre – pode potencialmente guardar billions dos utilizados no compromisso.</span><span class="sxs-lookup"><span data-stu-id="7ca22-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="7ca22-205">vantagens de Olá incluem menor tempo, menos noite horas despendem a investigar e reparar problemas e superior satisfação do cliente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="7ca22-206">Depois de condições de Olá são identificadas, escritores watchdog tem toofigure saída Olá melhor forma toomonitor-los para equilibrar entre sobrecarga e utilidade.</span><span class="sxs-lookup"><span data-stu-id="7ca22-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="7ca22-207">Por exemplo, considere um serviço que cálculos complexos que utilizam alguns ficheiros temporários numa partilha.</span><span class="sxs-lookup"><span data-stu-id="7ca22-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="7ca22-208">Um watchdog do foi monitorizar Olá partilha tooensure ficará disponível espaço suficiente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="7ca22-209">Foi possível escutar a para notificações de alterações do ficheiro ou diretório.</span><span class="sxs-lookup"><span data-stu-id="7ca22-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="7ca22-210">-Foi reportar um aviso se for atingido um limiar de compromisso e reportar um erro se a partilha de Olá está cheia.</span><span class="sxs-lookup"><span data-stu-id="7ca22-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="7ca22-211">Num aviso, um sistema de reparação foi possível iniciar a limpeza mais antigos ficheiros numa partilha de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="7ca22-212">Um erro, um sistema de reparação foi Olá serviço réplica tooanother move o nó para.</span><span class="sxs-lookup"><span data-stu-id="7ca22-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="7ca22-213">Tenha em atenção a como Olá condição Estados são descritos em termos de estado de funcionamento: hello do Estado de Olá condição que pode ser considerados como estando em bom estado (ok) ou mau estado de funcionamento (aviso ou erro).</span><span class="sxs-lookup"><span data-stu-id="7ca22-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="7ca22-214">Depois de detalhes de monitorização de Olá estiver definidos, um escritor watchdog tem toofigure enviados como tooimplement Olá watchdog do.</span><span class="sxs-lookup"><span data-stu-id="7ca22-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="7ca22-215">Se a condições de Olá podem ser determinadas a partir do serviço de Olá, Watchdog de Olá pode fazer parte do próprio serviço de Olá monitorizado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="7ca22-216">Por exemplo, código do serviço Olá pode verificar a utilização da partilha de Olá e, em seguida, comunicar sempre que este tenta toowrite um ficheiro.</span><span class="sxs-lookup"><span data-stu-id="7ca22-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="7ca22-217">Olá vantagem esta abordagem é que o Reporting Services é simples.</span><span class="sxs-lookup"><span data-stu-id="7ca22-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="7ca22-218">Deve ter cuidado tooprevent erros de watchdog de afetar a funcionalidade do serviço de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="7ca22-219">Relatórios a partir de serviço Olá monitorizado nem sempre é uma opção.</span><span class="sxs-lookup"><span data-stu-id="7ca22-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="7ca22-220">Um Watchdog no âmbito do serviço de Olá pode não ser capaz de toodetect condições de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="7ca22-221">Poderá não ter Olá lógica ou dados toomake Olá determinação.</span><span class="sxs-lookup"><span data-stu-id="7ca22-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="7ca22-222">overhead de Olá de monitorização de condições de Olá pode ser elevado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="7ca22-223">condições de Olá também poderão não ser serviço tooa específico, mas em vez disso, afetar as interações entre os serviços.</span><span class="sxs-lookup"><span data-stu-id="7ca22-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="7ca22-224">Outra opção é toohave watchdogs num cluster de Olá como processos separados.</span><span class="sxs-lookup"><span data-stu-id="7ca22-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="7ca22-225">watchdogs Olá monitorizar condições Olá e o relatório, sem afetar os serviços de Olá principal de qualquer forma.</span><span class="sxs-lookup"><span data-stu-id="7ca22-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="7ca22-226">Por exemplo, estes watchdogs ser implementados como serviços sem monitorização de estado no Olá mesma aplicação, implementada em todos os nós ou num Olá nós mesmos como serviço Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="7ca22-227">Por vezes, um Watchdog em execução no cluster de Olá não é uma opção:.</span><span class="sxs-lookup"><span data-stu-id="7ca22-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="7ca22-228">Se a condição Olá monitorizado é disponibilidade Olá ou funcionalidade do serviço de Olá, tal como os utilizadores veem-lo, é melhor watchdogs de Olá toohave no Olá mesmo colocar como clientes de utilizador Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="7ca22-229">Não existe, podem testar as operações de Olá no Olá mesmo modo, os utilizadores chamá-los.</span><span class="sxs-lookup"><span data-stu-id="7ca22-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="7ca22-230">Por exemplo, pode ter um watchdog do que se encontra fora do cluster de Olá, emite pedidos de serviço toohello e verifica a latência de Olá e a correção do resultado de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="7ca22-231">(Para um serviço de calculadora, por exemplo, 2 + 2 devolver 4 dentro de um período de tempo razoável?)</span><span class="sxs-lookup"><span data-stu-id="7ca22-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="7ca22-232">Depois de tem sido finalizados detalhes de watchdog Olá, deve decidir num ID de origem que identifica exclusivamente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="7ca22-233">Se vários watchdogs de Olá mesmo tipo são living no hello cluster, estes tem um relatório sobre entidades diferentes ou, se estes relatórios sobre Olá mesma entidade, o ID de origem diferente de utilização ou propriedade.</span><span class="sxs-lookup"><span data-stu-id="7ca22-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="7ca22-234">Desta forma, os relatórios podem coexistir.</span><span class="sxs-lookup"><span data-stu-id="7ca22-234">This way, their reports can coexist.</span></span> <span data-ttu-id="7ca22-235">propriedade de Olá do relatório de estado de funcionamento de Olá deve capturar condição Olá monitorizado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="7ca22-236">(Por exemplo de Olá acima, pode ser propriedade de Olá **ShareSize**.) Se vários relatórios aplicam toohello mesmo condição, hello propriedade deve conter algumas informações dinâmicas que lhe permite toocoexist de relatórios.</span><span class="sxs-lookup"><span data-stu-id="7ca22-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="7ca22-237">Por exemplo, se precisam de múltiplas partilhas toobe monitorizado, o nome da propriedade Olá pode ser **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="7ca22-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="7ca22-238">Efetue *não* utilizar informações de estado de tookeep de arquivo de estado de funcionamento de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="7ca22-239">Apenas as informações relacionadas com o estado de funcionamento devem reportadas como estado de funcionamento, como esta avaliação do Estado de funcionamento de Olá impactos informações de uma entidade.</span><span class="sxs-lookup"><span data-stu-id="7ca22-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="7ca22-240">arquivo de estado de funcionamento de Olá não foi concebido como um arquivo para fins gerais.</span><span class="sxs-lookup"><span data-stu-id="7ca22-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="7ca22-241">Utiliza tooaggregate de lógica de avaliação do Estado de funcionamento todos os dados em estado de funcionamento de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="7ca22-242">Estado de funcionamento de agregados de enviar informações relacionado com toohealth (como comunicar o estado com um Estado de funcionamento de OK) não tem impacto Olá, mas pode afetar negativamente desempenho Olá do arquivo de estado de funcionamento de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="7ca22-243">ponto de decisão seguinte Olá-se que tooreport de entidade.</span><span class="sxs-lookup"><span data-stu-id="7ca22-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="7ca22-244">A maioria do tempo de Olá, condição Olá claramente idetifies Olá entidade.</span><span class="sxs-lookup"><span data-stu-id="7ca22-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="7ca22-245">Escolha entidade Olá com melhores granularidade possíveis.</span><span class="sxs-lookup"><span data-stu-id="7ca22-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="7ca22-246">Se uma condição afeta todas as réplicas numa partição, um relatório sobre partição Olá, não é possível no serviço de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="7ca22-247">Existem onde mais profundamente for necessária, apesar de nos casos extremos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="7ca22-248">Se a condição de Olá afeta uma entidade, tal como uma réplica, mas Olá desire é toohave Olá condição sinalizada mais de duração Olá de vida de réplica, em seguida, deve ser declarada na partição de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="7ca22-249">Caso contrário, quando é eliminada réplica Olá, arquivo de estado de funcionamento de Olá limpa todos os seus relatórios.</span><span class="sxs-lookup"><span data-stu-id="7ca22-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="7ca22-250">Escritores Watchdog tem de pensar sobre durações Olá de entidade Olá e relatório Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="7ca22-251">Tem de ser encriptado quando um relatório deve ser limpa a partir de um arquivo (por exemplo, quando um erro comunicado numa entidade já não se aplica).</span><span class="sxs-lookup"><span data-stu-id="7ca22-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="7ca22-252">Vamos ver um exemplo que coloca em conjunto pontos Olá que posso descrito.</span><span class="sxs-lookup"><span data-stu-id="7ca22-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="7ca22-253">Considere que uma aplicação de Service Fabric é composto por um serviço com monitorização de estado de persistente principal e secundários serviços sem monitorização de estado implementados em todos os nós (um tipo de serviço secundário para cada tipo de tarefa).</span><span class="sxs-lookup"><span data-stu-id="7ca22-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="7ca22-254">mestre de Olá tem uma fila de processamento que contém toobe comandos executado por secundárias.</span><span class="sxs-lookup"><span data-stu-id="7ca22-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="7ca22-255">bases de dados secundárias Olá executar pedidos de entrada Olá e enviar sinais de back-confirmação.</span><span class="sxs-lookup"><span data-stu-id="7ca22-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="7ca22-256">Uma condição que foi monitorizada é o comprimento da fila de processamento mestre Olá Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="7ca22-257">Se o comprimento da fila principal de Olá atinge um limiar, é reportado um aviso.</span><span class="sxs-lookup"><span data-stu-id="7ca22-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="7ca22-258">Aviso de Olá indica que bases de dados secundárias Olá não consegue processar a carga de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="7ca22-259">Se a fila de Olá atinge o comprimento de máximo de Olá e comandos são ignorados, é reportado um erro, como Olá não é possível recuperar o serviço.</span><span class="sxs-lookup"><span data-stu-id="7ca22-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="7ca22-260">Olá relatórios podem ser propriedade de Olá **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="7ca22-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="7ca22-261">Watchdog de Olá se encontrem dentro Olá serviço e é enviada periodicamente na réplica primária principal de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="7ca22-262">tempo de Olá toolive é dois minutos e é enviada periodicamente a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="7ca22-263">Se Olá primário ficar inativo, relatório de Olá é automaticamente limpa da loja.</span><span class="sxs-lookup"><span data-stu-id="7ca22-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="7ca22-264">Se a réplica do serviço de Olá está a funcionar, mas este é está bloqueada ou ter outros problemas, Olá relatório expira no arquivo de estado de funcionamento de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="7ca22-265">Neste caso, a entidade de Olá é avaliada no erro.</span><span class="sxs-lookup"><span data-stu-id="7ca22-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="7ca22-266">Outra condição que pode ser monitorizada é o tempo de execução de tarefas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="7ca22-267">Olá mestre distribui as tarefes toohello secundárias com base no tipo de tarefa Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="7ca22-268">Dependendo da estrutura de Olá, mestre Olá foi consultar secundárias Olá para o estado da tarefa.</span><span class="sxs-lookup"><span data-stu-id="7ca22-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="7ca22-269">Foi também Aguarde para bases de dados secundárias toosend confirmação back sinais quando estes terminado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="7ca22-270">No segundo caso Olá, deve ter cuidado situações toodetect em que as réplicas secundárias die ou mensagens sejam perdidas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="7ca22-271">Uma opção é para Olá mestre toosend um toohello de pedido de ping secundários, mesmo que envia o estado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="7ca22-272">Se não for recebido nenhuma Estado, o mestre de Olá considera-la uma falha e reschedules tarefas Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="7ca22-273">Este comportamento parte do pressuposto de que as tarefas de Olá idempotent.</span><span class="sxs-lookup"><span data-stu-id="7ca22-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="7ca22-274">condição de Olá monitorizado possa ser convertida como um aviso se a tarefa de Olá não é efetuada num determinado período de tempo (**t1**, por exemplo, 10 minutos).</span><span class="sxs-lookup"><span data-stu-id="7ca22-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="7ca22-275">Se a tarefa de Olá não é concluída no tempo (**t2**, por exemplo, 20 minutos), pode ser convertida condição Olá monitorizado como erro.</span><span class="sxs-lookup"><span data-stu-id="7ca22-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="7ca22-276">Este relatório pode ser feito de várias formas:</span><span class="sxs-lookup"><span data-stu-id="7ca22-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="7ca22-277">réplica primária principal de Olá os relatórios no próprio periodicamente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="7ca22-278">Pode ter uma propriedade para todas as tarefas pendentes na fila de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="7ca22-279">Se, pelo menos, uma tarefa demora mais, comunicar o estado Olá na propriedade Olá **PendingTasks** é um aviso ou erro, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="7ca22-280">Se não existem tarefas pendentes ou todas as tarefas iniciou a execução, o estado do relatório de Olá é OK.</span><span class="sxs-lookup"><span data-stu-id="7ca22-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="7ca22-281">tarefas de Olá sejam persistentes.</span><span class="sxs-lookup"><span data-stu-id="7ca22-281">hello tasks are persistent.</span></span> <span data-ttu-id="7ca22-282">Se Olá primário ficar inativo, primário Olá recentemente promovido pode continuar tooreport corretamente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="7ca22-283">Outro processo watchdog (na nuvem de Olá ou externa) verifica tarefas Olá (do fora, com base no resultado da tarefa Olá pretendido) toosee se estes estão concluídas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="7ca22-284">Se não Respeitamos a limiares Olá, é enviado um relatório de serviço principal Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="7ca22-285">Também é enviado um relatório de cada tarefa que inclui o identificador de tarefa Olá, como **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="7ca22-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="7ca22-286">Relatórios devem ser enviados apenas em mau estado de funcionamento Estados.</span><span class="sxs-lookup"><span data-stu-id="7ca22-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="7ca22-287">Definir tooa toolive tempo alguns minutos e marcar Olá relatórios toobe removido quando expirarem tooensure limpeza.</span><span class="sxs-lookup"><span data-stu-id="7ca22-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="7ca22-288">Olá secundário que está a executar uma tarefa relatórios quando demora mais do que esperado toorun-lo.</span><span class="sxs-lookup"><span data-stu-id="7ca22-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="7ca22-289">Esta comunica na instância do serviço Olá na propriedade Olá **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="7ca22-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="7ca22-290">relatório de Olá pinpoints instância de serviço de Olá tem problemas, mas não captura situação olá onde a instância de Olá dies.</span><span class="sxs-lookup"><span data-stu-id="7ca22-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="7ca22-291">relatórios de Olá são, em seguida, limpa.</span><span class="sxs-lookup"><span data-stu-id="7ca22-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="7ca22-292">Foi de relatório no serviço secundário Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-292">It could report on hello secondary service.</span></span> <span data-ttu-id="7ca22-293">Se Olá secundário concluir a tarefa de Olá, instância secundário Olá limpa relatório Olá do arquivo de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="7ca22-294">relatório de Olá não captura situação olá onde mensagem de confirmação de saudação perde-se e tarefas de Olá não foi concluída do ponto de vista do mestre de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="7ca22-295">No entanto, os relatórios de Olá é efetuada em casos Olá descritos acima, Olá relatórios são capturados no estado de funcionamento da aplicação quando o estado de funcionamento é avaliado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="7ca22-296">Relatório periodicamente vs em transição</span><span class="sxs-lookup"><span data-stu-id="7ca22-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="7ca22-297">Utilizando o modelo de relatório de funcionamento de Olá, watchdogs pode enviar relatórios periodicamente ou transições.</span><span class="sxs-lookup"><span data-stu-id="7ca22-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="7ca22-298">Olá recomendada forma para watchdog do Reporting Services é periodicamente, porque o código de Olá tooerrors muito mais simples e menos propenso.</span><span class="sxs-lookup"><span data-stu-id="7ca22-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="7ca22-299">watchdogs Olá devem esforçar-nos toobe tão simple como tooavoid possíveis erros que acionam relatórios incorretos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="7ca22-300">Incorreto *mau estado de funcionamento* relatórios afetam os cenários de com base no estado de funcionamento, incluindo atualizações e avaliações do Estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="7ca22-301">Incorreto *bom* relatórios ocultar os problemas no cluster de Olá, que não for pretendida.</span><span class="sxs-lookup"><span data-stu-id="7ca22-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="7ca22-302">Para os relatórios periódica, Watchdog de Olá pode ser implementada com um temporizador.</span><span class="sxs-lookup"><span data-stu-id="7ca22-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="7ca22-303">Uma chamada de retorno do temporizador, Watchdog de Olá pode verificar o estado de Olá e enviar um relatório com base no estado atual do Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="7ca22-304">Não há nenhum toosee necessidade, o relatório foi enviado anteriormente ou efetuar quaisquer otimizações em termos de mensagens.</span><span class="sxs-lookup"><span data-stu-id="7ca22-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="7ca22-305">cliente do Estado de funcionamento de Olá tem toohelp lógica com um desempenho de criação de batches.</span><span class="sxs-lookup"><span data-stu-id="7ca22-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="7ca22-306">Enquanto o cliente do Estado de funcionamento de Olá é mantida activa, internamente repete até que o relatório de Olá é confirmado ao arquivo de estado de funcionamento de Olá ou Watchdog de Olá gera um relatório mais recente com Olá mesma entidade, de propriedade e origem.</span><span class="sxs-lookup"><span data-stu-id="7ca22-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="7ca22-307">Transições de relatórios requer processamento tenha o cuidado de estado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="7ca22-308">Watchdog de Olá monitoriza algumas condições e os relatórios apenas quando as condições de Olá alterar.</span><span class="sxs-lookup"><span data-stu-id="7ca22-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="7ca22-309">Olá upside desta abordagem é que são necessários menos relatórios.</span><span class="sxs-lookup"><span data-stu-id="7ca22-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="7ca22-310">downside Olá está lógica Olá de Watchdog de Olá complexa.</span><span class="sxs-lookup"><span data-stu-id="7ca22-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="7ca22-311">Watchdog de Olá tem de manter condições Olá ou relatórios Olá, para que possam ser inspecionado toodetermine alterações de estado.</span><span class="sxs-lookup"><span data-stu-id="7ca22-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="7ca22-312">Na ativação pós-falha, deve ter cuidado com relatórios adicionado, mas ainda não enviou toohello arquivo de estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="7ca22-313">número de sequência de Olá tem de ser alguma vez aumentar.</span><span class="sxs-lookup"><span data-stu-id="7ca22-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="7ca22-314">Caso contrário, Olá relatórios são rejeitados como obsoletos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="7ca22-315">Em casos raros olá onde é tarifas de perda de dados, a sincronização pode ser necessária entre o estado de Olá do relatório de Olá e estado de Olá do arquivo de estado de funcionamento de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="7ca22-316">Elaboração de relatórios em transições faz sentido para elaboração de relatórios em si próprios, através de serviços `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="7ca22-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="7ca22-317">Olá quando o objeto local (réplica ou de um pacote de serviço implementado / implementado aplicação) é removida, todos os respetivos relatórios são também removidos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="7ca22-318">Este limpeza automática relaxes Olá necessário para a sincronização entre o relatório e o arquivo de estado de funcionamento.</span><span class="sxs-lookup"><span data-stu-id="7ca22-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="7ca22-319">Se o relatório de Olá destina-se a partição principal ou a aplicação principal, deve ter cuidado nos relatórios de obsoletos de tooavoid de ativação pós-falha no arquivo de estado de funcionamento de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="7ca22-320">Lógica tem de ser adicionada Estado correto do toomaintain Olá e relatório Olá clara da loja quando já não é necessária.</span><span class="sxs-lookup"><span data-stu-id="7ca22-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="7ca22-321">Implementar o relatório de estado de funcionamento</span><span class="sxs-lookup"><span data-stu-id="7ca22-321">Implement health reporting</span></span>
<span data-ttu-id="7ca22-322">Assim hello detalhes de entidade e o relatório estiverem encriptados, enviar relatórios de estado de funcionamento pode ser feito através da API de Olá, PowerShell ou REST.</span><span class="sxs-lookup"><span data-stu-id="7ca22-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="7ca22-323">API</span><span class="sxs-lookup"><span data-stu-id="7ca22-323">API</span></span>
<span data-ttu-id="7ca22-324">tooreport através de Olá API, terá de toocreate um tipo de entidade do toohello específico do Estado de funcionamento relatório pretendem tooreport no.</span><span class="sxs-lookup"><span data-stu-id="7ca22-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="7ca22-325">Atribua o cliente de estado de funcionamento do Olá relatório tooa.</span><span class="sxs-lookup"><span data-stu-id="7ca22-325">Give hello report tooa health client.</span></span> <span data-ttu-id="7ca22-326">Em alternativa, crie uma informações de estado de funcionamento e transmita-toocorrect reporting métodos em `Partition` ou `CodePackageActivationContext` tooreport entidades atual.</span><span class="sxs-lookup"><span data-stu-id="7ca22-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="7ca22-327">Olá exemplo seguinte mostra periódico de relatórios a partir de um Watchdog num cluster de Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="7ca22-328">Watchdog de Olá verifica se um recurso externo pode ser acedido a partir dentro de um nó.</span><span class="sxs-lookup"><span data-stu-id="7ca22-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="7ca22-329">recurso de Olá é necessário um manifesto de serviço na aplicação Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="7ca22-330">Se o recurso de Olá não estiver disponível, hello outros serviços dentro da aplicação Olá podem continuará a funcionar corretamente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="7ca22-331">Por conseguinte, Olá relatório é enviado na entidade de pacote de serviço Olá implementado cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="7ca22-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="7ca22-332">PowerShell</span></span>
<span data-ttu-id="7ca22-333">Enviar relatórios de estado de funcionamento com  **envio ServiceFabric*EntityType*HealthReport * *.</span><span class="sxs-lookup"><span data-stu-id="7ca22-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="7ca22-334">Olá exemplo seguinte mostra periódico de relatórios nos valores de CPU num nó.</span><span class="sxs-lookup"><span data-stu-id="7ca22-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="7ca22-335">relatórios de Olá devem ser enviados a cada 30 segundos e têm um período de tempo toolive de dois minutos.</span><span class="sxs-lookup"><span data-stu-id="7ca22-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="7ca22-336">Se expirarem, o relatório de Olá tem problemas, para que o nó Olá é avaliada em erro.</span><span class="sxs-lookup"><span data-stu-id="7ca22-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="7ca22-337">Quando Olá CPU está acima de um limiar, o relatório de Olá tem um Estado de funcionamento de aviso.</span><span class="sxs-lookup"><span data-stu-id="7ca22-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="7ca22-338">Quando Olá CPU permanece acima de um limiar mais de tempo de Olá configurado, é reportado como um erro.</span><span class="sxs-lookup"><span data-stu-id="7ca22-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="7ca22-339">Caso contrário, o relatório de Olá envia um Estado de funcionamento de OK.</span><span class="sxs-lookup"><span data-stu-id="7ca22-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="7ca22-340">Olá exemplo seguinte relatórios um aviso transitório numa réplica.</span><span class="sxs-lookup"><span data-stu-id="7ca22-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="7ca22-341">Este primeiro obtém o ID de partição Olá e Olá, em seguida, o ID de réplica para o serviço de Olá que é interessado no.</span><span class="sxs-lookup"><span data-stu-id="7ca22-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="7ca22-342">Em seguida, envia um relatório na **PowershellWatcher** na propriedade Olá **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="7ca22-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="7ca22-343">relatório de Olá é de interesse para apenas dois minutos e este é removido do arquivo de Olá automaticamente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="7ca22-344">REST</span><span class="sxs-lookup"><span data-stu-id="7ca22-344">REST</span></span>
<span data-ttu-id="7ca22-345">Envie relatórios de estado de funcionamento através de REST com pedidos POST, aceda a entidade de toohello pretendida e que tenham na descrição de relatório de estado de funcionamento do Olá corpo Olá.</span><span class="sxs-lookup"><span data-stu-id="7ca22-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="7ca22-346">Por exemplo, consulte como toosend REST [relatórios de estado de funcionamento do cluster](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) ou [relatórios de estado de funcionamento do serviço](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="7ca22-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="7ca22-347">Todas as entidades são suportadas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7ca22-348">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="7ca22-348">Next steps</span></span>
<span data-ttu-id="7ca22-349">Com base nos dados de estado de funcionamento de Olá, escritores de serviço e os administradores de cluster/aplicação podem considerar informações de Olá tooconsume de formas.</span><span class="sxs-lookup"><span data-stu-id="7ca22-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="7ca22-350">Por exemplo, pode definir alertas com base no graves problemas do Estado de funcionamento Estado toocatch antes de poderem provoke falhas de cópia de segurança.</span><span class="sxs-lookup"><span data-stu-id="7ca22-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="7ca22-351">Os administradores podem também configurar problemas de toofix de sistemas de reparação automaticamente.</span><span class="sxs-lookup"><span data-stu-id="7ca22-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="7ca22-352">Introdução tooService estado de funcionamento de recursos de infraestrutura monitorização</span><span class="sxs-lookup"><span data-stu-id="7ca22-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="7ca22-353">Ver relatórios de estado de funcionamento do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="7ca22-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="7ca22-354">Como tooreport e verificação de estado de funcionamento do serviço</span><span class="sxs-lookup"><span data-stu-id="7ca22-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="7ca22-355">Utilizar relatórios de estado de funcionamento do sistema para resolução de problemas</span><span class="sxs-lookup"><span data-stu-id="7ca22-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="7ca22-356">Monitorizar e diagnosticar os serviços localmente</span><span class="sxs-lookup"><span data-stu-id="7ca22-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="7ca22-357">Atualização da aplicação de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="7ca22-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

