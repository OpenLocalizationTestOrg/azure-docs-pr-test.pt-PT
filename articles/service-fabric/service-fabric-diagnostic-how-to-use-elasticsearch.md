---
title: "aaaUsing Elasticsearch como um arquivo de rastreio de aplicação de Service Fabric | Microsoft Docs"
description: "Descreve como aplicações de Service Fabric podem utilizar toostore Elasticsearch e Kibana, índice e pesquisa através de rastreios de aplicações (registos)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="10595-103">Armazenar Elasticsearch utilização como um rastreio de aplicação de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="10595-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="10595-104">Introdução</span><span class="sxs-lookup"><span data-stu-id="10595-104">Introduction</span></span>
<span data-ttu-id="10595-105">Este artigo descreve como [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) as aplicações podem utilizar **Elasticsearch** e **Kibana** para armazenamento de aplicação de rastreio, a indexação e pesquisa.</span><span class="sxs-lookup"><span data-stu-id="10595-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="10595-106">[Elasticsearch](https://www.elastic.co/guide/index.html) é um open source, distribuída e escalável em tempo real de procura e análise motor que é adequada para esta tarefa.</span><span class="sxs-lookup"><span data-stu-id="10595-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="10595-107">Pode ser instalado no Windows e Linux máquinas de virtuais em execução no Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="10595-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="10595-108">Elasticsearch eficientemente pode processar *estruturados* rastreios produzidos utilizando tecnologias como **rastreio de eventos para o Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="10595-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="10595-109">ETW é utilizado pelo Service Fabric runtime toosource informações de diagnóstico (rastreios).</span><span class="sxs-lookup"><span data-stu-id="10595-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="10595-110">É Olá recomendado demasiado as respetivas informações de diagnóstico de método para toosource de aplicações de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="10595-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="10595-111">Utilizar Olá mesmo mecanismo permite a correlação entre os rastreios fornecido pelo runtime e fornecido por aplicação e torna mais fácil de resolução de problemas.</span><span class="sxs-lookup"><span data-stu-id="10595-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="10595-112">Modelos de projeto de Service Fabric no Visual Studio incluem uma API de registo (com base no Olá .NET **EventSource** classe) que emite rastreios ETW por predefinição.</span><span class="sxs-lookup"><span data-stu-id="10595-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="10595-113">Para obter uma descrição geral da aplicação de Service Fabric de rastreio utilizando a ETW, consulte o artigo [monitorização e diagnosticar os serviços de uma configuração de desenvolvimento do computador local](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="10595-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="10595-114">Para os rastreios de Olá tooshow cópias de segurança no Elasticsearch, necessitam de toobe capturada em nós de cluster do Service Fabric Olá em tempo real (durante a execução da aplicação Olá) e enviados tooan Elasticsearch endpoint.</span><span class="sxs-lookup"><span data-stu-id="10595-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="10595-115">Existem duas opções principais para capturar o rastreio:</span><span class="sxs-lookup"><span data-stu-id="10595-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="10595-116">**Dentro do processo rastreio capturar**</span><span class="sxs-lookup"><span data-stu-id="10595-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="10595-117">aplicação Olá ou mais precisamente, processo de serviço, é responsável pelo envio de arquivo de rastreio de toohello Olá dados de diagnóstico (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="10595-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="10595-118">**Capturar fora do processo rastreio**</span><span class="sxs-lookup"><span data-stu-id="10595-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="10595-119">Um agente separado é capturar rastreios de processo do serviço de Olá ou os processos e enviando-as toohello arquivo de rastreio.</span><span class="sxs-lookup"><span data-stu-id="10595-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="10595-120">Abaixo, iremos descrevem como tooset segurança Elasticsearch no Azure, analisam os profissionais de Olá e contras para ambos capturar as opções e explicam como tooconfigure uma infraestrutura de serviço service toosend tooElasticsearch de dados.</span><span class="sxs-lookup"><span data-stu-id="10595-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="10595-121">Configurar Elasticsearch no Azure</span><span class="sxs-lookup"><span data-stu-id="10595-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="10595-122">Olá tooset de forma mais simples serviço de Elasticsearch Olá no Azure é efetuada através de [ **modelos Azure Resource Manager**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="10595-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="10595-123">Um abrangentes [modelo de início rápido do Azure Resource Manager para Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) está disponível a partir do repositório de modelos de início rápido do Azure.</span><span class="sxs-lookup"><span data-stu-id="10595-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="10595-124">Este modelo utiliza contas de armazenamento separada para unidades de escala (grupos de nós).</span><span class="sxs-lookup"><span data-stu-id="10595-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="10595-125">Também pode aprovisionar cliente separado e nós de servidor com configurações diferentes e vários números de discos de dados ligados.</span><span class="sxs-lookup"><span data-stu-id="10595-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="10595-126">Aqui, utilizamos o modelo de outro, denominado **ES MultiNode** de Olá [repositório de ferramentas de diagnóstico do Azure](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="10595-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="10595-127">Este modelo é mais fácil toouse e cria um cluster de Elasticsearch protegido através da autenticação básica de HTTP.</span><span class="sxs-lookup"><span data-stu-id="10595-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="10595-128">Antes de continuar, transfira repositório Olá a partir do GitHub tooyour máquina (através da clonagem repositório Olá ou transferir um ficheiro zip).</span><span class="sxs-lookup"><span data-stu-id="10595-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="10595-129">modelo de Olá ES MultiNode está localizado na pasta de Olá com Olá mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="10595-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="10595-130">Preparar uma máquina toorun Elasticsearch scripts de instalação</span><span class="sxs-lookup"><span data-stu-id="10595-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="10595-131">Olá modelo de Olá MultiNode de ES de toouse de forma mais fácil é através de um script do PowerShell do Azure fornecido chamado `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="10595-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="10595-132">toouse este script, terá de módulos do PowerShell tooinstall e uma ferramenta chamado **openssl**.</span><span class="sxs-lookup"><span data-stu-id="10595-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="10595-133">Olá esta última opção é necessária para criar uma chave SSH que pode ser utilizado tooadminister Elasticsearch cluster remotamente.</span><span class="sxs-lookup"><span data-stu-id="10595-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="10595-134">`CreateElasticSearchCluster`script foi concebido para facilidade de utilização com o modelo de Olá MultiNode de ES de um computador Windows.</span><span class="sxs-lookup"><span data-stu-id="10595-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="10595-135">É possível toouse Olá modelo numa máquina não sejam Windows, mas esse cenário ultrapassa o âmbito Olá deste artigo.</span><span class="sxs-lookup"><span data-stu-id="10595-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="10595-136">Se ainda não instalou-los já, instalar [ **módulos do Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="10595-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="10595-137">Quando lhe for pedido, clique em **executar**, em seguida, **instalar**.</span><span class="sxs-lookup"><span data-stu-id="10595-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="10595-138">O Azure PowerShell 1.3 ou mais recente é necessário.</span><span class="sxs-lookup"><span data-stu-id="10595-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="10595-139">Olá **openssl** ferramenta está incluída no distribuição Olá [ **Git para Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="10595-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="10595-140">Se ainda não o tiver o feito, instale [Git para Windows](http://www.git-scm.com/downloads) agora.</span><span class="sxs-lookup"><span data-stu-id="10595-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="10595-141">(opções de instalação predefinido Olá estão OK).</span><span class="sxs-lookup"><span data-stu-id="10595-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="10595-142">Partindo do princípio que Git tem sido instalado, mas não incluído no caminho do sistema de Olá, abra uma janela do Microsoft Azure PowerShell e execute Olá os seguintes comandos:</span><span class="sxs-lookup"><span data-stu-id="10595-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="10595-143">Substitua Olá `<Git installation folder>` com a localização do Git Olá no seu computador; é a predefinição de Olá **"C:\Programas\Microsoft Files\Git"**.</span><span class="sxs-lookup"><span data-stu-id="10595-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="10595-144">Tenha em atenção o caráter de ponto e vírgula Olá início Olá do caminho primeiro Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="10595-145">Certifique-se de que tem sessão iniciada no tooAzure (através de [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) e que selecionou subscrição Olá que deve ser utilizadas toocreate o cluster de pesquisa elástico.</span><span class="sxs-lookup"><span data-stu-id="10595-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="10595-146">Pode verificar que subscrição correta está selecionada utilizar `Get-AzureRmContext` e `Get-AzureRmSubscription` cmdlets.</span><span class="sxs-lookup"><span data-stu-id="10595-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="10595-147">Se não tiver o feito, altere pasta Olá para toohello MultiNode de ES de diretório atual.</span><span class="sxs-lookup"><span data-stu-id="10595-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="10595-148">Executar script de CreateElasticSearchCluster Olá</span><span class="sxs-lookup"><span data-stu-id="10595-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="10595-149">Antes de executar o script de Olá, abra Olá `azuredeploy-parameters.json` de ficheiros e certifique-se ou forneça valores para parâmetros do script Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="10595-150">é fornecida Olá os seguintes parâmetros:</span><span class="sxs-lookup"><span data-stu-id="10595-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="10595-151">Nome do Parâmetro</span><span class="sxs-lookup"><span data-stu-id="10595-151">Parameter Name</span></span> | <span data-ttu-id="10595-152">Descrição</span><span class="sxs-lookup"><span data-stu-id="10595-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="10595-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="10595-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="10595-154">nome de Olá que é utilizado toocreate Olá publicamente visível nome do DNS para o cluster de pesquisa elástico Olá (acrescentando nome de toohello fornecido de domínio do Olá região do Azure).</span><span class="sxs-lookup"><span data-stu-id="10595-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="10595-155">Por exemplo, se este valor do parâmetro é "myBigCluster" e a região do Azure Olá escolhido está EUA oeste, o nome DNS resultante Olá para cluster Olá é myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="10595-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="10595-156">Este nome também serve como um nome de raiz para muitos artefactos associados ao cluster de pesquisa elástico Olá, tais como nomes de nó de dados.</span><span class="sxs-lookup"><span data-stu-id="10595-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="10595-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="10595-157">adminUsername</span></span> |<span data-ttu-id="10595-158">nome de Olá da conta de administrador Olá para gerir o cluster de pesquisa elástico Olá (correspondentes chaves de SSH são geradas automaticamente).</span><span class="sxs-lookup"><span data-stu-id="10595-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="10595-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="10595-159">dataNodeCount</span></span> |<span data-ttu-id="10595-160">número de Olá de nós no cluster de pesquisa elástico Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="10595-161">versão atual do Olá do script Olá não distinguir entre os nós de dados e consulta; todos os nós reproduzir ambas as funções.</span><span class="sxs-lookup"><span data-stu-id="10595-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="10595-162">As predefinições too3 nós.</span><span class="sxs-lookup"><span data-stu-id="10595-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="10595-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="10595-163">dataDiskSize</span></span> |<span data-ttu-id="10595-164">tamanho de Olá de discos de dados (em GB) que está alocado para cada nó de dados.</span><span class="sxs-lookup"><span data-stu-id="10595-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="10595-165">Cada nó recebe 4 discos de dados, exclusivamente dedicado tooElastic serviço de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="10595-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="10595-166">Região</span><span class="sxs-lookup"><span data-stu-id="10595-166">region</span></span> |<span data-ttu-id="10595-167">nome de Olá da região do Azure onde o cluster de pesquisa elástico Olá deve estar localizado.</span><span class="sxs-lookup"><span data-stu-id="10595-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="10595-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="10595-168">esUserName</span></span> |<span data-ttu-id="10595-169">Olá nome de utilizador do utilizador Olá que é configurado toohave-cluster acesso tooES (requerente tooHTTP a autenticação básica).</span><span class="sxs-lookup"><span data-stu-id="10595-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="10595-170">Olá palavra-passe não faz parte do ficheiro de parâmetros e tem de ser fornecido quando `CreateElasticSearchCluster` script é invocado.</span><span class="sxs-lookup"><span data-stu-id="10595-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="10595-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="10595-171">vmSizeDataNodes</span></span> |<span data-ttu-id="10595-172">Olá, tamanho de máquina virtual do Azure para nós de cluster de pesquisa elástico.</span><span class="sxs-lookup"><span data-stu-id="10595-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="10595-173">As predefinições tooStandard_D2.</span><span class="sxs-lookup"><span data-stu-id="10595-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="10595-174">Agora, está pronto toorun script de Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="10595-175">Emitir Olá os seguintes comandos:</span><span class="sxs-lookup"><span data-stu-id="10595-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="10595-176">onde</span><span class="sxs-lookup"><span data-stu-id="10595-176">where</span></span> 

| <span data-ttu-id="10595-177">Nome do parâmetro de script</span><span class="sxs-lookup"><span data-stu-id="10595-177">Script Parameter Name</span></span> | <span data-ttu-id="10595-178">Descrição</span><span class="sxs-lookup"><span data-stu-id="10595-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="10595-179">nome de Olá Olá do Azure do grupo de recursos que irá conter todos os recursos de cluster de pesquisa elástico.</span><span class="sxs-lookup"><span data-stu-id="10595-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="10595-180">nome de Olá do Olá região do Azure onde o cluster de pesquisa elástico Olá deve ser criado.</span><span class="sxs-lookup"><span data-stu-id="10595-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="10595-181">Olá palavra-passe para o utilizador de pesquisa elástico Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="10595-182">Se obtiver um NullReferenceException do cmdlet Olá teste-AzureResourceGroup, ter esquecimento toolog no tooAzure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="10595-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="10595-183">Se obtiver um erro ao executar o script de Olá e determinar a que o erro de Olá foi causado por um valor de parâmetro de modelo errado, corrija o ficheiro de parâmetros de Olá e execute o script Olá novamente com um nome de grupo de recursos diferente.</span><span class="sxs-lookup"><span data-stu-id="10595-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="10595-184">Também pode reutilizar Olá o mesmo nome de grupo de recursos e ter o script de Olá limpar Olá antigo adicionando Olá `-RemoveExistingResourceGroup` invocação de script de toohello de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="10595-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="10595-185">Resultado da execução de script de CreateElasticSearchCluster Olá</span><span class="sxs-lookup"><span data-stu-id="10595-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="10595-186">Depois de executar Olá `CreateElasticSearchCluster` script, Olá seguir artefactos principais será criada.</span><span class="sxs-lookup"><span data-stu-id="10595-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="10595-187">Para este exemplo partimos do princípio que utiliza o "myBigCluster" como valor Olá Olá `dnsNameForLoadBalancerIP` parâmetro e nessa região olá onde criou o cluster de Olá é EUA oeste.</span><span class="sxs-lookup"><span data-stu-id="10595-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="10595-188">Artefactos</span><span class="sxs-lookup"><span data-stu-id="10595-188">Artifact</span></span> | <span data-ttu-id="10595-189">Nome, a localização e comentários</span><span class="sxs-lookup"><span data-stu-id="10595-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="10595-190">Chave SSH para a administração remota</span><span class="sxs-lookup"><span data-stu-id="10595-190">SSH key for remote administration</span></span> |<span data-ttu-id="10595-191">ficheiro de myBigCluster.key (no diretório de Olá do qual Olá CreateElasticSearchCluster foi executado).</span><span class="sxs-lookup"><span data-stu-id="10595-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="10595-192">Este ficheiro de chave pode ser utilizados tooconnect toohello admin nó e (através do nó de admin Olá) toodata nós num cluster de Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="10595-193">Nó de Admin</span><span class="sxs-lookup"><span data-stu-id="10595-193">Admin node</span></span> |<span data-ttu-id="10595-194">myBigCluster admin.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="10595-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="10595-195">Uma VM dedicada para administração remota do cluster Elasticsearch – Olá apenas um que permite ligações externas de SSH.</span><span class="sxs-lookup"><span data-stu-id="10595-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="10595-196">Este é executado num Olá does da mesma rede virtual que todos os nós de cluster Elasticsearch Olá, mas não execute todos os serviços Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="10595-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="10595-197">Nós de dados</span><span class="sxs-lookup"><span data-stu-id="10595-197">Data nodes</span></span> |<span data-ttu-id="10595-198">myBigCluster1...</span><span class="sxs-lookup"><span data-stu-id="10595-198">myBigCluster1 …</span></span> <span data-ttu-id="10595-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="10595-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="10595-200">Nós de dados que estejam a executar serviços Elasticsearch e Kibana.</span><span class="sxs-lookup"><span data-stu-id="10595-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="10595-201">Pode ligar através de SSH tooeach nó, mas apenas através de nó de admin Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="10595-202">Elasticsearch cluster</span><span class="sxs-lookup"><span data-stu-id="10595-202">Elasticsearch cluster</span></span> |<span data-ttu-id="10595-203">http://myBigCluster.westus.cloudapp.Azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="10595-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="10595-204">Olá primário ponto final para o cluster de Elasticsearch Olá (sufixo de /es de Olá nota).</span><span class="sxs-lookup"><span data-stu-id="10595-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="10595-205">É protegida pela autenticação HTTP básica (credenciais Olá foram Olá especificado esUserName/esPassword parâmetros de modelo de Olá ES MultiNode).</span><span class="sxs-lookup"><span data-stu-id="10595-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="10595-206">cluster de Olá tem também Olá head Plug-in instalado (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) para a administração de cluster básico.</span><span class="sxs-lookup"><span data-stu-id="10595-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="10595-207">Serviço de Kibana</span><span class="sxs-lookup"><span data-stu-id="10595-207">Kibana service</span></span> |<span data-ttu-id="10595-208">http://myBigCluster.westus.cloudapp.Azure.com</span><span class="sxs-lookup"><span data-stu-id="10595-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="10595-209">Olá Kibana serviço está definida tooshow dados de Olá criado Elasticsearch cluster.</span><span class="sxs-lookup"><span data-stu-id="10595-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="10595-210">É protegida pela Olá mesmas credenciais de autenticação como Olá cluster em si.</span><span class="sxs-lookup"><span data-stu-id="10595-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="10595-211">Em processo versus fora do processo rastreio capturar</span><span class="sxs-lookup"><span data-stu-id="10595-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="10595-212">Na introdução de Olá, iremos mencionado duas formas fundamentais de recolha de dados de diagnóstico: dentro do processo e fora do processo.</span><span class="sxs-lookup"><span data-stu-id="10595-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="10595-213">Cada um tem força da codificação e fragilidades.</span><span class="sxs-lookup"><span data-stu-id="10595-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="10595-214">Vantagens de Olá **dentro do processo rastreio capturar** incluem:</span><span class="sxs-lookup"><span data-stu-id="10595-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="10595-215">*Fácil configuração e implementação*</span><span class="sxs-lookup"><span data-stu-id="10595-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="10595-216">configuração de Olá de recolha de dados de diagnóstico é apenas fazem parte da configuração da aplicação Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="10595-217">É fácil tooalways a mantê-lo "sincronizadas" com Olá rest da aplicação Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="10595-218">É fácil alcançável por aplicação ou serviço a configuração.</span><span class="sxs-lookup"><span data-stu-id="10595-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="10595-219">Normalmente, fora do processo rastreio capturar requer uma implementação separada e de configuração do agente diagnóstico Olá, que é uma tarefa extra administrativa e uma origem de potencial erros.</span><span class="sxs-lookup"><span data-stu-id="10595-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="10595-220">tecnologia de agente específico de Olá, muitas vezes, permite apenas uma instância do agente de Olá por máquina virtual (nó).</span><span class="sxs-lookup"><span data-stu-id="10595-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="10595-221">Isto significa que a configuração para a coleção de Olá da configuração de diagnóstico Olá é partilhada entre todas as aplicações e serviços em execução nesse nó.</span><span class="sxs-lookup"><span data-stu-id="10595-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="10595-222">*Flexibilidade*</span><span class="sxs-lookup"><span data-stu-id="10595-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="10595-223">Olá aplicação pode enviar dados Olá sempre que é necessário toogo, desde que não há uma biblioteca de cliente que suporta o sistema de armazenamento de dados de Olá visada.</span><span class="sxs-lookup"><span data-stu-id="10595-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="10595-224">Nova sinks podem ser adicionados como pretendido.</span><span class="sxs-lookup"><span data-stu-id="10595-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="10595-225">Regras de captura, filtragem e agregação de dados complexas podem ser implementadas.</span><span class="sxs-lookup"><span data-stu-id="10595-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="10595-226">Capturar um rastreio de fora do processo, muitas vezes, é limitada pela Olá dados sinks que Olá suporta do agente.</span><span class="sxs-lookup"><span data-stu-id="10595-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="10595-227">Alguns agentes são extensíveis.</span><span class="sxs-lookup"><span data-stu-id="10595-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="10595-228">*Aceder aos dados de aplicação de toointernal e contexto*</span><span class="sxs-lookup"><span data-stu-id="10595-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="10595-229">o subsistema de diagnóstico Olá em execução dentro do processo de serviço/aplicação Olá facilmente pode aumentar os rastreios de Olá com nível contextual das informações.</span><span class="sxs-lookup"><span data-stu-id="10595-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="10595-230">Abordagem, fora do processo de Olá, Olá devem ser enviados dados agente tooan através de algum mecanismo de comunicação entre processos, por exemplo, o rastreio de eventos para o Windows.</span><span class="sxs-lookup"><span data-stu-id="10595-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="10595-231">Este mecanismo foi impõe limitações adicionais.</span><span class="sxs-lookup"><span data-stu-id="10595-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="10595-232">Vantagens de Olá **fora do processo rastreio capturar** incluem:</span><span class="sxs-lookup"><span data-stu-id="10595-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="10595-233">*Olá capacidade toomonitor Olá aplicações e recolher informações de falhas*</span><span class="sxs-lookup"><span data-stu-id="10595-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="10595-234">Capturar dentro do processo rastreio pode ser bem-sucedido se aplicação Olá falha toostart ou falhas.</span><span class="sxs-lookup"><span data-stu-id="10595-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="10595-235">Um agente independente tem muito melhor oportunidade de captura fundamentais informações de resolução de problemas.</span><span class="sxs-lookup"><span data-stu-id="10595-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="10595-236">*Maturidade, robustez e desempenho comprovado*</span><span class="sxs-lookup"><span data-stu-id="10595-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="10595-237">Um agente desenvolvido por um fornecedor de plataforma (por exemplo, um agente do Microsoft Azure Diagnostics) foi requerente toorigorous luta proteção e de teste.</span><span class="sxs-lookup"><span data-stu-id="10595-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="10595-238">Com dentro do processo rastreio capturar, deve ter cuidado tooensure atividade Olá de envio de dados de diagnóstico de um processo de aplicação não interfere com tarefas principal da aplicação Olá ou apresentar problemas de temporização ou desempenho.</span><span class="sxs-lookup"><span data-stu-id="10595-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="10595-239">Um agente de forma independente em execução é menos propenso problemas de toothese e está especificamente concebida toolimit respetivo impacto nos sistema Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="10595-240">É possível toocombine e o benefício de ambas as abordagens.</span><span class="sxs-lookup"><span data-stu-id="10595-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="10595-241">Realmente, poderá ser melhor solução de Olá para muitas aplicações.</span><span class="sxs-lookup"><span data-stu-id="10595-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="10595-242">Aqui, utilizamos Olá **Microsoft.Diagnostic.Listeners biblioteca** e Olá dentro do processo rastreio capturar os dados de toosend de um cluster de Elasticsearch de tooan de aplicação de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="10595-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="10595-243">Utilizar Olá os serviços de escuta biblioteca toosend dados de diagnóstico tooElasticsearch</span><span class="sxs-lookup"><span data-stu-id="10595-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="10595-244">biblioteca de Microsoft.Diagnostic.Listeners Olá faz parte de PartyCluster exemplo de aplicação de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="10595-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="10595-245">toouse-lo:</span><span class="sxs-lookup"><span data-stu-id="10595-245">toouse it:</span></span>

1. <span data-ttu-id="10595-246">Transferir [exemplo de PartyCluster Olá](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) a partir do GitHub.</span><span class="sxs-lookup"><span data-stu-id="10595-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="10595-247">Copiar Olá Microsoft.Diagnostics.Listeners Microsoft.Diagnostics.Listeners.Fabric projetos e (todo pastas) do Olá PartyCluster exemplo toohello solução pasta de diretório da aplicação Olá que deveria toosend Olá dados tooElasticsearch .</span><span class="sxs-lookup"><span data-stu-id="10595-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="10595-248">Abrir a solução de destino Olá, clique no nó de solução Olá Olá Explorador de soluções e escolha **adicionar projeto existente**.</span><span class="sxs-lookup"><span data-stu-id="10595-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="10595-249">Adicione a solução de toohello Olá Microsoft.Diagnostics.Listeners projeto.</span><span class="sxs-lookup"><span data-stu-id="10595-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="10595-250">Repetir Olá mesmo para o projeto de Microsoft.Diagnostics.Listeners.Fabric Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="10595-251">Adicione uma referência de projecto da sua project(s) toohello dois adicionado projetos do serviço.</span><span class="sxs-lookup"><span data-stu-id="10595-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="10595-252">(Cada serviço que deveria toosend dados tooElasticsearch deverá referenciar Microsoft.Diagnostics.EventListeners e Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="10595-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![TooMicrosoft.Diagnostics.EventListeners de referências do projeto e bibliotecas de Microsoft.Diagnostics.EventListeners.Fabric][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="10595-254">Versão de disponibilidade geral de recursos de infraestrutura de serviço e o pacote Microsoft.Diagnostics.Tracing Nuget</span><span class="sxs-lookup"><span data-stu-id="10595-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="10595-255">As aplicações criadas com o lançamento de disponibilidade geral de recursos de infraestrutura de serviço (2.0.135, lançada 31 de Março de 2016) destino **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="10595-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="10595-256">Esta versão é a versão mais recente do Olá de Olá suportado pelo Azure no momento de Olá da versão de Olá GA do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="10595-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="10595-257">Infelizmente, esta versão do framework Olá não possui determinadas APIs EventListener esse Olá Microsoft.Diagnostics.Listeners tem de biblioteca.</span><span class="sxs-lookup"><span data-stu-id="10595-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="10595-258">Como são fortemente conjugados EventSource (componente de Olá base Olá de APIs de início de sessão em aplicações de recursos de infraestrutura de formulários) e EventListener, cada projeto que utiliza Olá Microsoft.Diagnostics.Listeners biblioteca tem de utilizar uma implementação alternativa de EventSource.</span><span class="sxs-lookup"><span data-stu-id="10595-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="10595-259">Esta implementação é fornecida pela Olá **pacote Microsoft.Diagnostics.Tracing Nuget**, criados pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="10595-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="10595-260">pacote de Olá é totalmente retrocompatível com EventSource incluído no framework Olá, pelo que não existem alterações de código devem ser necessárias que não sejam alterações de espaço de nomes referenciado.</span><span class="sxs-lookup"><span data-stu-id="10595-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="10595-261">toostart utilizando Olá Microsoft.Diagnostics.Tracing implementação da classe de EventSource Olá, siga estes passos para cada projeto de serviço que necessita de toosend dados tooElasticsearch:</span><span class="sxs-lookup"><span data-stu-id="10595-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="10595-262">Clique com o botão direito no projeto de serviço Olá e escolha **gerir pacotes Nuget**.</span><span class="sxs-lookup"><span data-stu-id="10595-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="10595-263">Comutador toohello nuget.org origem do pacote (se não estiver já selecionada) e procure "**Microsoft.Diagnostics.Tracing**".</span><span class="sxs-lookup"><span data-stu-id="10595-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="10595-264">Instalar Olá `Microsoft.Diagnostics.Tracing.EventSource` pacote (e as respetivas dependências).</span><span class="sxs-lookup"><span data-stu-id="10595-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="10595-265">Abra Olá **ServiceEventSource.cs** ou **ActorEventSource.cs** de ficheiros no seu projeto de serviço e substitua Olá `using System.Diagnostics.Tracing` directiva em cima de ficheiros de Olá com Olá `using Microsoft.Diagnostics.Tracing` diretiva.</span><span class="sxs-lookup"><span data-stu-id="10595-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="10595-266">Estes passos não será necessários uma vez Olá **.NET Framework 4.6** é suportada pelo Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="10595-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="10595-267">As instâncias de serviço de escuta de Elasticsearch e a configuração</span><span class="sxs-lookup"><span data-stu-id="10595-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="10595-268">Olá passo final para enviar dados de diagnóstico tooElasticsearch é toocreate uma instância de `ElasticSearchListener` e configurá-lo com dados de ligação de Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="10595-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="10595-269">serviço de escuta de Olá captura automaticamente todos os eventos gerados através de classes de EventSource definidas no projeto de serviço Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="10595-270">Tem de toobe alive durante a duração de Olá do serviço de Olá, para Olá melhor colocar toocreate está no código de inicialização do serviço de Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="10595-271">Eis como o código de inicialização de Olá para um serviço sem monitorização de estado foi apresentada depois das alterações necessárias Olá (adições indicada nos comentários começadas `****`):</span><span class="sxs-lookup"><span data-stu-id="10595-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="10595-272">Dados de ligação de Elasticsearch devem ser colocados numa secção separada no ficheiro de configuração do serviço de Olá (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="10595-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="10595-273">nome de Olá da secção de Olá tem de corresponder valor toohello transmitido toohello `FabricConfigurationProvider` construtor, por exemplo:</span><span class="sxs-lookup"><span data-stu-id="10595-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="10595-274">Olá valores de `serviceUri`, `userName` e `password` correspondem endereço de ponto final de cluster de Elasticsearch toohello, Elasticsearch nome de utilizador e palavra-passe, respetivamente.</span><span class="sxs-lookup"><span data-stu-id="10595-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="10595-275">`indexNamePrefix`é o prefixo de Olá para índices de Elasticsearch; biblioteca de Microsoft.Diagnostics.Listeners Olá cria um novo índice para os respetivos dados diariamente.</span><span class="sxs-lookup"><span data-stu-id="10595-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="10595-276">Verificação</span><span class="sxs-lookup"><span data-stu-id="10595-276">Verification</span></span>
<span data-ttu-id="10595-277">Já está!</span><span class="sxs-lookup"><span data-stu-id="10595-277">That's it!</span></span> <span data-ttu-id="10595-278">Agora, sempre que é executado o serviço de Olá, começa a enviar serviço de Elasticsearch rastreios toohello especificado na configuração de Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="10595-279">Pode verificar isto, Olá de abertura que kibana IU associada à instância de Elasticsearch de destino Olá.</span><span class="sxs-lookup"><span data-stu-id="10595-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="10595-280">No nosso exemplo, o endereço de página Olá é http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="10595-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="10595-281">Verifique se indexa com o prefixo de nome de Olá escolhido para Olá `ElasticSearchListener` instância, de facto, tiverem sido criados e preenchida com dados.</span><span class="sxs-lookup"><span data-stu-id="10595-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Mostrar Kibana PartyCluster eventos da aplicação][2]

## <a name="next-steps"></a><span data-ttu-id="10595-283">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="10595-283">Next steps</span></span>
* [<span data-ttu-id="10595-284">Saber mais sobre como diagnosticar e monitorizar um serviço do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="10595-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
