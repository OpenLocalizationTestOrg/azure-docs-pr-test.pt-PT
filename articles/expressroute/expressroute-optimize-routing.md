---
title: 'Otimizar o encaminhamento do ExpressRoute: Azure | Microsoft Docs'
description: "Esta página fornece detalhes sobre como toooptimize encaminhamento quando tem mais do que uma ExpressRoute circuitos que estabelecer ligação entre a Microsoft e a sua rede empresarial."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="b77c0-103">Otimizar o Encaminhamento do ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="b77c0-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="b77c0-104">Quando tiver vários circuitos ExpressRoute, terá de tooMicrosoft de tooconnect mais do que um caminho.</span><span class="sxs-lookup"><span data-stu-id="b77c0-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="b77c0-105">Como resultado, o encaminhamento inferior ao ideal – pode acontecer - ou seja, o tráfego pode demorar um tooreach de caminho mais longo Microsoft e Microsoft tooyour rede.</span><span class="sxs-lookup"><span data-stu-id="b77c0-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="b77c0-106">Olá mais Olá caminho de rede, latência de Olá superior Olá.</span><span class="sxs-lookup"><span data-stu-id="b77c0-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="b77c0-107">A latência tem um impacto direto no desempenho das aplicações e na experiência do utilizador.</span><span class="sxs-lookup"><span data-stu-id="b77c0-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="b77c0-108">Este artigo ilustra este problema e explica como toooptimize encaminhamento utilizando Olá tecnologias de encaminhamento padrão.</span><span class="sxs-lookup"><span data-stu-id="b77c0-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="b77c0-109">Inferior ao ideal de encaminhamento de tooMicrosoft de cliente</span><span class="sxs-lookup"><span data-stu-id="b77c0-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="b77c0-110">Vamos analisar problema de encaminhamento Olá por um exemplo.</span><span class="sxs-lookup"><span data-stu-id="b77c0-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="b77c0-111">Imagine que tem dois escritórios no Olá E.U.A., um em Los Angeles e outro em Nova Iorque.</span><span class="sxs-lookup"><span data-stu-id="b77c0-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="b77c0-112">Os escritórios estão ligados através de uma Rede Alargada (WAN), que pode ser a sua própria rede principal ou a VPN de IP do seu fornecedor de serviços.</span><span class="sxs-lookup"><span data-stu-id="b77c0-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="b77c0-113">Tem dois circuitos do ExpressRoute, um nos EUA oeste e o outro nos EUA leste, que também estão ligados Olá WAN.</span><span class="sxs-lookup"><span data-stu-id="b77c0-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="b77c0-114">Obviamente, tem dois caminhos tooconnect toohello Microsoft network.</span><span class="sxs-lookup"><span data-stu-id="b77c0-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="b77c0-115">Imagine agora que tem a implementação do Azure (por exemplo, o Serviço de Aplicações do Azure) nos E.U.A. Oeste e nos E.U.A. Leste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="b77c0-116">A intenção é tooconnect os utilizadores em Los Angeles tooAzure dos EUA oeste e os utilizadores em Nova Iorque tooAzure dos EUA leste, porque o seu administrador de serviços anuncia que os utilizadores em cada acesso office Olá próximas serviços do Azure para uma experiência ideal.</span><span class="sxs-lookup"><span data-stu-id="b77c0-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="b77c0-117">Infelizmente, Olá plano funciona bem para utilizadores da costa leste de Olá, mas não para os utilizadores da costa oeste do Olá.</span><span class="sxs-lookup"><span data-stu-id="b77c0-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="b77c0-118">causa Olá problema Olá é seguinte Olá.</span><span class="sxs-lookup"><span data-stu-id="b77c0-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="b77c0-119">Em cada circuito do ExpressRoute, estamos a anunciar tooyou ambos prefixo Olá no Azure dos EUA Leste (23.100.0.0/16) e o prefixo de Olá no Azure dos EUA oeste (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="b77c0-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="b77c0-120">Se não souber que prefixo corresponde a que região, não é tootreat capaz de forma diferente.</span><span class="sxs-lookup"><span data-stu-id="b77c0-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="b77c0-121">A rede WAN poderá achar que ambos os prefixos de Olá são próximo Leste tooUS que dos EUA oeste e, por conseguinte, encaminhar ambos os toohello de utilizadores do office circuito do ExpressRoute nos EUA Leste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="b77c0-122">No final de Olá, terá muitos utilizadores insatisfeitos no Olá escritório em Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="b77c0-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Problema de ExpressRoute caso 1 - inferior ao ideal de encaminhamento de tooMicrosoft de cliente](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="b77c0-124">Solução: utilizar Comunidades do BGP</span><span class="sxs-lookup"><span data-stu-id="b77c0-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="b77c0-125">toooptimize encaminhamento para ambos os utilizadores do office, terá de tooknow que prefixo corresponde a partir do Azure dos EUA oeste e qual a Azure dos EUA Leste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="b77c0-126">Codificamos estas informações com os [Valores das Comunidades do BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="b77c0-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="b77c0-127">Atribuímos um tooeach de valor das Comunidades do BGP exclusivo região do Azure, por exemplo “12076:51004” para EUA Leste e “12076:51006” para EUA Oeste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="b77c0-128">Agora que sabe que prefixo corresponde a que região do Azure, já pode configurar que circuito do ExpressRoute deve ser o preferencial.</span><span class="sxs-lookup"><span data-stu-id="b77c0-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="b77c0-129">Uma vez que utilizamos informações de encaminhamento do tooexchange Olá BGP, pode utilizar o encaminhamento de BGP preferência Local tooinfluence.</span><span class="sxs-lookup"><span data-stu-id="b77c0-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="b77c0-130">No nosso exemplo, pode atribuir um maior preferência local valor too13.100.0.0/16 nos EUA oeste que nos EUA leste e da mesma forma, um maior preferência local valor too23.100.0.0/16 nos EUA Leste que nos EUA oeste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="b77c0-131">Esta configuração permitirá garantir que, quando os dois caminhos tooMicrosoft estão disponíveis, os utilizadores em Los Angeles demorará circuito do ExpressRoute Olá nos EUA oeste tooconnect tooAzure dos EUA oeste, ao passo que os utilizadores em Nova Iorque demorar Olá ExpressRoute nos EUA Leste tooAzure dos EUA leste .</span><span class="sxs-lookup"><span data-stu-id="b77c0-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="b77c0-132">O encaminhamento fica otimizado em ambos os lados.</span><span class="sxs-lookup"><span data-stu-id="b77c0-132">Routing is optimized on both sides.</span></span> 

![Solução do Caso 1 do ExpressRoute - utilizar Comunidades do BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="b77c0-134">Olá técnica mesma, utilizando a preferência Local, pode ser aplicado toorouting do cliente tooAzure rede Virtual.</span><span class="sxs-lookup"><span data-stu-id="b77c0-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="b77c0-135">Iremos não etiquetar os prefixos toohello de valor das Comunidades do BGP anunciados a partir da rede tooyour do Azure.</span><span class="sxs-lookup"><span data-stu-id="b77c0-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="b77c0-136">No entanto, uma vez que já sabe que a implementação de rede Virtual está a fechar toowhich do seu escritório, pode configurar os routers em conformidade tooprefer um tooanother de circuito de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="b77c0-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="b77c0-137">Inferior ao ideal de encaminhamento de toocustomer da Microsoft</span><span class="sxs-lookup"><span data-stu-id="b77c0-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="b77c0-138">Aqui é o outro exemplo em que as ligações da Microsoft demorar um tooreach de caminho mais longo sua rede.</span><span class="sxs-lookup"><span data-stu-id="b77c0-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="b77c0-139">Neste caso, está a utilizar servidores do Exchange no local e o Exchange Online num [ambiente híbrido](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="b77c0-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="b77c0-140">Os escritórios estão ligado tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="b77c0-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="b77c0-141">Anunciar prefixos Olá dos seus servidores no local em ambos os seus tooMicrosoft escritórios através de circuitos do ExpressRoute Olá dois.</span><span class="sxs-lookup"><span data-stu-id="b77c0-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="b77c0-142">Exchange Online irá iniciar servidores no local de toohello de ligações em casos como a migração de caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="b77c0-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="b77c0-143">Infelizmente, Olá ligação tooyour escritório em Los Angeles é encaminhada toohello circuito do ExpressRoute nos EUA Leste atravessando da costa oeste do Olá todo toohello back continente antes.</span><span class="sxs-lookup"><span data-stu-id="b77c0-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="b77c0-144">Olá causa do problema Olá é semelhante toohello primeiro um.</span><span class="sxs-lookup"><span data-stu-id="b77c0-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="b77c0-145">Sem sugestões, a rede da Microsoft Olá não é possível dizer que prefixos do cliente está a fechar Leste tooUS e qual delas é fechar tooUS oeste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="b77c0-146">Ocorre office do toopick Olá caminho incorreto tooyour em Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="b77c0-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute caso 2 - inferior ao ideal de encaminhamento de toocustomer da Microsoft](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="b77c0-148">Solução: utilizar prefixação COMO CAMINHO</span><span class="sxs-lookup"><span data-stu-id="b77c0-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="b77c0-149">Existem dois problema de toohello soluções.</span><span class="sxs-lookup"><span data-stu-id="b77c0-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="b77c0-150">Olá primeiro um é simplesmente anunciar o prefixo no local para o seu escritório em Los Angeles, 177.2.0.0/31, no circuito de ExpressRoute Olá nos EUA oeste e o prefixo no local para o seu escritório de Nova Iorque, 177.2.0.2/31, no circuito de ExpressRoute Olá nos EUA Leste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="b77c0-151">Como resultado, é apenas um caminho para a Microsoft tooconnect tooeach dos seus escritórios.</span><span class="sxs-lookup"><span data-stu-id="b77c0-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="b77c0-152">Não há ambiguidade e o encaminhamento é otimizado.</span><span class="sxs-lookup"><span data-stu-id="b77c0-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="b77c0-153">Com esta conceção, terá de toothink sobre a sua estratégia de ativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="b77c0-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="b77c0-154">No Olá eventos Olá tooMicrosoft caminho através do ExpressRoute for interrompido, tem de certificar-se de que Exchange Online ainda conseguir ligar servidores no local de tooyour toomake.</span><span class="sxs-lookup"><span data-stu-id="b77c0-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="b77c0-155">solução segundo Olá é que continuar tooadvertise dos prefixos Olá em ambos os circuitos ExpressRoute e, além disso, dar-numa sugestão de qual prefixo é toowhich fechar um dos seus escritórios.</span><span class="sxs-lookup"><span data-stu-id="b77c0-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="b77c0-156">Porque suportamos a prefixação como caminho do BGP, pode configurar Olá como caminho para o encaminhamento de tooinfluence de prefixo.</span><span class="sxs-lookup"><span data-stu-id="b77c0-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="b77c0-157">Neste exemplo, pode aumentar a prefixação como caminho de Olá para 172.2.0.0/31 nos EUA leste, para que preferirmos circuito de ExpressRoute Olá nos EUA oeste para o tráfego destinado a este prefixo (uma vez que a nossa rede irá considerar Olá caminho toothis prefixo é constituído pelos mais curto no Oeste Olá).</span><span class="sxs-lookup"><span data-stu-id="b77c0-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="b77c0-158">Da mesma forma pode aumentar a prefixação como caminho de Olá para 172.2.0.2/31 nos EUA oeste para que a preferirmos o circuito de ExpressRoute Olá nos EUA Leste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="b77c0-159">O encaminhamento fica otimizado para ambos os escritórios.</span><span class="sxs-lookup"><span data-stu-id="b77c0-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="b77c0-160">Com esta estrutura, se um circuito do ExpressRoute for interrompido, o Exchange Online ainda consegue contactá-lo através de outro circuito do ExpressRoute e da sua WAN.</span><span class="sxs-lookup"><span data-stu-id="b77c0-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="b77c0-161">Removemos privada como números existentes na Olá como caminho para os prefixos de Olá receberam no Peering da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b77c0-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="b77c0-162">Terá de tooappend números públicos como no Olá como caminho tooinfluence encaminhamento para Peering da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b77c0-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Solução do Caso 2 do ExpressRoute - utilizar prefixação COMO CAMINHO](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="b77c0-164">Enquanto são exemplos de Olá fornecidos aqui para peerings público e da Microsoft, suportamos Olá as mesmas capacidades para peering privado do Olá.</span><span class="sxs-lookup"><span data-stu-id="b77c0-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="b77c0-165">Além disso, prefixação como caminho de Olá funciona dentro de um único circuito do ExpressRoute, seleção de Olá tooinfluence dos caminhos de Olá primária e secundária.</span><span class="sxs-lookup"><span data-stu-id="b77c0-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="b77c0-166">Encaminhamento inferior ao ideal entre redes virtuais</span><span class="sxs-lookup"><span data-stu-id="b77c0-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="b77c0-167">Com o ExpressRoute, pode ativar a rede Virtual tooVirtual rede (que também é conhecido como "VNet") comunicação associando-los tooan circuito do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="b77c0-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="b77c0-168">Encaminhamento inferior ao ideal – pode acontecer quando a ligá-las toomultiple circuitos do ExpressRoute, entre Olá VNets.</span><span class="sxs-lookup"><span data-stu-id="b77c0-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="b77c0-169">Vamos considerar um exemplo.</span><span class="sxs-lookup"><span data-stu-id="b77c0-169">Let's consider an example.</span></span> <span data-ttu-id="b77c0-170">Tem dois circuitos do ExpressRoute, um nos E.U.A. Oeste e outro nos E.U.A. Leste.</span><span class="sxs-lookup"><span data-stu-id="b77c0-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="b77c0-171">Em cada região, tem duas VNets.</span><span class="sxs-lookup"><span data-stu-id="b77c0-171">In each region, you have two VNets.</span></span> <span data-ttu-id="b77c0-172">Os servidores web são implementados numa VNet e servidores de aplicações em Olá outros.</span><span class="sxs-lookup"><span data-stu-id="b77c0-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="b77c0-173">Para a redundância, a ligação Olá duas VNets em cada região tooboth Olá local circuito do ExpressRoute e Olá remoto circuito do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="b77c0-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="b77c0-174">Como é apresentada abaixo, a partir de cada VNet existem dois caminhos toohello outra VNet.</span><span class="sxs-lookup"><span data-stu-id="b77c0-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="b77c0-175">Olá VNets não souber que circuito do ExpressRoute é local e que é remoto.</span><span class="sxs-lookup"><span data-stu-id="b77c0-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="b77c0-176">Por conseguinte como fazem igual-custo várias-Path (ECMP) encaminhamento tooload-equilibrar inter-VNet o tráfego, alguns fluxos de tráfego irão demorar caminho mais longo Olá e obterem encaminhados no circuito de ExpressRoute remoto Olá.</span><span class="sxs-lookup"><span data-stu-id="b77c0-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![Caso 3 do ExpressRoute - encaminhamento inferior ao ideal entre redes virtuais](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="b77c0-178">Solução: atribuir uma ligação de toolocal importância elevada</span><span class="sxs-lookup"><span data-stu-id="b77c0-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="b77c0-179">solução Olá é simple.</span><span class="sxs-lookup"><span data-stu-id="b77c0-179">hello solution is simple.</span></span> <span data-ttu-id="b77c0-180">Uma vez que já sabe onde estão os circuitos VNets e Olá Olá, pode diga-nos de caminho no qual deve preferir cada VNet.</span><span class="sxs-lookup"><span data-stu-id="b77c0-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="b77c0-181">Especificamente para este exemplo, pode designar uma maior ponderação toohello ligação de local de ligação remota toohello (consulte exemplo de configuração de Olá [aqui](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="b77c0-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="b77c0-182">Quando uma VNet recebe prefixo Olá Olá outra VNet em várias ligações preferirão ligação Olá com Olá maior ponderação toosend tráfego destinado a esse prefixo.</span><span class="sxs-lookup"><span data-stu-id="b77c0-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Solução do ExpressRoute cenário 3 - atribuir importância elevada toolocal ligação](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="b77c0-184">Também pode influenciar o encaminhamento de rede do VNet tooyour no local, se tiver vários circuitos do ExpressRoute, configurando o peso Olá de uma ligação em vez de aplicar como caminho prefixação uma técnica descrita Olá segundo cenário acima.</span><span class="sxs-lookup"><span data-stu-id="b77c0-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="b77c0-185">Para cada prefixo sempre veremos peso de ligação de Olá antes Olá comprimento como caminho ao decidir como toosend tráfego.</span><span class="sxs-lookup"><span data-stu-id="b77c0-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
