---
title: "aaaHow é o trabalho tooAzure de replicação de VMware no Azure Site Recovery? | Microsoft Docs"
description: "Este artigo fornece uma descrição geral da arquitetura de utilizada quando replicar no local as VMs VMware e servidores físicos tooAzure com Olá serviço Azure Site Recovery e componentes"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/29/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: vmware-walkthrough-architecture
ms.openlocfilehash: f0fb834f8b251640f97e4d0163b2b9e54de691e1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/06/2017
---
# <a name="how-does-vmware-replication-tooazure-work-in-site-recovery"></a><span data-ttu-id="5b37f-104">Como funciona tooAzure de replicação de VMware no Site Recovery?</span><span class="sxs-lookup"><span data-stu-id="5b37f-104">How does VMware replication tooAzure work in Site Recovery?</span></span>

<span data-ttu-id="5b37f-105">Este artigo descreve os componentes de Olá e processos envolvidos quando replicar no local tooAzure de máquinas virtuais e servidores físicos Windows/Linux, do VMware com Olá [do Azure Site Recovery](site-recovery-overview.md) serviço.</span><span class="sxs-lookup"><span data-stu-id="5b37f-105">This article describes hello components and processes involved when replicating on-premises VMware virtual machines, and Windows/Linux physical servers, tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="5b37f-106">Quando se replica tooAzure de servidores físicos no local, utiliza a replicação também Olá, mesmo componentes e processos como replicação de VM de VMware, com estas diferenças:</span><span class="sxs-lookup"><span data-stu-id="5b37f-106">When you replicate physical on-premises servers tooAzure, replication uses also hello same components and processes as VMware VM replication, with these differences:</span></span>

- <span data-ttu-id="5b37f-107">Pode utilizar um servidor físico para o servidor de configuração de Olá, em vez de uma VM de VMware.</span><span class="sxs-lookup"><span data-stu-id="5b37f-107">You can use a physical server for hello configuration server, instead of a VMware VM.</span></span>
- <span data-ttu-id="5b37f-108">Vai precisar de uma infraestrutura de VMware no local para a reativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="5b37f-108">You will need an on-premises VMware infrastructure for failback.</span></span> <span data-ttu-id="5b37f-109">Não pode falhar back tooa máquina física.</span><span class="sxs-lookup"><span data-stu-id="5b37f-109">You can't fail back tooa physical machine.</span></span>

<span data-ttu-id="5b37f-110">Publique quaisquer comentários na parte inferior deste artigo hello, ou colocar questões no Olá [fórum de serviços de recuperação do Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="5b37f-110">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="5b37f-111">Componentes da arquitetura</span><span class="sxs-lookup"><span data-stu-id="5b37f-111">Architectural components</span></span>

<span data-ttu-id="5b37f-112">Existem vários componentes envolvidos quando replicar VMs de VMware e servidores físicos tooAzure.</span><span class="sxs-lookup"><span data-stu-id="5b37f-112">There are a number of components involved when replicating VMware VMs and physical servers tooAzure.</span></span>

<span data-ttu-id="5b37f-113">**Componente**</span><span class="sxs-lookup"><span data-stu-id="5b37f-113">**Component**</span></span> | <span data-ttu-id="5b37f-114">**Localização**</span><span class="sxs-lookup"><span data-stu-id="5b37f-114">**Location**</span></span> | <span data-ttu-id="5b37f-115">**Detalhes**</span><span class="sxs-lookup"><span data-stu-id="5b37f-115">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="5b37f-116">**Azure**</span><span class="sxs-lookup"><span data-stu-id="5b37f-116">**Azure**</span></span> | <span data-ttu-id="5b37f-117">No Azure, precisa de uma conta do Azure, de uma conta de armazenamento do Azure e de uma rede do Azure.</span><span class="sxs-lookup"><span data-stu-id="5b37f-117">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="5b37f-118">Dados replicados são guardados na conta do storage Olá e as VMs do Azure são criadas com dados Olá replicado quando ocorre a ativação pós-falha do seu site no local.</span><span class="sxs-lookup"><span data-stu-id="5b37f-118">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="5b37f-119">Olá VMs do Azure ligar toohello rede virtual do Azure quando são criados.</span><span class="sxs-lookup"><span data-stu-id="5b37f-119">hello Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="5b37f-120">**Servidor de configuração**</span><span class="sxs-lookup"><span data-stu-id="5b37f-120">**Configuration server**</span></span> | <span data-ttu-id="5b37f-121">Um único-local no servidor de gestão (VMWare VM) que executa todos os componentes de local de Olá que são necessárias para a implementação de Olá, incluindo o servidor de configuração de Olá, o servidor de processos, o servidor de destino mestre</span><span class="sxs-lookup"><span data-stu-id="5b37f-121">A single on-premises management server (VMWare VM) that runs all hello on-premises components that are needed for hello deployment, including hello configuration server, process server, master target server</span></span> | <span data-ttu-id="5b37f-122">componente de servidor de configuração de Olá coordena as comunicações entre no local e o Azure e gere a replicação de dados.</span><span class="sxs-lookup"><span data-stu-id="5b37f-122">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="5b37f-123">**Servidor de processos**:</span><span class="sxs-lookup"><span data-stu-id="5b37f-123">**Process server**:</span></span>  | <span data-ttu-id="5b37f-124">Instalado por predefinição no servidor de configuração de Olá.</span><span class="sxs-lookup"><span data-stu-id="5b37f-124">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="5b37f-125">Atua como um gateway de replicação.</span><span class="sxs-lookup"><span data-stu-id="5b37f-125">Acts as a replication gateway.</span></span> <span data-ttu-id="5b37f-126">Recebe dados de replicação, otimiza-as com colocação em cache, compressão e encriptação e envia-tooAzure armazenamento.</span><span class="sxs-lookup"><span data-stu-id="5b37f-126">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="5b37f-127">servidor de processos de Olá também processa a instalação push de máquinas de tooprotected de serviço de mobilidade Olá e efetua a descoberta automática de VMs de VMware.</span><span class="sxs-lookup"><span data-stu-id="5b37f-127">hello process server also handles push installation of hello Mobility service tooprotected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="5b37f-128">À medida que cresça a implementação pode adicionar mais processos dedicados independentes servidores toohandle aumentar volumes de tráfego de replicação.</span><span class="sxs-lookup"><span data-stu-id="5b37f-128">As your deployment grows you can add additional separate dedicated process servers toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="5b37f-129">**Servidor de destino mestre**</span><span class="sxs-lookup"><span data-stu-id="5b37f-129">**Master target server**</span></span> | <span data-ttu-id="5b37f-130">Instalado por predefinição no servidor de configuração do Olá no local.</span><span class="sxs-lookup"><span data-stu-id="5b37f-130">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="5b37f-131">Processa dados de replicação durante a reativação pós-falha a partir do Azure.</span><span class="sxs-lookup"><span data-stu-id="5b37f-131">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="5b37f-132">Se os volumes de tráfego da reativação pós-falha forem elevados, pode implementar um servidor de destino mestre separado para a reativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="5b37f-132">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="5b37f-133">**Servidores de VMware**</span><span class="sxs-lookup"><span data-stu-id="5b37f-133">**VMware servers**</span></span> | <span data-ttu-id="5b37f-134">VMs de VMware alojadas em servidores de ESXi vSphere e recomendamos um vCenter anfitriões do servidor toomanage Olá.</span><span class="sxs-lookup"><span data-stu-id="5b37f-134">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server toomanage hello hosts.</span></span> | <span data-ttu-id="5b37f-135">Adicionar servidores de VMware tooyour Cofre de serviços de recuperação.</span><span class="sxs-lookup"><span data-stu-id="5b37f-135">You add VMware servers tooyour Recovery Services vault.</span></span>
<span data-ttu-id="5b37f-136">**Máquinas replicadas**</span><span class="sxs-lookup"><span data-stu-id="5b37f-136">**Replicated machines**</span></span> | <span data-ttu-id="5b37f-137">Olá serviço de mobilidade será instalado em cada VM pretende tooreplicate de VMware.</span><span class="sxs-lookup"><span data-stu-id="5b37f-137">hello Mobility service will be installed on each VMware VM you want tooreplicate.</span></span> <span data-ttu-id="5b37f-138">Pode ser instalado manualmente em cada máquina ou com uma instalação push do servidor de processos de Olá.</span><span class="sxs-lookup"><span data-stu-id="5b37f-138">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>

<span data-ttu-id="5b37f-139">Saiba mais sobre os pré-requisitos de implementação de Olá e os requisitos para cada um destes componentes no Olá [matriz de suporte](site-recovery-support-matrix-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="5b37f-139">Learn about hello deployment prerequisites and requirements for each of these components in hello [support matrix](site-recovery-support-matrix-to-azure.md).</span></span>

<span data-ttu-id="5b37f-140">**Figura 1: VMware tooAzure componentes**</span><span class="sxs-lookup"><span data-stu-id="5b37f-140">**Figure 1: VMware tooAzure components**</span></span>

![Componentes](./media/site-recovery-components/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="5b37f-142">Processo de replicação</span><span class="sxs-lookup"><span data-stu-id="5b37f-142">Replication process</span></span>

1. <span data-ttu-id="5b37f-143">Configurar a implementação de Olá, incluindo os componentes do Azure e um cofre dos serviços de recuperação.</span><span class="sxs-lookup"><span data-stu-id="5b37f-143">You set up hello deployment, including Azure components, and a Recovery Services vault.</span></span> <span data-ttu-id="5b37f-144">No Cofre de Olá especificou de origem de replicação de Olá e de destino, configurar o servidor de configuração de Olá, adicionar servidores VMware, criar uma política de replicação, implementar o serviço de mobilidade Olá, ativar a replicação e executam uma ativação pós-falha de teste.</span><span class="sxs-lookup"><span data-stu-id="5b37f-144">In hello vault you specify hello replication source and target, set up hello configuration server, add VMware servers, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="5b37f-145">Máquinas iniciam a replicação de acordo com a política de replicação de Olá, não sendo uma cópia inicial dos dados de Olá armazenamento tooAzure replicadas.</span><span class="sxs-lookup"><span data-stu-id="5b37f-145">Machines start replicating in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
4. <span data-ttu-id="5b37f-146">Começa a replicação de diferenças alterações tooAzure após a conclusão da replicação inicial Olá.</span><span class="sxs-lookup"><span data-stu-id="5b37f-146">Replication of delta changes tooAzure begins after hello initial replication finishes.</span></span> <span data-ttu-id="5b37f-147">As alterações registadas relativas a uma máquina são guardadas num ficheiro .hrl.</span><span class="sxs-lookup"><span data-stu-id="5b37f-147">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="5b37f-148">Replicação de máquinas comunicam com o servidor de configuração de Olá na porta HTTPS 443 entrada para a gestão de replicação.</span><span class="sxs-lookup"><span data-stu-id="5b37f-148">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="5b37f-149">Replicação de máquinas enviam servidor de processos de toohello de dados de replicação na porta HTTPS 9443 entrada (podem ser configuradas).</span><span class="sxs-lookup"><span data-stu-id="5b37f-149">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be configured).</span></span>
    - <span data-ttu-id="5b37f-150">servidor de configuração de Olá orquestra a gestão de replicação com o Azure através da porta HTTPS 443 de saída.</span><span class="sxs-lookup"><span data-stu-id="5b37f-150">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="5b37f-151">servidor de processos de Olá recebe dados de máquinas de origem, otimiza e encripta- e envia-tooAzure armazenamento através da porta 443 saída.</span><span class="sxs-lookup"><span data-stu-id="5b37f-151">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="5b37f-152">Se ativar a consistência multi VM, em seguida, as máquinas no grupo de replicação de Olá comunicam entre si através da porta 20004.</span><span class="sxs-lookup"><span data-stu-id="5b37f-152">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="5b37f-153">A consistência multi-VM é utilizada se agrupar várias máquinas em grupos de replicação que partilhem pontos de consistência de falhas e pontos de consistência de aplicação quando é efetuada a ativação pós-falha dos mesmos.</span><span class="sxs-lookup"><span data-stu-id="5b37f-153">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="5b37f-154">Isto é útil se máquinas estão em execução Olá a mesma carga de trabalho e precisam de toobe consistente.</span><span class="sxs-lookup"><span data-stu-id="5b37f-154">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
5. <span data-ttu-id="5b37f-155">O tráfego é replicada tooAzure armazenamento pontos finais públicos, mais Olá internet.</span><span class="sxs-lookup"><span data-stu-id="5b37f-155">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="5b37f-156">Em alternativa, pode utilizar o [peering público](../expressroute/expressroute-circuit-peerings.md#public-peering) do Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5b37f-156">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="5b37f-157">Replicar o tráfego através de uma VPN de site para site a partir de um tooAzure de site no local não é suportada.</span><span class="sxs-lookup"><span data-stu-id="5b37f-157">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>

<span data-ttu-id="5b37f-158">**Figura 2: VMware tooAzure replicação**</span><span class="sxs-lookup"><span data-stu-id="5b37f-158">**Figure 2: VMware tooAzure replication**</span></span>

![Melhorada](./media/site-recovery-components/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="5b37f-160">Processo de ativação pós-falha e de reativação pós-falha</span><span class="sxs-lookup"><span data-stu-id="5b37f-160">Failover and failback process</span></span>

1. <span data-ttu-id="5b37f-161">Depois de verificar que teste a ativação pós-falha está a funcionar conforme esperado, pode executar as ativações pós-falha não planeada tooAzure conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="5b37f-161">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="5b37f-162">A ativação pós-falha planeada não é suportada.</span><span class="sxs-lookup"><span data-stu-id="5b37f-162">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="5b37f-163">Pode efetuar a ativação pós-falha de um único computador ou criar [planos de recuperação](site-recovery-create-recovery-plans.md), toofail através de várias VMs.</span><span class="sxs-lookup"><span data-stu-id="5b37f-163">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple VMs.</span></span>
3. <span data-ttu-id="5b37f-164">Quando executa uma ativação pós-falha, são criadas VMs de réplica no Azure.</span><span class="sxs-lookup"><span data-stu-id="5b37f-164">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="5b37f-165">Consolidar uma ativação pós-falha toostart ao aceder aos Olá carga de trabalho a partir da réplica de Olá VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="5b37f-165">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
4. <span data-ttu-id="5b37f-166">Quando o site no local primário estiver novamente disponível, pode fazer a reativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="5b37f-166">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="5b37f-167">Configurar uma infraestrutura de reativação pós-falha, iniciar a replicação máquina Olá de Olá site secundário toohello primário e executar uma ativação pós-falha não planeada do site secundário Olá.</span><span class="sxs-lookup"><span data-stu-id="5b37f-167">You set up a failback infrastructure, start replicating hello machine from hello secondary site toohello primary, and run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="5b37f-168">Depois de consolidar esta ativação pós-falha, os dados serão back no local e terá tooenable replicação tooAzure novamente.</span><span class="sxs-lookup"><span data-stu-id="5b37f-168">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span> [<span data-ttu-id="5b37f-169">Saiba mais</span><span class="sxs-lookup"><span data-stu-id="5b37f-169">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="5b37f-170">Existem alguns requisitos para a reativação pós-falha:</span><span class="sxs-lookup"><span data-stu-id="5b37f-170">There are a few failback requirements:</span></span>


- <span data-ttu-id="5b37f-171">**Servidor de processo temporário no Azure**: Se pretender toofail novamente a partir do Azure após a ativação pós-falha, precisará tooset se uma VM do Azure como um servidor de processos, toohandle replicação a partir do Azure.</span><span class="sxs-lookup"><span data-stu-id="5b37f-171">**Temporary process server in Azure**: If you want toofail back from Azure after failover you'll need tooset up an Azure VM configured as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="5b37f-172">É possível eliminar esta VM após a conclusão da reativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="5b37f-172">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="5b37f-173">**Ligação VPN**: para reativação pós-falha, terá uma ligação VPN (ou Azure ExpressRoute) configurada a partir da site no local do Olá rede Azure toohello.</span><span class="sxs-lookup"><span data-stu-id="5b37f-173">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="5b37f-174">**Servidor de destino principal independente no local**: servidor de destino mestre Olá no local processa a reativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="5b37f-174">**Separate on-premises master target server**: hello on-premises master target server handles failback.</span></span> <span data-ttu-id="5b37f-175">servidor de destino mestre Olá é instalado por predefinição no servidor de gestão de Olá, mas se está a reativar maiores volumes de tráfego deve configurar um servidor de destino principal independente no local para esta finalidade.</span><span class="sxs-lookup"><span data-stu-id="5b37f-175">hello master target server is installed by default on hello management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="5b37f-176">**Política de reativação pós-falha**: tooreplicate back tooyour no local site, precisa de uma política de reativação pós-falha.</span><span class="sxs-lookup"><span data-stu-id="5b37f-176">**Failback policy**: tooreplicate back tooyour on-premises site, you need a failback policy.</span></span> <span data-ttu-id="5b37f-177">Esta foi criada automaticamente quando criou a política de replicação.</span><span class="sxs-lookup"><span data-stu-id="5b37f-177">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="5b37f-178">**Infraestrutura do VMware**: terá de ser novamente tooan no local VM de VMware.</span><span class="sxs-lookup"><span data-stu-id="5b37f-178">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="5b37f-179">Isto significa que terá de uma infraestrutura de VMware no local, mesmo se está a replicar tooAzure de servidores físicos no local.</span><span class="sxs-lookup"><span data-stu-id="5b37f-179">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="5b37f-180">**Figura 3: Reativação pós-falha de VMware/servidor físico**</span><span class="sxs-lookup"><span data-stu-id="5b37f-180">**Figure 3: VMware/physical failback**</span></span>

![Reativação pós-falha](./media/site-recovery-components/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="5b37f-182">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="5b37f-182">Next steps</span></span>

<span data-ttu-id="5b37f-183">Olá revisão [matriz de suporte](site-recovery-support-matrix-to-azure.md)</span><span class="sxs-lookup"><span data-stu-id="5b37f-183">Review hello [support matrix](site-recovery-support-matrix-to-azure.md)</span></span>
